function getScrollBarWidth(){var inner=document.createElement("p");inner.style.width="100%",inner.style.height="200px";var outer=document.createElement("div");outer.style.position="absolute",outer.style.top="0px",outer.style.left="0px",outer.style.visibility="hidden",outer.style.width="200px",outer.style.height="150px",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="scroll";var w2=inner.offsetWidth;return w1==w2&&(w2=outer.clientWidth),document.body.removeChild(outer),w1-w2}function FB_share(url){return dataLayer.push({event:"customEvent",category:"Share",action:"click",label:"Facebook",value:1}),window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(url),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1}function TW_share(url,text){return dataLayer.push({event:"customEvent",category:"Share",action:"click",label:"Twitter",value:1}),_.isUndefined(text)&&(text=""),window.open("http://twitter.com/share?url="+encodeURIComponent(url)+"&text="+encodeURIComponent(text),"","left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0"),!1}function GP_share(url){return dataLayer.push({event:"customEvent",category:"Share",action:"click",label:"Google Plus",value:1}),window.open("https://plus.google.com/share?url="+url,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1}function GTM_map_cart_products(cart){return _.map(cart.items,function(item){return{name:item.productDTO.title,id:item.productDTO.id,price:item.productDTO.price,quantity:item.quantity}})}function GTM_log_funnel_step(options,cb){dataLayer.push({event:"GTM_ECOM_FUNNEL_STEP",category:"Ecommerce",action:options.action,ecommerce:options.ecommerce,eventCallback:function(){cb&&cb()}})}function initiateGoogleMap(){"undefined"==typeof google||"undefined"==typeof google.maps||"undefined"==typeof google.maps.places||_.isEmpty(google.maps.places)?setTimeout(initiateGoogleMap,50):(angular.module("googleMap",[]).directive("googleMap",["$timeout","$http",function($timeout,$http){return{restrict:"E",scope:{query:"=",places:"=",location:"=",locationChange:"&",emptyLocation:"&",noLocation:"=",noLocateMe:"=",noLocateMeMsg:"="},replace:!0,template:'<div class="google-map"><div class="input"><input ng-click="handleEscKeys();" ng-keydown="typing($event)" type="text" ng-model="input" placeholder="{{placeholder}}"/><button ng-hide="loading" class="locate-me" ng-click="locateMe()">Locate Me</button><i ng-show="loading" class="fa fa-circle-o-notch fa-spin"></i><div id="options" class="options" ng-if="list.length>0"><ul><li ng-class="{\'selected\':(iSelected==$index)}" ng-repeat="item in list" ng-click="select(item)"><span style = "font-size: 12px; color: #4a90e2;"> {{item.addType && item.addType == "corp" ? "[Corporate] " : ""}}</span>{{item.addressLine2}}</li></ul></div></div></div>',link:function(scope,elm,attrs,ctrl){scope.loading=!1,scope.list=[],scope.input="",scope.iSelected=null,scope.usePlaces=!1,scope.placeholder="Enter min 5 characters to search your location",scope.trigger=Boolean(attrs.trigger)?document.getElementById(attrs.trigger):null,scope.debounceTimeout=null,scope.tmpLocation=null,scope.isGoogle=!_.isUndefined(google)||!_.isUndefined(google.maps),scope.autocomplete=scope.isGoogle?new google.maps.places.AutocompleteService:null,scope.geocoder=scope.isGoogle?new google.maps.Geocoder:null,scope.radius=6e3,scope.loc=null,attrs.$observe("cityName",function(newVal){newVal&&scope.setSearchRadius(newVal)}),scope.$watch("query",function(newVal,oldVal){newVal&&(scope.isGoogle&&scope.geocoder.geocode({address:newVal},function(results,status){"OK"===status&&(scope.tmpLocation={addressLine2:results[0].formatted_address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()})}),scope.input=newVal,console.log("Google map, input set to "+newVal+"..."))}),scope.locateMe=function(){navigator.geolocation?$timeout(function(){scope.loading=!0,navigator.geolocation.getCurrentPosition(function(position){scope.geocoder.geocode({latLng:new google.maps.LatLng(position.coords.latitude,position.coords.longitude)},function(results,status){"OK"===status&&$timeout(function(){scope.loading=!1,scope.noLocation=!1,scope.input="",scope.location={addressLine2:results[0].formatted_address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()},$timeout(function(){scope.locationChange()})})})},function(response){scope.handleNoGeolocation(response)},{timeout:5e3})}):scope.handleNoGeolocation({code:"noGeolocation"})},scope.handleNoGeolocation=function(response){$timeout(function(){switch(scope.noLocation=!0,scope.noLocateMe=!0,response.code){case 1:scope.noLocateMeMsg="We are unable to fetch your location. Please allow Freshmenu to access location in browser settings or type your location to load the menu.";break;case"noGeolocation":scope.noLocateMeMsg="Browser dose not have geolocation.";break;default:scope.noLocateMeMsg="We are unable to fetch your location. Type your location to load the menu."}scope.loading=!1})},scope.clearInput=function(){scope.input="",scope.list=[],scope.iSelected=null,scope.tmpLocation=null},scope.handleUpKey=function(){null==scope.iSelected?scope.iSelected=0:0!=scope.iSelected&&(scope.iSelected-=1)},scope.handleDownKey=function(){null==scope.iSelected?scope.iSelected=0:scope.iSelected!=scope.list.length-1&&(scope.iSelected+=1)},scope.handleEscKeys=function(){scope.noLocation?scope.input="":scope.clearInput(),scope.places&&0!=scope.places.length&&(scope.list=angular.copy(scope.places)),console.log(scope.list)},scope.handleEnterKey=function(){null!=scope.tmpLocation&&(scope.location=scope.tmpLocation),null!=scope.iSelected&&scope.select(scope.list[scope.iSelected])},scope.handleQuery=function(value){value.length>=5?(scope.usePlaces=!1,scope.placesAutoComplete(value,function(data){console.log("Google map, autocomplete request for "+value+"..."),console.log(data),scope.list=_.map(data,function(item){return{addressLine2:item.description,place_id:item.place_id}})})):(scope.list=[],scope.usePlaces=!0,console.log("Google map, autocomplete use places..."))},scope.typing=function(e){var key=e.keyCode||e.charCode;if(38==key)return scope.handleUpKey();if(40==key)return scope.handleDownKey();if(13==key)return scope.handleEnterKey();var value=e.target.value;key>=65&&key<=90?value+=e.key:8===key&&(value=value.slice(0,value.length-1)),scope.handleQuery(value)},scope.setSearchRadius=function(cityName){scope.geocode(cityName,function(data){console.log("Google map, autocomplete radius set for "+cityName+"...")})},scope.place=function(placeid,callback){scope.isGoogle?scope.geocoder.geocode({placeId:placeid},function(result,status){"OK"===status&&$timeout(function(){callback({formatted_address:result[0].formatted_address,geometry:{location:{lat:result[0].geometry.location.lat(),lng:result[0].geometry.location.lng()}}})})}):$http.get("/api/googleMaps/place?placeid="+placeid).then(function(response){callback(response.data)})},scope.reverseGeocode=function(lat,lng,callback){$http.get("/api/googleMaps/reverseGeocode?lat="+lat+"&lng="+lng).then(function(response){callback(response.data)})},scope.placesAutoComplete=function(input,callback){if(scope.isGoogle){var query={input:input};scope.loc&&(query.location=scope.loc,query.radius=scope.radius),scope.autocomplete.getPlacePredictions(query,function(predictions,status){status==google.maps.places.PlacesServiceStatus.OK&&$timeout(function(){console.log(predictions),callback(predictions)})})}else scope.debounceTimeout&&$timeout.cancel(scope.debounceTimeout),scope.debounceTimeout=$timeout(function(){$http.get("/api/googleMaps/placesAutoComplete?input="+input).then(function(response){callback(response.data)}),scope.debounceTimeout=null},300)},scope.geocode=function(address,callback){scope.isGoogle?scope.geocoder.geocode({address:address},function(results,status){"OK"===status&&(scope.loc=results[0].geometry.location)}):$http.get("/api/googleMaps/geocode?address="+address).then(function(response){callback(response.data)})},scope.setTrigger=function(){null!=scope.trigger&&scope.trigger.addEventListener("click",function(e){console.log(scope.noLocation,scope.tmpLocation),scope.noLocation?$timeout(function(){null!=scope.tmpLocation?(scope.location=scope.tmpLocation,$timeout(function(){scope.locationChange()})):$timeout(function(){scope.emptyLocation&&scope.emptyLocation()})}):MODAL_LOCATION_ADDRESS&&MODAL_LOCATION_ADDRESS.hide()})},scope.select=function(item){scope.iSelected=null,scope.input.length>0&&item.place_id?scope.place(item.place_id,function(data){scope.location={addressLine2:data.formatted_address,lat:data.geometry.location.lat,lon:data.geometry.location.lng},$timeout(function(){scope.locationChange()})}):(scope.location=item,$timeout(function(){scope.locationChange()}))},scope.setTrigger()}}}]),window.googleMapInitiated=!0)}function initiateGoogleMapAddressModule(){window.googleMapAddressInitiated?(window.googleMapAddressLoaded=!0,app.requires.push("google-map-address")):setTimeout(function(){initiateGoogleMapAddressModule()},50)}function initiateGoogleMapModule(){window.googleMapInitiated?(window.googleMapLoaded=!0,app.requires.push("googleMap")):setTimeout(function(){initiateGoogleMapModule()},50)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}window.fmGetTimeDiff=function(startTime,endTime){var startTime="undefined"!=typeof startTime?startTime:"2014-01-01 01:02:03.123456",endTime="undefined"!=typeof endTime?endTime:new Date,diff=new Date(endTime).getTime()-new Date(startTime).getTime(),msec=diff,hh=Math.floor(msec/1e3/60/60);msec-=1e3*hh*60*60;var mm=Math.floor(msec/1e3/60);msec-=1e3*mm*60;var ss=Math.floor(msec/1e3);return msec-=1e3*ss,hh+":"+mm+":"+ss+":"+msec};var SCROLL_BAR_WIDTH=getScrollBarWidth();!function($){$.fn.carousel=function(images,time,persistAlreadyExistingDOM,banners){function fireGAEvent(category,action,label,value,source){var data={event:"customEvent",category:category,action:action};label&&(data.label=label),value&&(data.value=value),source&&(data.source=source),console.log("---------------GA Event------------","Category:",category,", Action:",action,", Label:",label,", Value:",value,", Source:",source),dataLayer.push(data)}var dist,startX,startY,startTime,self=$(this),dots=($(this),[]),items=[],bottom=null,interval=null,activeDot=0,nextTimeout=null,prevTimeout=null,_prevClear=null,_nextClear=null,intervalNext=null,cooldown=!1,length=0,allowedTime=5e3,threshold=30,that=this;return this.addDots=function(){bottom=$("<div></div>"),bottom.addClass("dots"),self.append(bottom),_.forEach(images,function(image,i){var dot=$("<span></span>");0==i&&dot.addClass("active"),dots.push(dot),bottom.append(dot),dot.bind("click",function(){i>activeDot&&this.next(i),i<activeDot&&this.prev(i)}.bind(this))}.bind(this))},this.addItems=function(){var _getCategoriesMatchedObj=function(collectionIds){var matchedCategories=[];return _.each(collectionIds,function(collectionWithId){var matchedCategory=_.find(window.menu.collections,function(collection){return collectionWithId.id==collection.id});matchedCategory&&matchedCategories.push(matchedCategory)}),{matchedCategories:matchedCategories,isMatcheCategory:matchedCategories.length>0}};_.forEach(images,function(image,i){var itemDom;banners&&banners.length>0&&banners[i]&&(banners[i].cta||"VIDEO"==banners[i].mealType)?(itemDom='<img style="cursor:pointer" src="',"VIDEO"==banners[i].mealType&&($("#fm-banner-video").bind("play",function(e){window.clevertap.event.push("Clicked",{action:"play video"})}),$("#fm-banner-video").bind("pause",function(e){window.clevertap.event.push("Clicked",{action:"pause video"})}),$("#fm-banner-video").bind("ended",function(){window.MODAL_VIDEO_BANNER_POPUP.hide()}))):itemDom=banners&&banners.length>0&&banners[i]&&banners[i].tx&&("CORPORATE_BANNER"==banners[i].tx||"AMAZON_BANNER"==banners[i].tx)?'<img style = "cursor:pointer" src="':'<img src="';var item=$(itemDom+image+'"/>');item.addClass("item"),0==i&&item.addClass("active"),items.push(item),self.append(item),item.on("click",function(){if(fireGAEvent("Menu","click","banner",i,banners[i].cta?banners[i].cta.productId:null),banners&&banners.length>0&&banners[i]&&banners[i].cta){var categoryMatchedObj=_getCategoriesMatchedObj(banners[i].cta.categoryId);categoryMatchedObj.isMatcheCategory?angular.element(document.getElementById("mainController")).scope().setCollection(categoryMatchedObj.matchedCategories[0]):banners[i].cta.productId&&angular.element(document.getElementById("mainController")).scope().handleProductDetailsDisplayForBanner(banners[i].cta.productId)}banners&&banners.length>0&&banners[i]&&banners[i].tx&&"CORPORATE_BANNER"==banners[i].tx&&angular.element(document.getElementById("mainController")).scope().redirectToCorporate(),banners&&banners.length>0&&banners[i]&&banners[i].tx&&"AMAZON_BANNER"==banners[i].tx&&angular.element(document.getElementById("mainController")).scope().redirectToAmazonPage(),banners&&banners.length>0&&banners[i]&&banners[i].cta&&banners[i].cta.pageId&&"16"==banners[i].cta.pageId&&angular.element(document.getElementById("mainController")).scope().redirectToClub(),banners&&banners.length>0&&banners[i]&&banners[i].mealType&&"VIDEO"==banners[i].mealType&&(angular.element(document.getElementById("mainController")).scope().setVideoBannerIndex(i),window.MODAL_VIDEO_BANNER_POPUP.show())}),item.on("touchstart",function(e){var touchobj=e.originalEvent.changedTouches[0];dist=0,startX=touchobj.pageX,startY=touchobj.pageY,startTime=(new Date).getTime()}),item.on("touchend",function(e){var touchobj=e.originalEvent.changedTouches[0];dist=touchobj.pageX-startX;var elapsedTime=(new Date).getTime()-startTime;if(elapsedTime<=allowedTime&&Math.abs(dist)>=threshold&&Math.abs(touchobj.pageY-startY)<=100){var swiperightBol=dist>0;if(e.preventDefault(),images.length<2)return;swiperightBol?i-1>=0&&(clearInterval(interval),that.prev(i-1)):i+1<images.length&&(that.next(i+1),clearInterval(interval))}})})},this.preload=function(callback){var i=0;$(images).each(function(){var img=$("<img/>")[0];img.onload=function(){i++,i==images.length&&callback()},img.src=this})},this.setCooldown=function(){cooldown=!0,setTimeout(function(){cooldown=!1},1e3)},this.next=function(i){cooldown||(this.setCooldown(),this.clearAll(),setTimeout(function(){var current=activeDot;_.isUndefined(i)?activeDot++:activeDot=i,activeDot==length&&(activeDot=0),bottom.find("span.active").removeClass("active"),bottom.children("span").eq(activeDot).addClass("active");var item=self.children("img.item").eq(current),next=self.children("img.item").eq(activeDot);next.addClass("next"),setTimeout(function(){item.addClass("left"),next.addClass("left")},10),_nextClear=function(){item.removeClass("active"),item.removeClass("left"),next.removeClass("left"),next.removeClass("next"),next.addClass("active"),item.css("position",""),_nextClear=null},setTimeout(function(){_nextClear&&_nextClear()}.bind(this),1050)}.bind(this)))},this.prev=function(i){cooldown||(this.setCooldown(),this.clearAll(),setTimeout(function(){var current=activeDot;_.isUndefined(i)?activeDot--:activeDot=i,activeDot<0&&(activeDot=length-1),bottom.find("span.active").removeClass("active"),bottom.children("span").eq(activeDot).addClass("active");var item=self.children("img.item").eq(current),prev=self.children("img.item").eq(activeDot);prev.addClass("prev"),setTimeout(function(){item.addClass("right"),prev.addClass("right")},1),_prevClear=function(){item.removeClass("active"),item.removeClass("right"),prev.removeClass("right"),prev.removeClass("prev"),prev.addClass("active"),item.css("position",""),_prevClear=null},prevTimeout=setTimeout(function(){_prevClear()}.bind(this),1050)}.bind(this)))},this.clearNext=function(){_.isNull(nextTimeout)||_.isNull(_nextClear)||(clearTimeout(nextTimeout),_nextClear())},this.clearPrev=function(){_.isNull(prevTimeout)||_.isNull(_prevClear)||(clearTimeout(prevTimeout),_prevClear())},this.clearAll=function(){this.clearNext(),this.clearPrev()},this.setInterval=function(){self.removeClass("loading"),self.addClass("preloaded"),intervalNext=function(){this.next()}.bind(this),interval=setInterval(intervalNext,time),window.carouselIntervalFnId=interval},this.addNav=function(){var navLeft=$("<div></div>"),navRight=$("<div></div>");navLeft.addClass("carousel-nav"),navLeft.addClass("left"),navRight.addClass("carousel-nav"),navRight.addClass("right"),self.parent().append(navLeft),self.parent().append(navRight),navLeft.on("click",function(){this.prev(),fireGAEvent("Menu","click","banner_backward_swipe"),clearInterval(interval)}.bind(this)),navRight.on("click",function(){this.next(),fireGAEvent("Menu","click","banner_forward_swipe"),clearInterval(interval)}.bind(this))},this.init=function(){_.isNull(images)?(length=self.children("img.item").length,bottom=self.find("div.dots"),window.carouselIntervalFnId&&(clearInterval(window.carouselIntervalFnId),window.carouselIntervalFnId=0),length>1&&this.addNav(),length>1&&this.setInterval()):($(self).find(".item").remove(),$(self).find("img").remove(),length=images.length,this.addItems(),length>1&&this.addDots(),length>1&&this.addNav(),window.carouselIntervalFnId&&(clearInterval(window.carouselIntervalFnId),window.carouselIntervalFnId=0),this.preload(function(){length>1&&this.setInterval()}.bind(this)))},self.length&&!persistAlreadyExistingDOM&&(self.find(".item").remove(),self.find(".dots").remove(),self.parent().find(".carousel-nav").remove()),(self.length||persistAlreadyExistingDOM)&&this.init(),this}}(jQuery),function($){$.fn.fmCommonCarousel=function(images,time,persistAlreadyExistingDOM,banners){var self=$(this),dots=($(this),[]),bottom=null,interval=null,activeDot=0,nextTimeout=null,prevTimeout=null,_prevClear2=null,_nextClear2=null,intervalNext=null,cooldown=!1,length=0;return this.addDots=function(){bottom=$("<div></div>"),bottom.addClass("dots"),self.append(bottom),_.forEach(images,function(image,i){var dot=$("<span></span>");0==i&&dot.addClass("active"),dots.push(dot),bottom.append(dot),dot.bind("click",function(){i>activeDot&&this.next(i),i<activeDot&&this.prev(i)}.bind(this))}.bind(this))},this.setCooldown=function(){cooldown=!0,setTimeout(function(){cooldown=!1},1e3)},this.next=function(i){cooldown||(this.setCooldown(),this.clearAll(),setTimeout(function(){var current=activeDot;_.isUndefined(i)?activeDot++:activeDot=i,activeDot==length&&(activeDot=0),bottom.find("span.active").removeClass("active"),bottom.children("span").eq(activeDot).addClass("active");var item=self.children(".item").eq(current),next=self.children(".item").eq(activeDot);next.addClass("next"),setTimeout(function(){item.addClass("left"),next.addClass("left")},10),_nextClear2=function(){item.removeClass("active"),item.removeClass("left"),next.removeClass("left"),next.removeClass("next"),next.addClass("active"),item.css("position",""),_nextClear2=null},setTimeout(function(){_nextClear2&&_nextClear2()}.bind(this),1050)}.bind(this)))},this.prev=function(i){cooldown||(this.setCooldown(),this.clearAll(),setTimeout(function(){var current=activeDot;_.isUndefined(i)?activeDot--:activeDot=i,activeDot<0&&(activeDot=length-1),bottom.find("span.active").removeClass("active"),bottom.children("span").eq(activeDot).addClass("active");var item=self.children(".item").eq(current),prev=self.children(".item").eq(activeDot);prev.addClass("prev"),setTimeout(function(){item.addClass("right"),prev.addClass("right")},1),_prevClear2=function(){item.removeClass("active"),item.removeClass("right"),prev.removeClass("right"),prev.removeClass("prev"),prev.addClass("active"),item.css("position",""),_prevClear2=null},prevTimeout=setTimeout(function(){_prevClear2()}.bind(this),1050)}.bind(this)))},this.clearNext=function(){_.isNull(nextTimeout)||_.isNull(_nextClear2)||(clearTimeout(nextTimeout),_nextClear2())},this.clearPrev=function(){_.isNull(prevTimeout)||_.isNull(_prevClear2)||(clearTimeout(prevTimeout),_prevClear2())},this.clearAll=function(){this.clearNext(),this.clearPrev()},this.setInterval=function(){self.removeClass("loading"),self.addClass("preloaded"),intervalNext=function(){this.next()}.bind(this),interval=setInterval(intervalNext,time),window.carouselIntervalFnId=interval},this.addNav=function(){var navLeft=$("<div></div>"),navRight=$("<div></div>");navLeft.addClass("carousel-nav"),navLeft.addClass("left"),navRight.addClass("carousel-nav"),navRight.addClass("right"),self.parent().append(navLeft),self.parent().append(navRight),navLeft.on("click",function(){this.prev(),clearInterval(interval)}.bind(this)),navRight.on("click",function(){this.next(),clearInterval(interval)}.bind(this))},this.init=function(){length=self.children("img.item").length?self.children("img.item").length:self.children(".item").length,bottom=self.find("div.dots"),window.carouselIntervalFnId&&(clearInterval(window.carouselIntervalFnId),window.carouselIntervalFnId=0),length>1&&this.addNav(),length>1&&this.setInterval()},self.length&&!persistAlreadyExistingDOM&&(self.find(".item").remove(),self.find(".dots").remove(),self.find(".carousel-nav").remove()),(self.length||persistAlreadyExistingDOM)&&this.init(),this}}(jQuery),function($){$.fn.keepAtWindowHeight=function(callback){var self=this,element=$(this);return this.setHeight=function(){element.css("height",$(window).height()-200+"px"),callback&&callback()},$(window).bind("resize",function(){self.setHeight()}),this.setHeight(),this}}(jQuery),function($){$.fn.menu=function(toggle,isSideMenu,noOverlay){var self=this;return this.menu=$(this),this.isSideMenu=isSideMenu,this.noOverlay=noOverlay,this.trigger=void 0,this.openCallbacks=[],this.closeCallbacks=[],$(toggle).click(function(e){e.preventDefault(),self.toggle(this)}),this.show=function(trigger){var self=this;setTimeout(function(){self.menu.hasClass("dark-overlay")&&$(".overlay").addClass("dark-overlay"),_.forEach(self.openCallbacks,function(action){action(self.el)}),$(self).addClass("transition"),$("html").css("overflow","hidden"),$("html").css("padding-right",SCROLL_BAR_WIDTH+"px"),$(".gradient nav").css("padding-right",SCROLL_BAR_WIDTH+10+"px"),self.isSideMenu?$(".overlay").bind("click",self.hide):($(self).css("margin-right","-"+SCROLL_BAR_WIDTH+"px"),$("html").scrollTop(0),$("body").scrollTop(0),_.isUndefined(trigger)||($(trigger).addClass("hovered"),$(trigger).closest("nav").addClass("in-front"),self.trigger=trigger)),self.noOverlay||$(".overlay").addClass("active"),self.menu.addClass("open")},5)},this.hide=function(trigger,callback){self.menu.hasClass("open")&&(self.menu.hasClass("dark-overlay")&&$(".overlay").removeClass("dark-overlay"),_.forEach(self.closeCallbacks,function(action){action()}),self.menu.removeClass("open"),$(".overlay").removeClass("active"),$(".overlay").unbind("click",this.hide),setTimeout(function(){$("html").css("padding-right",""),$(self).css("margin-right",""),$(".gradient nav").css("padding-right",""),$("html").css("overflow",""),_.isUndefined(trigger)||($(self.trigger).removeClass("hovered"),$(self.trigger).closest("nav").removeClass("in-front"),self.trigger=void 0),callback&&callback()},300))},this.toggle=function(trigger){self.menu.hasClass("open")?this.hide(trigger):this.show(trigger)},this}}(jQuery),function($){$.fn.setToWidowHeight=function(){return this.height(window.innerHeight),this}}(jQuery),function($){$.fn.addClassWhenInView=function(trigger,cls){var self=this;return this.checkScroll=function(){$(trigger).offset()&&(console.log($(trigger).offset()),$("body").scrollTop()+$(window).height()-$(trigger).offset().top<0?$(self).addClass(cls):$(self).removeClass(cls))},$(window).bind("scroll",function(){self.checkScroll()}),self.checkScroll(),this}}(jQuery),function($){$.fn.fixedOnScroll=function(attr,top){var self=this;return this.el=$(this),this.fixed=!1,this.initialScroll=top?top:this.el.offset()?this.el.offset().top:0,this.placeholder=$("<div></div>"),this.hasAttr=document.body.hasAttribute(attr),this.getOffsetTop=function(){return this.fixed?this.placeholder.offset()?this.placeholder.offset().top:0:this.el.offset()?this.el.offset().top:0},this.checkScroll=function(){this.hasAttr||($(document).scrollTop()>this.getOffsetTop()?this.fixed||(this.fixed=!0,this.el.addClass("fixed"),this.addPlaceholder()):this.fixed&&(this.fixed=!1,this.el.removeClass("fixed"),this.removePlaceholder()))},this.setScrollEvent=function(){$(window).scroll(function(){self.checkScroll()})},this.addPlaceholder=function(){this.placeholder.height(this.el.outerHeight()),this.el.before(this.placeholder)},this.removePlaceholder=function(){this.placeholder.remove()},this.setScrollEvent(),this.checkScroll(),this}}(jQuery),function($){$.fn.femuToggleClass=function(cls,closeOnBlur){var self=this;return this.el=$(this),this.show=function(){this.el.addClass(cls)},this.hide=function(){this.el.removeClass(cls)},this.toggle=function(){this.el.hasClass(cls)?this.hide():this.show()},closeOnBlur&&$(window).click(function(){self.hide()}),this.el.click(function(e){self.toggle(),e.stopPropagation(),e.preventDefault()}),this}}(jQuery),function($){$.fn.femuToggleClassForNav=function(cls,closeOnBlur){var self=this;return this.el=$(this),this.show=function(){this.el.addClass(cls)},this.hide=function(){this.el.removeClass(cls)},this.toggle=function(){this.el.hasClass(cls)?this.hide():this.show()},closeOnBlur&&(this.el.click(function(e){e.stopPropagation()}),$(window).click(function(){self.hide()})),this.el.click(function(e){self.toggle()}),this}}(jQuery),function($){$.fn.modal=function(toggleTrigger){function closeModalOnEsc(e){27===e.keyCode&&self.hide()}var self=this;return this.el=$(this),this.modalOverlayCloseEventActions=[],this.closeCallbacks=[],this.openCallbacks=[],this.show=function(){setTimeout(function(){self.el.find("input")[0]&&self.el.find("input")[0].focus()}),_.forEach(self.openCallbacks,function(action){action(self.el)}),$("html").css("padding-right",SCROLL_BAR_WIDTH+"px"),$(".gradient nav").css("padding-right",SCROLL_BAR_WIDTH+10+"px"),$("html").css("overflow","hidden"),$(this).addClass("open"),$(".overlay").addClass("active"),this.hasClass("no-overlay-close")||"#video-banner-popup"==$(this).selector||$(this).bind("click",this.hide).children().click(function(e){return"mailto:order@freshmenu.com?subject=support"==$(e.target).attr("href")||"/terms-and-conditions"==$(e.target).attr("href")||"/privacy-policy"==$(e.target).attr("href")}),window.document.addEventListener("keydown",closeModalOnEsc)},this.hide=function(keepOverlay,fromTrigger){$(this).removeClass("open"),$(this).unbind("click",this.hide),"boolean"==typeof keepOverlay&&keepOverlay||($("html").css("padding-right",""),$(".gradient nav").css("padding-right",""),$("html").css("overflow",""),$(".overlay").removeClass("active")),1!=fromTrigger&&_.forEach(self.modalOverlayCloseEventActions,function(action){action(self.el)}),_.forEach(self.closeCallbacks,function(action){action()}),window.document.removeEventListener("keydown",closeModalOnEsc)},this.toggle=function(keepOverlay,fromTrigger){this.el.hasClass("open")?this.hide(keepOverlay,fromTrigger):self.show()},$(toggleTrigger).click(function(e){e.preventDefault(),self.toggle($(e.target).hasClass("keep-overlay"),!0)}),this}}(jQuery),window.loadExternalScripts=function(){},$(document).ready(function(){$(document).click(function(e){if(0==$(e.target).closest("div#fm-filter-by-desktop").length){var scope=angular.element(document.getElementById("mainController")).scope();void 0!==scope&&scope.$apply(function(){scope.toggleFmFilterState=!1})}e.target&&e.target.classList&&e.target.classList.value&&e.target.classList.value.split(" ").indexOf("logged-in-nav-bar")<0&&e.target.classList.value.split(" ").indexOf("fm-header-name")<0&&e.target.classList.value.split(" ").indexOf("fm-name-header")<0&&e.target.classList.value.split(" ").indexOf("fm-down-arrow")<0&&$("#user-dropdown").removeClass("active")})}),$(window).scroll(function(){$("#user-dropdown").removeClass("active")}),angular.module("tabComponents",[]).directive("tabs",function(){return{restrict:"E",transclude:!0,scope:!1,controller:["$scope",function($scope){var panes=$scope.panes=[];$scope.select=function(pane,initializing){initializing||$scope.isProductDetailsPopupOpened&&$scope.addCleverTapEvent("Clicked",{action:pane.title,screenName:"Product detail"}),angular.forEach(panes,function(pane){pane.selected=!1}),pane.selected=!0},this.addPane=function(pane){0==panes.length&&$scope.select(pane,!0),panes.push(pane)},$scope.$watch("product_details",function(newValue,oldValue){0!=$scope.panes.length&&$scope.select($scope.panes[0],!0)},!0)}],template:'<div class="tabbable"><ul><li ng-repeat="pane in panes" ng-class="{active:pane.selected}"><a href="" ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" ng-transclude></div></div>',replace:!0}}).directive("pane",function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(scope,element,attrs,tabsCtrl){tabsCtrl.addPane(scope)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}),angular.module("angular-preload-image",[]),angular.module("angular-preload-image").factory("preLoader",function(){return function(url,successCallback,errorCallback){angular.element(new Image).bind("load",function(){successCallback()}).bind("error",function(){errorCallback()}).attr("src",url)}}),angular.module("angular-preload-image").directive("preloadImage",["preLoader",function(preLoader){return{restrict:"A",terminal:!0,priority:100,link:function(scope,element,attrs){var url=attrs.ngSrc;scope.default=attrs.defaultImage||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wEWEygNWiLqlwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=",attrs.$set("src",scope.default),preLoader(url,function(){attrs.$set("src",url)},function(){void 0!=attrs.fallbackImage&&attrs.$set("src",attrs.fallbackImage)})}}}]),angular.module("angular-preload-image").directive("preloadBgImage",["preLoader",function(preLoader){return{restrict:"A",link:function(scope,element,attrs){void 0!=attrs.preloadBgImage&&(element.addClass("loading"),preLoader(attrs.preloadBgImage,function(){element.css({"background-image":'url("'+attrs.preloadBgImage+'")'}),element.addClass("preloaded"),element.removeClass("loading")},function(){element.addClass("show-alt"),void 0!=attrs.fallbackImage&&element.css({"background-image":'url("'+attrs.fallbackImage+'")'})}))}}}]);var duration=50;angular.module("autocomplete",[]).directive("autocomplete",["$timeout","$http","$localstorage","$interval",function($timeout,$http,$localstorage,$interval){return $(".temp-location-mobile-bar").hide(),{restrict:"E",scope:{selectGoogleEvent:"&",selectNormalEvent:"&",unselectEvent:"&",list:"=",showLabel:"&",focused:"=",googleMapControl:"=",initialValue:"=",customSelected:"=success",showDropdown:"=",recentlyViewed:"=",citySelected:"=",defaultMenu:"=",city:"="},replace:!0,template:'<div><div class="bar"><div class="view-menu" ng-click="openAddressModal()"><div class = "upperHeading" ng-if = "_getLocation()">Viewing Menu for</div><div class = "upperHeading" ng-if = "!_getLocation()">Change Location</div><div class="arrow" ng-cloak><span>{{_getLocation()}}</span></div></div><div class="search" style="display:none;" ng-hide="productDetailPage"><input type="text" name="{{name}}" ng-model="query" ng-required="required" placeholder="{{placeholder}}"></div></div><div class="options" style="display:none;" ng-if="show"><ul><li class="divider" ng-if="recentlyViewed"> Recently Viewed</li><li ng-click="selectEvent(recentlyViewed)" ng-if="recentlyViewed"><span ng-if="recentlyViewed.label"><strong>{{recentlyViewed.label}}</strong>, </span>{{showLabel({object:recentlyViewed})}}</li><li class="divider" ng-if="list.length>0">{{dividerText}}</li><li ng-repeat="item in list" ng-click="selectEvent(item, $event)"><span ng-if="item.label"><strong>{{item.label}}</strong>, </span>{{showLabel({object:item})}}</li></ul></div></div>',
link:function(scope,elm,attrs,ctrl){function autocompleteTimer(){"undefined"!=typeof google&&(autocompleteStopFunction(),scope.run())}function autocompleteStopFunction(){clearInterval(autoCompleteTimerId)}console.log("############### autocomplete.js"),scope.input=elm.find("input"),scope.list=[],scope.productDetailPage=document.body.hasAttribute("product-detail-page"),scope.query="",scope.placeholder=attrs.placeholder,scope.name=attrs.name,scope.required=!!attrs.required,scope.show=!1,scope.customSelected=!1,scope.dividerText=attrs.dividerText||"",scope.openAddressModal=function(){PRODUCT_DETAILS_POPUP&&PRODUCT_DETAILS_POPUP.hide(),MODAL_LOCATION_ADDRESS.show()},scope.setPacContainerStyle=function(){$(".pac-container").css("z-index",""),$(".pac-container").css("box-shadow","")},scope._getLocation=function(){var location=scope.$parent.location.addressLine2?scope.$parent.location.addressLine2:scope.query?scope.query:scope.city;return location},scope.$watch("citySelected",function(newVal,oldVal){if(newVal){var ne=_.map(newVal.northEastPoint.split(","),function(str){return Number(str)}),sw=_.map(newVal.southWestPoint.split(","),function(str){return Number(str)}),southWest=new google.maps.LatLng(sw[0],sw[1]),northEast=new google.maps.LatLng(ne[0],ne[1]),bounds=new google.maps.LatLngBounds(southWest,northEast);console.log(ne,sw,bounds),scope.autocomplete&&scope.autocomplete.setBounds&&scope.autocomplete.setBounds(bounds)}}),scope.useCurrentLocation=function(){},scope.setObservers=function(){attrs.$observe("value",function(val){val&&(scope.query=val,scope.customSelected=!0)}),attrs.$observe("dividerText",function(val){scope.dividerText=val}),scope.$watch("initialValue",function(val){val?scope.query=val:scope.query=""}),scope.$watch("query",function(newVal,oldVal){newVal||(scope.setPacContainerStyle(),scope.query="")})},scope.$watch("showDropdown",function(newValue,oldValue){1==newValue&&$timeout(function(){scope.showDropdown=!1,scope.show=!0},100)}),scope.$watch("clear",function(newValue,oldValue){1==newValue&&(scope.query=""),scope.clear=!1}),scope.selectEvent=function(item,$event){scope.customSelected=!0,scope.query=scope.showLabel({object:item}),scope.selectNormalEvent({object:item})},scope.setAutoCompleteBound=function(){if(scope.city&&scope.city.northEastPoint){var ne=scope.city.northEastPoint.split(","),sw=scope.city.southWestPoint.split(","),cityBound=new google.maps.LatLngBounds(new google.maps.LatLng(sw[0],sw[1]),new google.maps.LatLng(ne[0],ne[1]));scope.autocomplete&&scope.autocomplete.setBounds(cityBound)}},scope.setGoogleAutocompleteEvents=function(){var options={componentRestrictions:{country:"in"}};scope.autocomplete=new google.maps.places.Autocomplete(scope.input[0],options),google.maps.event.addListener(scope.autocomplete,"place_changed",function(){scope.customSelected=!0,scope.oldQuery=void 0,scope.selectGoogleEvent({result:scope.autocomplete.getPlace()})}),$(window).scroll(function(){$(scope.input[0]).blur()})},scope.setInputEvents=function(){scope.input.bind("focus",function(){$timeout(function(){scope.focused=!0})}),scope.input.bind("click",function(){$timeout(function(){scope.customSelected=!1,scope.oldQuery=scope.query,scope.query="",scope.unselectEvent()})}),scope.input.bind("blur",function(){$timeout(function(){scope.oldQuery&&!scope.query&&(scope.query=scope.oldQuery,scope.oldQuery=void 0)})}),scope.input.bind("keydown",function(){var key=event.keyCode||event.charCode;$timeout(function(){8!=key&&46!=key&&27!=key||!scope.customSelected||(scope.customSelected=!1,scope.query="",scope.unselectEvent()),0==scope.query.length?scope.show=!0:scope.show=!1})}),document.documentElement.addEventListener("click",function(e){for(var x=e.target,ok=e.target===elm[0];x=x.parentElement;)x===elm[0]&&(ok=!0);$timeout(function(){ok?scope.show?scope.show=!1:0==scope.query.length&&!_.isUndefined(scope.list)&&scope.list.length>0&&(scope.show=!0,scope.focused=!0):scope.show=!1})})},scope.run=function(){scope.setObservers(),scope.setGoogleAutocompleteEvents(),scope.setInputEvents()};var autoCompleteTimerId=setInterval(function(){autocompleteTimer()},duration)}}}]),angular.module("sync-value",[]).directive("syncValue",[function(){return{scope:{syncValue:"=",trigger:"&"},restrict:"A",link:function(scope,element,attrs){scope.$watch("syncValue",function(newValue,oldValue){newValue&&element.val(newValue)}),element.bind("change",function(){scope.$apply(function(){scope.trigger({value:element.val()}),"bulk"==element.val()&&element.val("15")})})}}}]),angular.module("onFinishRender",[]).directive("onFinishRender",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("ngRepeatFinished")})}}}]),function(window,angular,undefined){"use strict";function $SanitizeProvider(){this.$get=["$$sanitizeUri",function($$sanitizeUri){return function(html){var buf=[];return htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe/.test($$sanitizeUri(uri,isImage))})),buf.join("")}}]}function sanitizeText(chars){var buf=[],writer=htmlSanitizeWriter(buf,angular.noop);return writer.chars(chars),buf.join("")}function makeMap(str,lowercaseKeys){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[lowercaseKeys?angular.lowercase(items[i]):items[i]]=!0;return obj}function htmlParser(html,handler){function parseStartTag(tag,tagName,rest,unary){if(tagName=angular.lowercase(tagName),blockElements[tagName])for(;stack.last()&&inlineElements[stack.last()];)parseEndTag("",stack.last());optionalEndTagElements[tagName]&&stack.last()==tagName&&parseEndTag("",tagName),unary=voidElements[tagName]||!!unary,unary||stack.push(tagName);var attrs={};rest.replace(ATTR_REGEXP,function(match,name,doubleQuotedValue,singleQuotedValue,unquotedValue){var value=doubleQuotedValue||singleQuotedValue||unquotedValue||"";attrs[name]=decodeEntities(value)}),handler.start&&handler.start(tagName,attrs,unary)}function parseEndTag(tag,tagName){var i,pos=0;if(tagName=angular.lowercase(tagName))for(pos=stack.length-1;pos>=0&&stack[pos]!=tagName;pos--);if(pos>=0){for(i=stack.length-1;i>=pos;i--)handler.end&&handler.end(stack[i]);stack.length=pos}}"string"!=typeof html&&(html=null===html||"undefined"==typeof html?"":""+html);var index,chars,match,text,stack=[],last=html;for(stack.last=function(){return stack[stack.length-1]};html;){if(text="",chars=!0,stack.last()&&specialElements[stack.last()]?(html=html.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+stack.last()+"[^>]*>","i"),function(all,text){return text=text.replace(COMMENT_REGEXP,"$1").replace(CDATA_REGEXP,"$1"),handler.chars&&handler.chars(decodeEntities(text)),""}),parseEndTag("",stack.last())):(0===html.indexOf("<!--")?(index=html.indexOf("--",4),index>=0&&html.lastIndexOf("-->",index)===index&&(handler.comment&&handler.comment(html.substring(4,index)),html=html.substring(index+3),chars=!1)):DOCTYPE_REGEXP.test(html)?(match=html.match(DOCTYPE_REGEXP),match&&(html=html.replace(match[0],""),chars=!1)):BEGING_END_TAGE_REGEXP.test(html)?(match=html.match(END_TAG_REGEXP),match&&(html=html.substring(match[0].length),match[0].replace(END_TAG_REGEXP,parseEndTag),chars=!1)):BEGIN_TAG_REGEXP.test(html)&&(match=html.match(START_TAG_REGEXP),match?(match[4]&&(html=html.substring(match[0].length),match[0].replace(START_TAG_REGEXP,parseStartTag)),chars=!1):(text+="<",html=html.substring(1))),chars&&(index=html.indexOf("<"),text+=index<0?html:html.substring(0,index),html=index<0?"":html.substring(index),handler.chars&&handler.chars(decodeEntities(text)))),html==last)throw $sanitizeMinErr("badparse","The sanitizer was unable to parse the following block of html: {0}",html);last=html}parseEndTag()}function decodeEntities(value){return value?(hiddenPre.innerHTML=value.replace(/</g,"&lt;"),hiddenPre.textContent):""}function encodeEntities(value){return value.replace(/&/g,"&amp;").replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0),low=value.charCodeAt(1);return"&#"+(1024*(hi-55296)+(low-56320)+65536)+";"}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return"&#"+value.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlSanitizeWriter(buf,uriValidator){var ignore=!1,out=angular.bind(buf,buf.push);return{start:function(tag,attrs,unary){tag=angular.lowercase(tag),!ignore&&specialElements[tag]&&(ignore=tag),ignore||validElements[tag]!==!0||(out("<"),out(tag),angular.forEach(attrs,function(value,key){var lkey=angular.lowercase(key),isImage="img"===tag&&"src"===lkey||"background"===lkey;validAttrs[lkey]!==!0||uriAttrs[lkey]===!0&&!uriValidator(value,isImage)||(out(" "),out(key),out('="'),out(encodeEntities(value)),out('"'))}),out(unary?"/>":">"))},end:function(tag){tag=angular.lowercase(tag),ignore||validElements[tag]!==!0||(out("</"),out(tag),out(">")),tag==ignore&&(ignore=!1)},chars:function(_chars){ignore||out(encodeEntities(_chars))}}}var $sanitizeMinErr=angular.$$minErr("$sanitize"),START_TAG_REGEXP=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,END_TAG_REGEXP=/^<\/\s*([\w:-]+)[^>]*>/,ATTR_REGEXP=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,BEGIN_TAG_REGEXP=/^</,BEGING_END_TAGE_REGEXP=/^<\//,COMMENT_REGEXP=/<!--(.*?)-->/g,DOCTYPE_REGEXP=/<!DOCTYPE([^>]*?)>/i,CDATA_REGEXP=/<!\[CDATA\[(.*?)]]>/g,SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g,voidElements=makeMap("area,br,col,hr,img,wbr"),optionalEndTagBlockElements=makeMap("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),optionalEndTagInlineElements=makeMap("rp,rt"),optionalEndTagElements=angular.extend({},optionalEndTagInlineElements,optionalEndTagBlockElements),blockElements=angular.extend({},optionalEndTagBlockElements,makeMap("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),inlineElements=angular.extend({},optionalEndTagInlineElements,makeMap("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),svgElements=makeMap("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan,use"),specialElements=makeMap("script,style"),validElements=angular.extend({},voidElements,blockElements,inlineElements,optionalEndTagElements,svgElements),uriAttrs=makeMap("background,cite,href,longdesc,src,usemap,xlink:href"),htmlAttrs=makeMap("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),svgAttrs=makeMap("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",!0),validAttrs=angular.extend({},uriAttrs,svgAttrs,htmlAttrs),hiddenPre=document.createElement("pre");angular.module("ngSanitize",[]).provider("$sanitize",$SanitizeProvider),angular.module("ngSanitize").filter("linky",["$sanitize",function($sanitize){var LINKY_URL_REGEXP=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,MAILTO_REGEXP=/^mailto:/;return function(text,target){function addText(text){text&&html.push(sanitizeText(text))}function addLink(url,text){html.push("<a "),angular.isDefined(target)&&html.push('target="',target,'" '),html.push('href="',url.replace(/"/g,"&quot;"),'">'),addText(text),html.push("</a>")}if(!text)return text;for(var match,url,i,raw=text,html=[];match=raw.match(LINKY_URL_REGEXP);)url=match[0],match[2]||match[4]||(url=(match[3]?"http://":"mailto:")+url),i=match.index,addText(raw.substr(0,i)),addLink(url,match[0].replace(MAILTO_REGEXP,"")),raw=raw.substring(i+match[0].length);return addText(raw),$sanitize(html.join(""))}}])}(window,window.angular),initiateGoogleMap(),angular.module("google-address-search",[]).directive("googleAddressSearch",["$timeout","$interval",function($timeout){return{restrict:"E",scope:{showErrorMessage:"="},replace:!0,template:'<div class="fm-gas-input"><div style="padding: 15px;top: 0px;position:  absolute;" ng-click="back()"><div class="fm-gas-back" style="position: unset;transform: none;"></div></div><input type="text" ng-click="handleEscKeys();" ng-keydown="typing($event)" ng-model="query" placeholder="{{placeholder}}"/><span ng-show="showErrorMessage" style="border-top: solid 1px #e7e9e9;color: red; font-size: 14px; position: fixed; bottom: 54px; left: 0px; background: white; text-align: center; padding-top: 5px; padding-bottom: 5px;">Unable to fetch your current location. Please type the location</span><button ng-disabled="loading" ng-click="locateMe()">{{buttonLabel}}</button><div class="fm-gas-options" ng-if="show && places.length>0"><ul><li ng-class="{\'selected\': isSelected($index)}" ng-repeat="item in places" ng-click="selectAddress(item)">{{item.addressLine2}}</li></ul></div><img src="/pages/menu/images/powered-by-google.png" style="margin: 15px 15px 10px;"></div>',link:function(scope,elm,attrs,ctrl){scope.autocomplete=new google.maps.places.AutocompleteService,scope.geocoder=new google.maps.Geocoder,scope.eventPrefix=attrs.eventPrefix?attrs.eventPrefix:"fm-gas",scope.loading=!1,scope.iSelected=null,scope.placeholder="Enter min 5 characters to search your location",scope.buttonLabel="Use Current Location",scope.showErrorMessage=!1,scope.modalOpened=!1,attrs.$observe("placeholder",function(value){scope.placeholder=value}),attrs.$observe("buttonLabel",function(value){scope.buttonLabel=value}),scope.isSelected=function(i){return scope.iSelected==i},scope.clearInput=function(){scope.query="",scope.places=[],scope.iSelected=null},scope.handleUpKey=function(){null==scope.iSelected?scope.iSelected=0:0!=scope.iSelected&&(scope.iSelected-=1)},scope.handleDownKey=function(){null==scope.iSelected?scope.iSelected=0:scope.iSelected!=scope.places.length-1&&(scope.iSelected+=1)},scope.handleEscKeys=function(){scope.clearInput(),scope.list&&0!=scope.list.length?(scope.useSavedA=!0,scope.show=!0,scope.places=angular.copy(scope.list)):scope.show=!1},scope.handleEnterKey=function(){null!=scope.iSelected?scope.select(scope.places[scope.iSelected]):scope.select(scope.places[0])},scope.handleQuery=function(value){value.length>=5?scope.placesAutoComplete(value,function(data){scope.show=!0,scope.places=_.map(data,function(item){return{addressLine2:item.description,place_id:item.place_id}})}):scope.places=[]},scope.typing=function(e){var key=e.keyCode||e.charCode;if(38==key)return scope.handleUpKey();if(40==key)return scope.handleDownKey();if(13==key)return scope.handleEnterKey();var value=e.target.value;key>=65&&key<=90?value+=e.key:8===key&&(value=value.slice(0,value.length-1)),scope.handleQuery(value)},scope.placesAutoComplete=function(input,callback){var query={input:input,componentRestrictions:{country:"in"}};scope.autocomplete.getPlacePredictions(query,function(predictions,status){status==google.maps.places.PlacesServiceStatus.OK&&$timeout(function(){callback(predictions)})})},scope.geocode=function(query,callback){scope.geocoder.geocode(query,function(results,status){callback(results)})},scope.place=function(placeid,callback){scope.geocode({placeId:placeid},function(results,status){$timeout(function(){callback({addressLine2:results[0].formatted_address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()})})})},"undefined"!=typeof MODAL_LOCATION_ADDRESS&&(window.MODAL_LOCATION_ADDRESS.openCallbacks.push(function(){scope.modalOpened=!0}),window.MODAL_LOCATION_ADDRESS.closeCallbacks.push(function(){scope.modalOpened=!1})),scope.locateMe=function(){scope.showErrorMessage=!1,thirdPartyApp&&"spot"==thirdPartyApp&&microapps&&microapps.getCurrentLocation?microapps.getCurrentLocation().then(function(response){console.log("getCurrentLocation response: ",response),scope.geocode({latLng:new google.maps.LatLng(response.latitude,response.longitude)},function(results){$timeout(function(){scope.loading=!1,scope.emitUpdate({addressLine2:results[0].formatted_address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()})})})}).catch(function(error){$timeout(function(){scope.loading=!1,scope.showErrorMessage=!0}),console.log("response:",error)}):navigator.geolocation?(scope.loading=!0,navigator.geolocation.getCurrentPosition(function(position){scope.geocode({latLng:new google.maps.LatLng(position.coords.latitude,position.coords.longitude)},function(results){$timeout(function(){scope.loading=!1,scope.emitUpdate({addressLine2:results[0].formatted_address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()})})})},function(response){$timeout(function(){scope.loading=!1,scope.showErrorMessage=!0,console.log("response")})},{timeout:5e3})):$timeout(function(){scope.showErrorMessage=!0})},scope.emitUpdate=function(address){scope.query=address.addressLine2,scope.$emit(scope.eventPrefix+"-change",address)},scope.close=function(){scope.query="",scope.show=!1,scope.$emit(scope.eventPrefix+"-close",{})},scope.back=function(){scope.$emit(scope.eventPrefix+"-back",{})},scope.selectAddress=function(item){scope.iSelected=null,scope.show=!1,item.place_id?scope.place(item.place_id,function(address){scope.emitUpdate(address)}):scope.emitUpdate(item)}}}}]);var app=angular.module("App",["autocomplete","angular-preload-image","sync-value","onFinishRender","tabComponents","ngSanitize","google-address-search"]);initiateGoogleMapModule(),setTimeout(function(){if(window.bannerUrl&&window.bannerUrl.length>0){var bannerUrls=window.bannerUrl.split(",");bannerUrls.length&&($("#hero").carousel(bannerUrls.slice(0,1),7e3),bannerUrls.length>1&&(window.onload=function(){$("#hero").carousel(bannerUrls,7e3)}))}},500),app.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.common["Cache-Control"]="no-cache",$httpProvider.defaults.headers.common.Pragma="no-cache",$httpProvider.defaults.headers.common["If-Modified-Since"]="0"}]),$("#fm-gas-modal").length>0&&(window.MODAL_LOCATION_ADDRESS=$("#fm-gas-modal").modal(".toggle-fm-gas-modal")),window.BURGER_MENU=$("#burger-menu").menu(".burger-menu-toggle",!0),window.initiateAllModals=function(){window.MENU_CART=$("#cart-menu-variant").menu(".cart-menu-toggle",!0),window.MENU_CITY=$("#city-menu").menu(".city-menu-toggle"),window.PAYMENT_FAILED_RETRY_SECTION=$("#payment-failure").modal(".payment-failure-toggle"),window.MODAL_DOWNLOAD_APP=$("#modal_download_app").modal(".toggle-modal-download-app"),window.PRODUCT_DETAILS_POPUP=$("#product_details_popup").modal(".toggle-product-details-popup"),window.PRODUCT_DETAILS_ADDONS_POPUP=$("#product_details_addons_popup").modal(".toggle-product-details-addons-popup"),window.MODAL_DELIVER_NOW_LATER=$("#fm-deliver-now-later-modal").modal(".toggle-fm-deliver-now-later-modal"),window.PAYMENT_FAILURE_ERROR_MESSAGE=$("#payment-failure-error-message").modal(".payment-failure-error-message-toggle"),$("#location").fixedOnScroll("product-detail-page"),$("#filter").femuToggleClass("active",!0),$("#user-dropdown").femuToggleClassForNav("active"),$(".cart-button-mobile").addClassWhenInView("#cart-button-container","fixed-bottom"),$("#filter-mobile").click(function(event){$("#filter-mobile").hasClass("active")||$("#filter-mobile").addClass("active"),event.stopPropagation()}),window.MODAL_BULK=$("#modal-bulk").modal(".toggle-modal-bulk"),window.MODAL_SUPPORT=$("#modal-support").modal(".toggle-modal-support"),$("#location-address").length>0&&(window.MODAL_LOCATION_ADDRESS=$("#location-address").modal(".toggle-modal-location-address")),$("#skip-to-site-modal").length>0&&(window.SKIP_TO_WEBSITE=$("#skip-to-site-modal").modal(".skip-to-site-btn")),$("#newsletter_subscription").length>0&&(window.MODAL_NEWSLETTER_SUBSCRIPTION=$("#newsletter_subscription").modal(".toggle-modal-newsletter-subscription")),$("#exit_intent").length>0&&(window.MODAL_EXIT_INTENT=$("#exit_intent").modal(".toggle-modal")),window.MODAL_NEW_ADDRESS=$("#new-address").modal(".toggle-modal-new-address"),window.MODAL_LOGIN=$("#modal-login").modal(".toggle-modal-login"),window.MODAL_REGISTER_CHOISE=$("#modal-register").modal(".toggle-modal-register"),window.MODAL_REGISTER_EMAIL=$("#modal-register-email").modal(".toggle-modal-register-email"),window.MODAL_FORGOT_PASSWORD=$("#forgot-password").modal(".toggle-forgot-password"),window.MODAL_OFFER_NEW=$("#offer-display").modal(".toggle-offer-display"),window.MODAL_MOBILE_VERIFICATION=$("#modal-mobile-verification").modal(".toggle-modal-mobile-verification"),MODAL_FORGOT_PASSWORD.openCallbacks.push(function(){MODAL_LOGIN.hide()}),MODAL_LOGIN.closeCallbacks.push(function(){dataLayer.push({event:"dismissLoginModal"})}),MODAL_REGISTER_EMAIL.closeCallbacks.push(function(){dataLayer.push({event:"dismissSignUpModal"})}),angular.element(document.getElementById("mainController")).scope().onModalEJSFileLoaded()},window.fmIsMobileTemplate&&app.run(function($rootScope){$rootScope.$on("$includeContentLoaded",function(event,templateName){window.initiateAllModals()})}),function(){app.service("SimplPaymentService",["$window",function($window){var initiateApproval,initiateClickOnSimplBtn,initiateFailureCb,initiateSuccessCb;this.initiate=function(){return window.Simpl.setTarget(document.getElementById("simpl-checkout")),initiateApproval(),initiateClickOnSimplBtn(),initiateSuccessCb(),initiateFailureCb()},initiateApproval=function(){var errorCb,successCb,simplPaymentElem;return simplPaymentElem=$(".simpl-option"),successCb=function(r){window.simplPaymentOptionApproved=!0,simplPaymentElem.removeClass("hide"),simplPaymentElem.addClass("show"),dataLayer.push({event:"customEvent",action:"Simpl",label:"Visible",value:1})},errorCb=function(e){window.simplPaymentOptionApproved=!1,simplPaymentElem.removeClass("show"),simplPaymentElem.addClass("hide")},$window.Simpl.on("approval",successCb,errorCb)},initiateClickOnSimplBtn=function(){var cb;return cb=function(){return!!$window.validateCheckout()||($window.handleInitiatePaymentFailureForSimpl(),!1)},$window.Simpl.on("click",cb)},initiateSuccessCb=function(){var cb;return cb=function(response){return"success"===response.status&&null!=response.transaction_token?$window.createOrderForSimpl(response.transaction_token):$window.handleInitiatePaymentFailure()},$window.Simpl.on("success",cb)},initiateFailureCb=function(){var cb;return cb=function(response){return $window.handleInitiatePaymentFailure("transaction_fail")},$window.Simpl.on("error",cb)}}])}.call(void 0),app.factory("$localstorage",["$window",function($window){return{set:function(key,value){$window.localStorage[key]=value},get:function(key,defaultValue){return $window.localStorage[key]||defaultValue},setObject:function(key,value){$window.localStorage[key]=JSON.stringify(value)},getObject:function(key){return JSON.parse($window.localStorage[key]||"{}")},removeItem:function(key){$window.localStorage.removeItem(key)}}}]),app.service("TrackingService",["$window",function($window){var _getUserName,_getUserIdentity,_postEvent;this.postSignInEvent=function(user){_setUserInfo({user:user}),_postEvent("Checkout clicked",user)},this.postSignUpEvent=function(user){_setUserInfo({user:user}),_postEvent("Sign up",user)},this.postEvent=function(eventName,data,user){var postData;postData=_.extend({},data),_removeInnerObjects(postData),window.trackingCode&&(postData.experiment_id=window.trackingCode),postData.app_version="2.2",/Mobi/.test(navigator.userAgent)?postData.fm_channel="MOBILE_APP":postData.fm_channel="WEBSITE","Sign up"!=eventName&&"Login"!=eventName&&"User identified"!=eventName||"Success"!=data.Status||!user||(user&&user.id&&user.primeStatus&&(postData["Club status"]=user.primeStatus),_setUserInfo(user)),window.thirdPartyApp&&""!=window.thirdPartyApp&&(postData.utm_campaign=window.thirdPartyApp),$window.clevertap.event.push(eventName,postData)},this.trackPageVisitsOfPage=function(page){var viewedObj={};viewedObj.screenName=page,_postEvent("Screen Visited",viewedObj)},_initTrackingService=function(){$window.clevertap={event:[],profile:[],account:[],notifications:[]},$window.clevertap.account.push({id:window.clevertap_key}),$window.clevertap.enablePersonalization=!0,clevertap.notifications.push({skipDialog:!0,askAgainTimeInSeconds:86400}),function(){var wzrk=document.createElement("script");wzrk.type="text/javascript",wzrk.async=!0,wzrk.src=("https:"==document.location.protocol?"https://d2r1yp2w7bby2u.cloudfront.net":"http://static.clevertap.com")+"/js/a.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wzrk,s)}()},_trackPageVisits=function(){var path=document.location.pathname,page=path.substring(path.indexOf("/"));if("/"!=page){var viewedObj={};viewedObj.screenName=page;var queryParams=document.location.search.trim();if(queryParams.length){queryParams=queryParams.substring(1);for(var queryParamsList=queryParams.split("&"),i=0;i<queryParamsList.length;i++)queryParamsList[i].split("=")&&queryParamsList[i].split("=").length&&2==queryParamsList[i].split("=").length&&(viewedObj[queryParamsList[i].split("=")[0]]=queryParamsList[i].split("=")[1])}_postEvent("Screen Visited",viewedObj)}else setTimeout(function(){dataLayer.push({event:"fireRemarketingTag",google_tag_params:{dynx_pagetype:"home"}})},4e4)},_trackPageVisitsOfPage=function(page){var viewedObj={};viewedObj.screenName=page,_postEvent("Screen Visited",viewedObj)},_getUserName=function(user){var firstName,lastName,userName;return userName="",null!=user&&user&&(firstName=user.firstName,lastName=user.lastName,firstName&&lastName||firstName&&""==lastName?userName=firstName+" "+lastName:firstName?userName=firstName:lastName?userName=lastName:user.emailAddress?userName=user.emailAddress.split("@")[0]:user.email&&(userName=user.email.split("@")[0])),userName},_getUserIdentity=function(user){var email;return email="",null!=user&&user.email&&(email=user.email),email},_getPhoneNUmber=function(phoneNumer){return phoneNumer&&10==phoneNumer.length&&(phoneNumer="+91"+phoneNumer),phoneNumer},_getCustomerType=function(user){return user&&user.corporateAccountStatus&&"active"==user.corporateAccountStatus?"corporate":"normal"},_getCorporateId=function(user){return user.corporateId?user.corporateId:0},_getClubStatus=function(user){return user&&user.primeStatus&&""!=user.primeStatus?user.primeStatus:""},_postEvent=function(eventName,data,user){var postData;postData=_.extend({},data),_removeInnerObjects(postData),window.trackingCode&&(postData.experiment_id=window.trackingCode),postData.app_version="2.2",/Mobi/.test(navigator.userAgent)?postData.fm_channel="MOBILE_APP":postData.fm_channel="WEBSITE","Sign up"!=eventName&&"Login"!=eventName&&"User identified"!=eventName||"Success"!=data.Status||!user||(user&&user.id&&user.primeStatus&&(postData["Club status"]=user.primeStatus),_setUserInfo(user)),window.thirdPartyApp&&""!=window.thirdPartyApp&&(postData.utm_campaign=window.thirdPartyApp),$window.clevertap.event.push(eventName,postData)},_removeInnerObjects=function(data){for(var property in data)("[object Object]"==Object.prototype.toString.call(data[property])||_.isArray(data[property]))&&delete data[property]},_setUserInfo=function(user){setTimeout(function(){$window.clevertap.profile.push({Site:{Name:_getUserName(user),Identity:_getUserIdentity(user),Email:_getUserIdentity(user),Phone:_getPhoneNUmber(user.mobileNumber),"Customer Type":_getCustomerType(user),corporate_id:_getCorporateId(user),"MSG-email":!0,"MSG-push":!0,"MSG-sms":!0,"Club Eligible":_getClubStatus(user)}})},5e3)},this._setUserInfo=function(user){$window.clevertap.profile.push({Site:{Name:_getUserName(user),Identity:_getUserIdentity(user),Email:_getUserIdentity(user),Phone:_getPhoneNUmber(user.mobileNumber),"Customer Type":_getCustomerType(user),corporate_id:_getCorporateId(user),"MSG-email":!0,"MSG-push":!0,"MSG-sms":!0,"Club Eligible":_getClubStatus(user)}})},this.fetchCatalogueEvent=function(data,currentLocation){setTimeout(function(){data&&data.serviceability&&1==data.serviceability.serviceable&&currentLocation&&currentLocation.addressLine2&&currentLocation.addressLine2.length>0&&!data.catalogueOOS?this.postEvent("Menu list available",{fc_name:data.fulfillmentCenter&&data.fulfillmentCenter.name?data.fulfillmentCenter.name:"",fc_id:data.fulfillmentCenter&&data.fulfillmentCenter.id?data.fulfillmentCenter.id:"",lat:data.serviceability.addressDTO&&data.serviceability.addressDTO.lat?data.serviceability.addressDTO.lat:"",long:data.serviceability.addressDTO&&data.serviceability.addressDTO.lon?data.serviceability.addressDTO.lon:"",menu_version:data&&data.menuVersion?data.menuVersion:"",app_version:"2.2","NUP Eligible":!(!data||!data.psd||"NEW_USER_ELIGIBLE"!==data.psd.wt&&"NEW_USER"!==data.psd.wt),"corporate enabled":!(!data||!data.cm||"corp_disc_available"!=data.cm),"Club Eligible":data&&data.u&&data.u.primeStatus&&""!=data.u.primeStatus?data.u.primeStatus:""}):data&&data.catalogueOOS?this.postEvent("Menu list unavailable",{Status:"Failed",Reason:"Stocked out",menu_version:data&&data.menuVersion?data.menuVersion:"",lat:data.serviceability.addressDTO&&data.serviceability.addressDTO.lat?data.serviceability.addressDTO.lat:"",long:data.serviceability.addressDTO&&data.serviceability.addressDTO.lon?data.serviceability.addressDTO.lon:"",fc_id:data.fulfillmentCenter?data.fulfillmentCenter.id:"",fc_name:data.fulfillmentCenter?data.fulfillmentCenter.name:""}):this.postEvent("Menu list unavailable",{Status:"Failed",Reason:data&&data.serviceability&&data.serviceability.reasonDescription?data.serviceability.reasonDescription:"",menu_version:data&&data.menuVersion?data.menuVersion:""})}.bind(this),5e3)};var _addOpenCallBackEvents=function(obj,eventName){"undefined"!=typeof obj&&obj.openCallbacks.push(function(){_trackPageVisitsOfPage(eventName)})};"undefined"!=typeof MODAL_REGISTER_EMAIL&&_addOpenCallBackEvents(MODAL_REGISTER_EMAIL,"Sign up pop up"),"undefined"!=typeof MODAL_LOGIN&&_addOpenCallBackEvents(MODAL_LOGIN,"Login"),"undefined"!=typeof MODAL_SUPPORT&&_addOpenCallBackEvents(MODAL_SUPPORT,"/support"),"undefined"!=typeof MENU_CART&&_addOpenCallBackEvents(MENU_CART,"/cart"),_initTrackingService(),_trackPageVisits()}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};app.service("MenuLiteService",["$window",function($window){var _menuLiteConversionMa,menuLiteConversionMap=(_menuLiteConversionMa={
cc:"collections",s:"serviceability",fc:"fulfillmentCenter",bns:"banners",i:"id",n:"name",sn:"sequenceNumber",sd:"scheduledDate",pl:"products",t:"title",st:"subTitle",d:"details",mt:"mealType",lc:"likesCount",c:"categories",cu:"cuisine",md:"menuDate",itm:"isTodaysMenu",ia:"isAvailable",im:"iosMin",moq:"maxOrderQuantity",dm:"deliveryMessage",il:"isLiked",pdt:"deliveryTimings",bd:"bannerDTO",iv:"isVisible",p:"sellingPrice",mrp:"marketPrice",ipo:"isPreOrder",ibp:"imageBasePath",am:"androidMin"},_defineProperty(_menuLiteConversionMa,"il","isLiked"),_defineProperty(_menuLiteConversionMa,"moq","maxOrderQuantity"),_defineProperty(_menuLiteConversionMa,"slg","slug"),_defineProperty(_menuLiteConversionMa,"mver","menuVersion"),_defineProperty(_menuLiteConversionMa,"mdt","maxDeliveryTime"),_defineProperty(_menuLiteConversionMa,"ms","message"),_defineProperty(_menuLiteConversionMa,"mr","tagsList"),_defineProperty(_menuLiteConversionMa,"shd","shortDescription"),_defineProperty(_menuLiteConversionMa,"ds","collectionDescription"),_defineProperty(_menuLiteConversionMa,"ica","isCustomizableAddons"),_defineProperty(_menuLiteConversionMa,"liteProducts","addonsProducts"),_defineProperty(_menuLiteConversionMa,"offa","initialOfferCode"),_defineProperty(_menuLiteConversionMa,"bi","badgeImage"),_defineProperty(_menuLiteConversionMa,"oe","productNewLayout"),_defineProperty(_menuLiteConversionMa,"cp","corporate"),_defineProperty(_menuLiteConversionMa,"fl","filter"),_defineProperty(_menuLiteConversionMa,"v","value"),_defineProperty(_menuLiteConversionMa,"tl","tagsList"),_defineProperty(_menuLiteConversionMa,"tm","tagsMap"),_menuLiteConversionMa),self=this,imageBasePathCounter=0;self.recFormat=function(data){var formattedData=data;for(var key in data)if(menuLiteConversionMap.hasOwnProperty(key)&&null!=data[key]){if(data[key]instanceof Array)for(var len=data[key].length,i=0;i<len;i++)self.recFormat(data[key][i]);else _typeof("object"==data[key])&&self.recFormat(data[key]);"im"==key?data[key].length>5?(formattedData.image=window.fmImageBasePath[imageBasePathCounter]+"/"+data[key],imageBasePathCounter=(imageBasePathCounter+1)%3):formattedData.iosMin=data[key]:formattedData[menuLiteConversionMap[key]]=data[key],delete formattedData[key]}return formattedData},self.format=function(data){var i,j,collectionProductsLength,availabilityMap={};window.fmImageBasePath=[window.fmImagebasePath1,window.fmImagebasePath2,window.fmImagebasePath3];var recursedFormatData=self.recFormat(data);if(recursedFormatData.collections&&recursedFormatData.collections.length>0){var collectionsLength=recursedFormatData.collections.length;if(collectionsLength)for(i=0;i<collectionsLength;i++)if(collectionProductsLength=recursedFormatData.collections[i].products.length)for(j=0;j<collectionProductsLength;j++)availabilityMap[recursedFormatData.collections[i].products[j].id]=recursedFormatData.collections[i].products[j].isAvailable;return recursedFormatData.availability=availabilityMap,recursedFormatData}return recursedFormatData}}]),app.service("Request",["$http",function($http){this.post=function(url,resource){return $http.post(url,resource)},this.get=function(url){return $http.get(url)},this.put=function(url,resource){return $http.put(url,resource)},this.delete=function(url){return $http.delete(url)},this.xhr=function(url,resource){var formData=new FormData;return angular.forEach(resource,function(value,key){formData.append(key,value)}),$http.post(url,formData,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity})}}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};app.service("Api",["Request","TrackingService","MenuLiteService",function(Request,TrackingService,MenuLiteService){this.getMenu=function(callback){var d1=new Date,queryParam=(d1.getTime(),"?");if(window.fmIsCategoryHomePage&&(queryParam+="isCategorySpecific=true&"),window.fmSearchParam&&(queryParam=queryParam+"fmSearchParam="+window.fmSearchParam+"&"),window.location.search&&window.location.search.indexOf("collectionId")!=-1&&(queryParam=queryParam+window.location.search.slice(1)+"&"),window.fmSearchType&&(queryParam=queryParam+"fmSearchType="+window.fmSearchType),"/futuremenu"===window.location.pathname){var queryparams=window.location.search.substring(1,window.location.search.length);queryparams=queryparams.split("&");for(var i=0;i<queryparams.length;i++){var key=queryparams[i].split("=")[0];if("date"===key){queryParam.date=queryparams[i].split("=")[1];break}}}Request.get("/api/menu"+("?"!==queryParam?queryParam:"")).then(function(response){if(response&&response.data){var responseData={};responseData=response.data,responseData=MenuLiteService.format(responseData)}if(callback&&callback(response.data),responseData&&responseData.serviceability&&1==responseData.serviceability.serviceable){var d2=new Date;d2.getTime()}})},this.getFreshPassConfig=function(){return Request.get("/api/freshPass/getConfig")},this.changePassword=function(data){return Request.post("/api/users/changePassword",data)},this.getCouponOffers=function(){return Request.get("/api/cart/couponOffers")},this.lazyPayResend=function(orderId){return Request.get("/api/payment/lazypay/resend?orderId="+orderId)},this.getWalletEntriesForUser=function(){return Request.get("/api/users/getWalletEntriesForUser")},this.getFreshMoneyConfig=function(cb){Request.get("/api/payment/getFreshMoneyConfig").then(function(response){cb&&cb(response.data)})},this.orderRatingConfig=function(callback){Request.get("/api/ratings/config").then(function(response){callback&&callback(response.data)})},this.orderRatingCreate=function(data,callback){Request.post("/api/ratings/create",data).then(function(response){callback&&callback(response)},function(response){callback&&callback(response)})},this.isServiceable=function(data,callback){Request.post("/api/menu/serviceable",data).then(function(response){callback&&callback(response.data)})},this.getOffers=function(callback){Request.get("/api/offers").then(function(response){callback(response.data)})},this.getKitchenMenu=function(reqObject,cb){Request.get("/api/menu/tv"+(window.fmIsCategoryHomePage?"?isCategorySpecific=true":"")).then(function(response){cb(response.data)})},this.getWalletOffers=function(user,callback){Request.post("/api/users/wallet/offers",{user:user}).then(function(response){callback&&callback(response.data)})},this.getDefaultMenu=function(callback){Request.get("/api/menu/default"+(window.fmIsCategoryHomePage?"?isCategorySpecific=true":"")).then(function(response){callback&&callback(response.data)})},this.fmGetContent=function(key,cb){Request.get("/api/refresh/content?key="+key).then(function(response){cb&&cb(response.data)})},this.getProductDetails=function(productId,cb){Request.post("/api/menu/product_details",{data:{productId:productId}}).then(function(response){cb&&cb(response.data)})},this.getSuggestedProducts=function(productId,cb){Request.get("/api/menu/recommendations/"+productId).then(function(response){cb&&cb(response.data)})},this.getOrders=function(callback){Request.get("/api/users/orders").then(function(response){callback&&callback(response.data)})},this.getOTP=function(mobileNumber,user,successCb,errorCb){var url="/api/users/"+user.id+"/get_otp/"+mobileNumber;Request.get(url).then(successCb,errorCb)},this.verifyMobileNumberWithoutDigits=function(mobileVerificationForm,successCb,errorCb){var url="/api/users/mobile/verify/"+mobileVerificationForm.mobileNumber+"/"+mobileVerificationForm.OTPToken;Request.get(url).then(successCb,errorCb)},this.getLastOrder=function(callback){Request.get("/api/users/orders/last").then(function(response){callback&&callback(response.data)})},this.getMenuMetadata=function(cb){Request.get("/api/menu/metadata"+(window.fmIsCategoryHomePage?"?isCategorySpecific=true":"")).then(function(response){var responseData={};responseData=response.data,responseData.menu=MenuLiteService.format(responseData.menu),cb(response.data)})},this.fetchDisplayOfferDetails=function(cb){Request.get("/api/users/display_offer").then(function(response){cb(response.data)})},this.setUTMSource=function(data,cb){var url="/api/utm_source/"+data.utmSource;url=url+"?"+window.location.search.substring(1),Request.get(url).then(function(response){cb&&cb(response.data)})},this.getUserLocation=function(callback){Request.get("/api/users/location"+(window.fmIsCategoryHomePage?"?isCategorySpecific=true":"")).then(function(response){callback&&callback(response.data)})},this.socialAuth=function(authToken,type,success,error){Request.post("/api/users/authenticate/"+type,{authToken:authToken}).then(function(response){success(response.data)},function(response){error(response)})},this.createOrder=function(postData,successCb,errorCb){Request.post("/api/users/createOrder",postData).then(function(response){successCb&&successCb(response.data)},function(response){errorCb&&errorCb(response)})},this.createBusinessOrder=function(user,address,callback){Request.post("/api/users/createOrder/business",{user:user,address:address}).then(function(response){callback&&callback(response.data)},function(response){error(response)})},this.removeUserAddress=function(address_id,userId,callback){Request.post("/api/users/address/"+userId+"/"+address_id+"/delete",{}).then(function(response){callback&&callback(response.data)})},this.getOrderDetails=function(order_id,callback){Request.get("/api/orders/"+order_id+"/getDetail").then(function(response){callback&&callback(response.data)},function(response){error(response)})},this.getOrderById=function(order_id,callback){Request.get("/api/orders/"+order_id).then(function(response){callback&&callback(response)},function(response){callback&&callback(response)})},this.sendResetPasswordDetails=function(data,success,error){Request.post("/api/users/sendResetPasswordDetails",data).then(function(response){success(response.data)},function(response){error(response)})},this.fmGenerateMobileOTP=function(data,success,error){Request.post("/api/users/fmGenerateMobileOTP",data).then(function(response){success(response.data)},function(response){error(response)})},this.fmAuthenticateMobile=function(data,success,error){Request.post("/api/users/fmAuthenticateMobile",data).then(function(response){success(response.data)},function(response){error(response)})},this.resetPassword=function(data,success,error){Request.post("/api/users/resetPassword",data).then(function(response){success(response.data)},function(response){error(response)})},this.addUserAddress=function(address,success,error){Request.post("/api/users/addresses",address).then(function(response){success(response.data)},function(response){error(response)})},this.getUserAddresses=function(callback){Request.get("/api/users/addresses").then(function(response){callback(response.data)})},this.updateUserAddress=function(address,success,error){Request.post("/api/users/addresses/update",address).then(function(response){success(response.data)},function(response){error(response)})},this.setUserLocation=function(address,callback){Request.post("/api/users/location",address).then(function(response){callback&&callback(response.data)})},this.setDefaultLocation=function(address,callback){Request.post("/api/users/defaultLocation/cart",address).then(function(response){callback&&callback(response.data)})},this.fmClearGenCart=function(data,callback){Request.post("/api/payment/clear/genCart",data).then(function(response){callback&&callback(response.data)})},this.setUserLocationAndClearCart=function(address,callback){Request.post("/api/users/location/cart",address).then(function(response){callback&&callback(response.data)})},this.setUserLocationAndClearCartAndGetMenu=function(address,cb){var d1=new Date,queryParam=(d1.getTime(),"?");window.fmIsCategoryHomePage&&(queryParam+="isCategorySpecific=true&"),window.fmSearchParam&&(queryParam=queryParam+"fmSearchParam="+window.fmSearchParam+"&"),window.fmSearchType&&(queryParam=queryParam+"fmSearchType="+window.fmSearchType),Request.post("/api/users/location/cart/menu"+("?"!==queryParam?queryParam:""),address).then(function(response){var responseData={};if(responseData=response.data,responseData.menu=MenuLiteService.format(responseData.menu),cb&&cb(response.data),response.data.menu&&response.data.menu.serviceability&&1==response.data.menu.serviceability.serviceable){var d2=new Date;d2.getTime()}})},this.getCities=function(callback){Request.get("/api/cities").then(function(response){callback&&callback(response.data)})},this.getCart=function(callback){Request.get("/api/cart").then(function(response){callback&&callback(response.data)})},this.getCartCardOffer=function(savedCardDTO,callback){Request.post("/api/cart/cardOffer",savedCardDTO).then(function(response){callback&&callback(response.data)})},this.resetCart=function(callback){Request.get("/api/cart/reset").then(function(response){callback&&callback(response.data)})},this.retainWhenRefreshCart=function(callback){Request.get("/api/cart/retain/refresh").then(function(response){callback&&callback(response.data)})},this.addToCart=function(item,callback){dataLayer.push({event:"GTM_ECOM_ATC",ecommerce:{currencyCode:"Rupee",add:{products:[{name:item.product.title,id:item.product.id,price:item.product.price,category:item.product.mealType,quantity:item.quantity}]}}}),Request.post("/api/cart",item).then(function(response){callback&&callback(response.data)})},this.removeFromCart=function(item,callback){dataLayer.push({event:"GTM_ECOM_RFC",ecommerce:{currencyCode:"Rupee",add:{products:[{name:item.product.title,id:item.product.id,price:item.product.price,category:item.product.mealType,quantity:item.quantity}]}}}),Request.post("/api/cart/remove",item).then(function(response){callback&&callback(response.data)})},this.removeBulkFromCart=function(items,callback){Request.post("/api/cart/removeBulk",items).then(function(response){callback&&callback(response.data)})},this.setDsi=function(data,callback){Request.post("/api/cart/dsi",data).then(function(response){callback&&callback(response.data)})},this.fmUpdateApplyFreshmoney=function(data,callback){Request.post("/api/cart/fmUpdateApplyFreshmoney",data).then(function(){callback&&callback()})},this.removeClubItem=function(data,callback){Request.post("/api/cart/removeClubItem",data).then(function(response){callback&&callback(response.data)})},this.addClubItem=function(data,callback){Request.post("/api/cart/addClubItem",data).then(function(response){callback&&callback(response.data)})},this.addOfferCode=function(data,callback){"object"===("undefined"==typeof data?"undefined":_typeof(data))&&null!=data||(data={offerCode:data}),Request.post("/api/cart/offerCode",data).then(function(response){callback&&callback(response.data),response.data.cart&&response.data.cart.offer&&response.data.cart.offer.status?dataLayer.push({event:"customEvent",category:"Category",action:"Apply Code",label:"Success",value:response.data.totalAmount-response.data.finalAmount}):dataLayer.push({event:"customEvent",category:"Category",action:"Apply Code",label:"Fail",value:1})})},this.register=function(user,success,error){Request.post("/api/users/register",user).then(function(response){success(response.data)},function(response){error(response)})},this.login=function(user,success,error){Request.post("/api/users/login",user).then(function(response){var data;data=null!=("undefined"!=typeof response&&null!==response?response.data:void 0)?response.data:{},success(data)},function(response){error(response)})},this.fmPhonepeSSO=function(user,success,error){Request.post("/api/users/fmPhonepeSSO",user).then(function(response){var data;data=null!=("undefined"!=typeof response&&null!==response?response.data:void 0)?response.data:{},success(data)})},this.fmFlipkartSSO=function(user,success,error){Request.post("/api/users/fmFlipkartSSO",user).then(function(response){var data;data=null!=("undefined"!=typeof response&&null!==response?response.data:void 0)?response.data:{},success(data)})},this.fmSpotSSO=function(user,success,error){Request.post("/api/users/fmSpotSSO",user).then(function(response){var data;data=null!=("undefined"!=typeof response&&null!==response?response.data:void 0)?response.data:{},success(data)})},this.fmPaytmSSO=function(user,success,error){Request.post("/api/users/fmPaytmSSO",user).then(function(response){var data;data=null!=("undefined"!=typeof response&&null!==response?response.data:void 0)?response.data:{},success(data)})},this.getUser=function(callback){Request.get("/api/users").then(function(response){callback&&callback(response.data)})},this.getUserLastOrder=function(callback){Request.get("/api/users/last-order").then(function(response){callback&&callback(response.data)})},this.initiatePayment=function(url,data,cb){var successCb=function(paymentDetails){cb(paymentDetails)},errorCb=function(err){cb(null)};Request.post(url,data).then(successCb,errorCb)},this.updateUserInfo=function(user,successCb,errorCb){var url="/api/users/update";Request.post(url,{user:user}).then(successCb,errorCb)},this.fetchRefferalLink=function(user,successCb,errorCb){var url="/api/users/"+user.id+"/register_user/appvirality";Request.post(url,{EmailId:user.email,Phone:user.mobileNumber}).then(successCb,errorCb)},this.getFreshMoneyTotalBalance=function(callback){Request.get("/api/users/wallet").then(function(response){callback&&callback(response.data)})},this.getCards=function(userId,successCb,errorCb){Request.get("/api/payment/cards/"+userId).then(function(response){successCb&&response&&response.data&&successCb(response.data)},function(response){errorCb&&errorCb(response)})},this.makeCardPaypayment=function(postData,cb,errorCb){Request.post("/api/payment/justpay/make_payment",postData).then(function(response){cb&&cb(response)},function(response){errorCb&&errorCb(response)})},this.submitPayment=function(url,postData,successCb,errorCb){Request.post(url,postData).then(function(response){successCb&&successCb(response.data)},function(response){errorCb&&errorCb(response)})},this.handleCorporateSubmit=function(corporateArgs,callback){var attList=[];attList.push(corporateArgs.phoneNumber),attList.push(corporateArgs.email),attList.push(corporateArgs.companyName),attList.push(corporateArgs.name),corporateArgs.website&&corporateArgs.website.length>0&&attList.push(corporateArgs.website),Request.post("/api/campaign",{campaignName:"corporate",data:attList}).then(function(response){callback&&callback(response)})},this.handlebulkOrderSubmit=function(bulkOrderArgs,callback){Request.post("/api/bulkOrder",{bulkOrderDetails:bulkOrderArgs}).then(function(response){callback&&callback(response)})},this.getAddonsDetails=function(data,successCb,errorCb){Request.post("/api/menu/getAddons",{data:data}).then(function(response){if(successCb){if(response&&response.data){var addonsResponseData={};addonsResponseData=response.data,addonsResponseData=MenuLiteService.recFormat({liteProducts:addonsResponseData})}successCb(addonsResponseData)}})},this.fmGetPaymentOptions=function(callback){Request.get("/api/payment/getPaymentOptions").then(function(response){callback&&callback(response.data)})},this.fmGetPaymentOptionsV2=function(callback){Request.get("/api/payment/getPaymentOptions?nativePayment=true").then(function(response){callback&&callback(response.data)})},this.fmGetWalletAndSavedCards=function(callback){Request.get("/api/payment/getWalletAndSavedCards").then(function(response){callback&&callback(response.data)})},this.fmVerifyWalletOtp=function(fmReqObj,callback){Request.get("/api/payment/wallet/validate/"+fmReqObj.tokenId+"/"+fmReqObj.otp).then(function(response){callback&&callback(response.data)})},this.fmGetWalletOtp=function(fmReqObj,callback){Request.get("/api/payment/wallet/authenticate/"+fmReqObj.wallet).then(function(response){callback&&callback(response.data)})},this.paypalLinkWallet=function(fmReqObj,callback){Request.get("/api/payment/wallet/authenticate/paypal/"+fmReqObj.uuid).then(function(response){callback&&callback(response.data)})},this.fmUnlinkWallet=function(fmReqObj,callback){Request.get("/api/payment/wallet/delink/"+fmReqObj.tokenId).then(function(response){callback&&callback(response.data)})},this.fmSubscribeToEmail=function(email,callback){Request.post("/api/users/subscribeToNewsLetter",{email:email}).then(function(response){callback&&callback(response)})},this.fmSendOfferCode=function(email,callback,error){Request.post("/api/users/exit-intent",{email:email}).then(function(response){callback&&callback(response)},function(){error&&error()})},this.getRiderLocation=function(orderId,callback){Request.get("/api/orders/track/"+orderId).then(function(response){callback&&callback(response.data)})},this.favoriteLike=function(productId,callback){Request.post("/api/favorite/favoriteLike",{data:productId}).then(function(response){callback&&callback(response)})},this.favoriteUnlike=function(productId,callback){Request.post("/api/favorite/favoriteUnlike",{data:productId}).then(function(response){callback&&callback(response)})},this.favoriteProducts=function(user,callback){Request.post("/api/favorite/favoriteProducts",{data:user}).then(function(response){callback&&callback(response)})},this.getUserSavedCards=function(userDetails,callback){Request.post("/api/payment/getUserSavedCards",{user:userDetails}).then(function(response){callback&&callback(response.data)})},this.deleteUserSavedCard=function(cardToken,cb){Request.post("/api/payment/deleteUserSavedCard",{token:cardToken}).then(function(response){cb&&cb(response)})},this.signupCorporate=function(reqBody,cb){Request.post("/api/users/signupCorporate",reqBody).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.linkCorporate=function(reqBody,cb){Request.post("/api/users/linkCorporate",reqBody).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.resendActivationMail=function(reqBody,cb){Request.post("/api/users/resendActivationMail",reqBody).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.getAllCorporateAddress=function(reqBody,cb){var url="/api/corporate/getAllCorporateAddress";reqBody&&reqBody.companyId&&(url=url+"?cId="+reqBody.companyId),Request.get(url).then(function(response){cb&&cb(response.data)})},this.addFreshMoney=function(reqBody,cb){Request.post("/api/payment/initiateFreshmoneyTopup",reqBody).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.addFreshMoneyV2=function(reqBody,cb){Request.post("/api/payment/v2/initiateFreshmoneyTopup",reqBody).then(function(response){cb&&cb(response.data)},function(response){cb&&cb(response)})},this.addMealPassMoney=function(reqBody,cb){Request.post("/api/payment/addMealPassMoney",reqBody).then(function(response){cb&&cb(response.data)},function(response){cb&&cb(response)})},this.getMealPlans=function(cb){Request.get("/api/freshmoney/getMealPlans").then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.getCorpCompanyList=function(term,cb){Request.get("/api/corporate/getCorpCompanyList?term="+term).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.getClubPDP=function(cb){Request.post("/api/freshclub/getClubPDP").then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.fmCheckClubCode=function(data,cb){Request.post("/api/freshclub/checkClubCode",data).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.subscribeToClub=function(plan,cb){Request.post("/api/freshclub/subscribeToClub",{plan:plan}).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.subscribeToClubV2=function(reqBody,cb){Request.post("/api/freshclub/subscribeToClubV2",reqBody).then(function(response){cb&&cb(response.data)},function(response){cb&&cb(response)})},this.updateGenCart=function(genCart,cb){Request.post("/api/payment/updateGenCart",{cart:genCart}).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.getLazyPayApproval=function(cb){Request.post("/api/cart/lazypay/getEligibility").then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.fmVerifyLazypayOtp=function(fmReqObj,callback){Request.get("/api/payment/lazyPay/"+fmReqObj.orderId+"/"+fmReqObj.otp).then(function(response){callback&&callback(response.data)})},this.validateVpa=function(fmReqObj,callback){Request.get("/api/payment/upi/validateVPA/"+fmReqObj.vpa).then(function(response){callback&&callback(response.data)})},this.tezCheckStatusForTransaction=function(fmReqObj,cb){Request.post("/api/payment/upi/checkStatusForTransaction",fmReqObj).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.tezPhNoCheckStatusForTrans=function(fmReqObj,cb){Request.post("/api/payment/google-tez/checkStatusForTransaction",fmReqObj).then(function(response){cb&&cb(response)},function(response){cb&&cb(response)})},this.markAsUndelivered=function(orderId,callback){Request.get("/api/orders/markAsUndelivered/"+orderId).then(function(response){callback&&callback(response.data)})},this.fmChangeAddress=function(data,cb){Request.post("/api/orders/changeAddress",data).then(function(res){cb&&cb(res)},function(res){cb&&cb(res)})},this.fmRedeemGiftCard=function(data,cb){Request.post("/api/freshmoney/giftCard",data).then(function(res){cb&&cb(res)},function(res){cb&&cb(res)})},this.riskContext=function(data){Request.get("/api/payment/riskContext/"+data.fm_uuid)},this.triggerTradeTracker=function(data){Request.post("/api/orders/triggerTradeTracker",data).then(function(res){},function(res){})}}]),app.service("Cookie",[function(){var _getCookie,_deleteCookie;return _getCookie=function(cookieName){for(var allcookies=document.cookie,cookieArray=allcookies.split(";"),i=0;i<cookieArray.length;i++)if(name=cookieArray[i].split("=")[0],value=cookieArray[i].split("=")[1],cookieName==name.trim())return value;return!1},_setCookie=function(cookieName,cookieValue,expireTime){var now=new Date,time=now.getTime();time+=3600*expireTime*1e3,now.setTime(time),document.cookie=cookieName+"="+cookieValue+"; expires="+now.toUTCString()+"; SameSite=None; Secure; path=/"},_deleteCookie=function(name){document.cookie=name+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},{set:function(data){var cookieName,cookieValue,expireTime;cookieName=data.cookieName,cookieValue=data.cookieValue,expireTime=data.expireTime||1,_setCookie(cookieName,cookieValue,expireTime)},get:function(cookieName){return _getCookie(cookieName)},delete:function(cookieName){return _deleteCookie(cookieName)}}}]),app.directive("lazy",function($timeout){return{restrict:"C",link:function(scope,elm){$timeout(function(){$(elm).lazyload({skip_invisible:!0}),$(".fm-recommended-products-container").length&&$("img.lazy").lazyload({container:$(".fm-recommended-products-container")})},0)}}}),app.directive("recommendSecScroll",function(){return{link:function(scope,element,attr){element.on("scroll",function(){var newScrollLeft=element.scrollLeft(),width=element.width(),scrollWidth=element.get(0).scrollWidth,offset=0;$(".fm-recommend-right-arrow").removeClass("deactive"),$(".fm-recommend-left-arrow").removeClass("deactive"),scrollWidth-newScrollLeft-width-1<=offset&&$(".fm-recommend-right-arrow").addClass("deactive"),0===newScrollLeft&&$(".fm-recommend-left-arrow").addClass("deactive")})}}}),$('a[href*="#mainController"]').click(function(){var target=$(this.hash);if(target=target.length?target:$("[name="+this.hash.slice(1)+"]"),target.length)return $("html, body").animate({scrollTop:target.offset().top},750),!1}),app.filter("trustUrl",["$sce",function($sce){return function(recordingUrl){return $sce.trustAsResourceUrl(recordingUrl)}}]),app.filter("to_trusted",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]),app.controller("Main",["$scope","$http","$timeout","$sce","Api","$localstorage","$window","TrackingService","Cookie","$interval","MenuLiteService","$location",function($scope,$http,$timeout,$sce,Api,$localstorage,$window,TrackingService,Cookie,$interval,MenuLiteService,$location){function _get(obj,path){if(!path)return obj;var path=path.split("."),key=path.shift();return obj.hasOwnProperty(key)?_get(obj[key],path.join(".")):void 0}function _getProductFromId(productId){var product={};if($scope.menu&&$scope.menu.collections)for(var i=0;i<$scope.menu.collections.length;i++)for(var collection=$scope.menu.collections[i],j=0;j<collection.products.length;j++)if(collection.products[j].id==productId)return collection.products[j];return product}function _processProduct(product){return"number"==typeof product&&(product=_getProductFromId(product)),product}function popstateEmitted(){"coupon"==$scope.cartScreen||"delivery"==$scope.cartScreen?($scope.cartScreen="cart",$scope.$apply()):MENU_CART.hide()}function defaultMenuCartTimeCounterEvent(){++$scope.fmTimeSpentOnMenuPageCounter,$scope.fmTimeSpentOnMenuPageCounter>10||setTimeout(defaultMenuCartTimeCounterEvent,3e4)}function openCart(){if($scope.showCart=!0,window.setTimeout(function(){initializeCategoryArrows()},200),$scope.cart&&$scope.cart.items&&$scope.cart.items.length>0){for(var product_ids=[],i=0;i<$scope.cart.items.length;i++)product_ids.push($scope.cart.items[i].productId);TrackingService.postEvent("Screen visited",{screenname:"cart",email:$scope.user&&$scope.user.email&&""!=$scope.user.email?$scope.user.email:"",Timestamp:(new Date).getTime(),"Corporate user":!(!$scope.user||!$scope.user.corporateAccountStatus||"active"!=$scope.user.corporateAccountStatus&&"pending"!=$scope.user.corporateAccountStatus),"Product IDs":product_ids.toString(),"Source screen":"/menu"})}}function initializeCategoryArrows(){$scope.showRightCategoryArrow=!1,$scope.showLeftCategoryArrow=!1,$scope.headerMarginLeft=0,$("#fm-collection-nav ul").width()>$("#fm-collection-nav").width()?($scope.showRightCategoryArrow=!0,$("#fm-collection-nav ul").css({margin:"auto 0"})):$("#fm-collection-nav ul").css({margin:"auto"})}$scope.fmBannerVideoIndex=0,$scope.initiatePaymentFailed=!0,$scope.initiatePaymentFailedMsg=null,$scope.fmIsMobileTemplate=window.fmIsMobileTemplate,$scope.googleMapControlLocation={},$scope.googleMapControlEdit={},$scope.googleMapNewAddress="",$scope.noLocation=!0,$scope.noLocateMe=!1,$scope.googleMapDefaultLocation={addressLine2:"Koramangala, Bengaluru, Karnataka, India",lat:12.9279232,lon:77.62710779999998},$scope.fmStaticRoot=window.fmStaticRoot,$scope.serverDown=window.serverDown,$scope.loginPageScreens={showLoginScreen:!0,showRegisterScreen:!1,showRegisterEmailScreen:!1,showForgotPasswordScreen:!1},$scope.loadingImage2=$scope.fmStaticRoot+"/menu/images/loadingImage2.jpg",$scope.fmMessageImage=$scope.fmStaticRoot+"/menu/images/message.svg",$scope.fmBadgeNew=$scope.fmStaticRoot+"/menu/images/fm-badge-new.svg",$scope.fmGhost=$scope.fmStaticRoot+"/menu/images/ghost1.1.svg",$scope.fmIceCreamImage=$scope.fmStaticRoot+"/common/images/icn-ice-cream.svg",$scope.fm_app_url="",$scope.show_fm_app_banner=!1,$scope.fmFilterMobileShow=!1,$scope.showNupMessageInCart=!1,window.fmMetaData&&($scope.fmMetaData=window.fmMetaData),$scope.setVideoBannerIndex=function(index){$scope.fmBannerVideoIndex=index;var bannerVideoDom=document.getElementById("fm-banner-video"),fmCurrentBannerItem=$scope.menu.banners[$scope.fmBannerVideoIndex];if(bannerVideoDom){for(var i=1;i<4;i++)if(fmCurrentBannerItem["v"+i]&&bannerVideoDom.canPlayType("video/"+fmCurrentBannerItem["v"+i].split(".")[fmCurrentBannerItem["v"+i].split(".").length-1])&&bannerVideoDom.canPlayType("video/"+fmCurrentBannerItem["v"+i].split(".")[fmCurrentBannerItem["v"+i].split(".").length-1]).length>0){bannerVideoDom.src=fmCurrentBannerItem["v"+i];break}document.getElementById("fm-banner-video").play(),TrackingService.postEvent("Screen visited",{screenname:"video pop up"})}},$scope.openLoginPageScreen=function(key){var screenKey;for(screenKey in $scope.loginPageScreens)$scope.loginPageScreens[screenKey]=key==screenKey;
},$scope.hideAppBanner=function(){$scope.show_fm_app_banner=!1},$scope.setAppUrl=function(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;/windows phone/i.test(userAgent),/android/i.test(userAgent)&&($scope.fm_app_url="https://play.google.com/store/apps/details?id=com.freshmenu&utm_source=website&utm_medium=dlink&utm_campaign=appdownload",$scope.show_fm_app_banner=!0),/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream&&($scope.fm_app_url="https://itunes.apple.com/in/app/freshmenu-fresh-meal-delivery/id957179182?mt=8&utm_source=website&utm_medium=dlink&utm_campaign=appdownload",$scope.show_fm_app_banner=!0)},$scope.setAppUrl();var _getHours,_getMinutes,_getMeridian,_handleInitiatePaymentFailure,_getFormattedTime,_setUTMSourceParamIfExists,_getParameterByName;window.metaData?!window.metaData.isMenuPage&&window.loadExternalScripts():window.loadExternalScripts(),$scope.newAddress="",$scope.fmNewFilterList=[];var fmOpenLocationPopup=!1;_getParameterByName=function(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},_setUTMSourceParamIfExists=function(){var utmSource=_getParameterByName("utm_source"),subId=_getParameterByName("sub_id");utmSource&&utmSource.length>0&&Api.setUTMSource({utmSource:utmSource,subId:subId},function(){})},_getHours=function(time){var hours="";return hours=Math.floor(time/60)<=12?Math.floor(time/60):Math.floor(time/60)-12},_getMinutes=function(time){var minutes="";return time%60<10&&(minutes="0"),minutes+=time%60},_getMeridian=function(time){var meridian="";return meridian=Math.floor(time/60)<12?"AM":"PM"},_getFormattedTime=function(time){var formattedTime="";return formattedTime+=_getHours(time),formattedTime+=":",formattedTime+=_getMinutes(time),formattedTime+=_getMeridian(time)},_getFormattedMobileNumber=function(phoneNumber){var formattedPhoneNumber="";return phoneNumber&&(formattedPhoneNumber=phoneNumber.length>10?phoneNumber.substring(phoneNumber.length-10,phoneNumber.length):phoneNumber),formattedPhoneNumber},$scope.showBanner=!0,$scope.bannerUrl=window.bannerUrl,$scope.user={},$scope.addresses={},window.locality?($(".temp-location-mobile-bar").hide(),$scope.location=window.locality):($(".temp-location-mobile-bar").hide(),$scope.location={}),$scope.menu={},$scope.collection={},$scope.cities=[],$scope.validation={},$scope.forceLocateMe=!1,$scope.checkout={},$scope.formattedAddress="",$scope.showLoginContainer=!0,$scope.isFilterButtonClicked=!1,$scope.fmCategoryHeader="Today's Menu",$scope.fmShowExpressDeliveryItems=!1,$scope.fmMobileCategoryListShow=!1,$scope.showLocationPopupErrorMessage=!1,$scope.fmfreebieMessageShown=!1,$scope.fmshowFreebieMessage=!1,$scope.defaultDeliveryTime=45,$scope.fmDefaultBanner="https://d3gy1em549lxx2.cloudfront.net/83011f0f-eb4c-4a25-b7c2-9d5e06e503ce.jpg",$scope.cart={items:[],totalAmount:0,finalAmount:0,offer:null},$scope.forms={register:{},login:{},address:{},checkout:{},update:{},mobileVerification:{}},$scope.offerCode="",$scope.cartItemsCount=0,$scope.highlightSearch=!1,$scope.clearAutocomplete=!1,$scope.cartAction=!1,$scope.registerLoading=!1,$scope.loginLoading=!1,$scope.fmEmailExists=window.fmEmailExists,$scope.subscribeNewsletterError="",$scope.subscriptionEmail="",$scope.fmsetDelayToShowfmskiptositeModel=1e4,$scope.fmsetCookieExpiretimeTofmskiptositeModel=168;var itemIsInRecommendedSec=!1;$scope.fmIsCategoryHomePage=window.fmIsCategoryHomePage,$scope.currentPathname=window.location.pathname.split("/"),$scope.currentPathname[1]="menu",$scope.favoriteInProcess=!1,$scope.favoriteProductId="",$scope.favoriteTriggeredEvent={},$scope.loginSourceScreen="",$scope.loginHideCallbackAdded=!1,$scope.fromLoginSuccess=!1,$scope.fmCartIsOpen=!1,$scope.cartScreen="cart",$scope.callOpenCorporateLocationCalloutAfterLogin=!1,$scope.openCouponScreen=function(){$scope.forms.offer||($scope.forms.offer={offerCode:""}),$scope.cartScreen="coupon"},$scope.removeCoupon=function($event){$event.stopPropagation(),$scope.addOfferCode(null)},$scope.fmShowFavouriteContainer=!1,$scope.fmPriceFilters=[90,120,150],$scope.fmCuisineFilters=[],$scope.processGoogleAutocomplete=function(result){var obj={addressLine2:"",locality:{city:{name:""}}};if(_.isEmpty(obj.addressLine2)){obj.addressLine2="",result&&result.types&&result.types.indexOf("establishment")>=0&&(obj.addressLine2=result.name);for(var i=0;i<result.address_components.length;i++){var component=result.address_components[i];component.types.indexOf("postal_code")>=0&&(obj.zipCode=component.long_name),component.types.indexOf("sublocality_level_1")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("sublocality_level_2")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("sublocality_level_3")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("neighborhood")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("route")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("premise")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("sublocality")>=0?(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.addressLine2+=component.long_name):component.types.indexOf("locality")>=0&&(obj&&obj.addressLine2&&obj.addressLine2.length>0&&(obj.addressLine2+=", "),obj.locality.city.name=component.long_name,obj.addressLine2+=component.long_name)}}return obj.lat=result.geometry.location.lat(),obj.lon=result.geometry.location.lng(),obj},$scope.triggerInfoTapped=function(product){TrackingService.postEvent("InfoTapped",{Title:product.title,Category:product.categories&&product.categories[0]&&product.categories[0].name?product.categories[0].name:"",Cost:product.price,pos_index:scrollY,Source:"/menu"})},$scope.sendResetPasswordDetails=function(details){$scope.sendingUserPasswordDetails=!0,details=details||{},Api.sendResetPasswordDetails(details,function(response){TrackingService.postEvent("Reset password",{Status:"Success",Email:details.email?details.email:""}),$scope.sendingUserPasswordDetails=!1,$scope.forms.forgotPassword=$scope.forms.forgotPassword||{},$scope.forms.forgotPassword.success=!0,$scope.forms.forgotPassword.iSError=!1,$scope.forms.forgotPassword.errors=response&&response.data&&response.data.message?response.data.message:""},function(response){TrackingService.postEvent("Reset password",{Status:"Failure",Email:details.email?details.email:"",error:response.data&&response.data.message?response.data.message:""}),$scope.sendingUserPasswordDetails=!1,$scope.forms.forgotPassword=$scope.forms.forgotPassword||{},$scope.forms.forgotPassword.success=!1,$scope.forms.forgotPassword.iSError=!0,$scope.forms.forgotPassword.errors=response})},$scope.takeActionBasedOnPsd=function(){"NEW_USER_ELIGIBLE"===$scope.menu.psd.wt&&(TrackingService.postEvent("Clicked",{action:"Sign in",source:"NUP widget"}),$scope.openSignupModalFormHeader())},$scope.resetPassword=function(token,data){Api.resetPassword({password:data.password,token:token},function(response){$scope.forms.resetPassword={success:!0}},function(data){$scope.forms.resetPassword={errors:data}})},$scope.$watch("location",function(newValue,oldValue){$scope.forms.checkout.address=newValue,$scope.getCheckoutData()}),$scope.getParameterByName=function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},$scope.formatDefaultMenu=function(data,callback){$scope.menu=data,$scope.defaultMenu=!0,$scope.menu.collections&&$scope.mapMenu(),_.isUndefined(callback)||callback(data)},$scope.getTimeFromMinutes=function(value){var hours=Math.floor(value/60),minutes=value-60*hours,merid="AM";return hours>=12&&(hours-=12,merid="PM"),minutes<10&&(minutes="0"+minutes),hours+":"+minutes+merid},$scope.getAddressLine2FormattedAddress=function(add){var st="";return add&&(add.addressLine2&&(st=add.addressLine2),add.locality&&!_.isEmpty(add.locality.name)&&(st=st+" "+add.locality.name),add.locality&&add.locality.city&&!_.isEmpty(add.locality.city.name)&&(st=st&&st.length>1?st+", "+add.locality.city.name:add.locality.city.name)),st},$scope.noItemsInView=function(){var count=0;return _.each($scope.menu.collections,function(collection){_.each(collection.products,function(product){var ok=!($scope.newFilterList.length>0)||$scope.hasAnyCategories(product,$scope.newFilterList);ok&&($scope.showOnlyExpressItems&&!product.isExpressItem||count++)})}),0==count},$scope.getSearchInput=function(){return $scope.searchInput||""},$scope.selectCorporateAddressOfUser=function(){$scope.setNewLocationAddress($scope.user.corporateAddresses[0]),TrackingService.postEvent("pop up",{action:"select corporate address",title:"Corporate location pop up"}),$scope.closeCorporateLocationCallout()},$scope.closeCorporateLocationCalloutBtn=function(type){TrackingService.postEvent("pop up",{action:"select corporate "+type,title:"Corporate location pop up"}),Cookie.set({cookieName:"fm-corp-pp",cookieValue:!0,expireTime:1}),$scope.closeCorporateLocationCallout()},$scope.closeCorporateLocationCallout=function(){$scope.showCorporateLocationCallout=!1,$scope.defaultLocationModal=!1},$scope.decideToShowCorpLocPromt=function(){!($scope.user&&$scope.user.id&&$scope.user.corporateAccountStatus&&"active"==$scope.user.corporateAccountStatus&&$scope.user.corporateAddresses&&$scope.user.corporateAddresses.length>0&&$scope.menu&&$scope.menu.cm&&"corp_disc_another_loc"==$scope.menu.cm)||$scope.location&&$scope.location.addType&&"corp"==$scope.location.addType||Cookie.get("fm-corp-pp")&&1==Boolean(Cookie.get("fm-corp-pp"))?$scope.showCorporateLocationCallout=!1:$scope.showCorporateLocationCallout=!0},$scope.initMenuPage=function(metadata){for(var key in metadata)$scope[key]=metadata[key];$(".temp-location-mobile-bar").hide(),$scope.setCityBasedOnMenu($scope.menu),$scope.menu&&$scope.menu.collections&&$scope.segregateMenu($scope.menu.collections),$scope.isUserCallDone=!0,$scope.loading=!1,$scope.formatCartInfo($scope.cartInfo),$scope.noLocation=_.isEmpty($scope.location),_.isEmpty($scope.location)?$scope.formatDefaultMenu($scope.menu):($scope.formatMenu($scope.menu),$scope.newAddress=$scope.getAddressLine2FormattedAddress($scope.location)),_.isEmpty($scope.user)||$scope.getUserAddresses(),$scope.setDividerText(),$scope.selectedCity=_.find($scope.citySelectorOptions,function(item){return $scope.menu.serviceable}),$scope.decideToShowCorpLocPromt()},$scope.redirectToPage=function(pageName,dataToCleverTap){dataToCleverTap&&TrackingService.postEvent({Section:dataToCleverTap}),window.location.href="/"+pageName},$scope.checkAndRedirectIncaseReq=function(){if(!location.hash&&!location.pathname.includes("/profile")){var redirectUrl,state,code;redirectUrl=_getParameterByName("redirect_uri"),state=_getParameterByName("state"),code=$scope.user.accessToken;var patt=/\/login/;patt.test(location.pathname)&&(redirectUrl&&redirectUrl.length>0?setTimeout(function(){$scope.redirectToPage("address?state="+state+"&code="+code+"&redirect_uri="+redirectUrl)},1500):$scope.redirectToPage(""))}},$scope.runLoginPage=function(){$scope.getCities()},$scope.triggerTimeSpentEventOncart=function(type,during){TrackingService.postEvent("timeSpent",{pageName:type,duration:(new Date).getTime()-new Date(window.fmCartMenuTimer).getTime(),totalDuration:1e4*$scope.fmTimeSpentOnMenuPageCounter,noOfItemsInCart:$scope.cart&&$scope.cart.items&&$scope.cart.items.length?$scope.cart.items.length:0,noOfTimesVisited:$scope.noOfTimesCartVisited,during:during}),"openingCart"==during&&++$scope.noOfTimesCartVisited,window.fmCartMenuTimer=Date.now()},"undefined"!=typeof MODAL_LOCATION_ADDRESS&&(MODAL_LOCATION_ADDRESS.openCallbacks.push(function(){$scope.googleMapAddressPopupInitOpen=!0,$scope.fireGAEvent("Header","load","location_popup")}),MODAL_LOCATION_ADDRESS.closeCallbacks.push(function(){$scope.googleMapAddressPopupInitOpen=!1})),$scope.isLoginRegisterOpened=!1,$scope.onModalEJSFileLoaded=function(){MODAL_LOCATION_ADDRESS.openCallbacks.push(function(){var viewedObj={};viewedObj.screenName="Home",setTimeout(function(){$window.clevertap.event.push("Screen Visited",viewedObj)},5e3),setTimeout(function(){PRODUCT_DETAILS_POPUP.hide()},200),$scope.fireGAEvent("Header","load","location_popup")}),PRODUCT_DETAILS_POPUP.openCallbacks.push(function(){$scope.isProductDetailsPopupOpened=!0}),PRODUCT_DETAILS_POPUP.closeCallbacks.push(function(){$scope.isProductDetailsPopupOpened=!1}),MODAL_LOCATION_ADDRESS.modalOverlayCloseEventActions.push(function(){$timeout(function(){_.isEmpty($scope.location)||$scope.defaultMenu||$timeout(function(){$scope.searchInput=$scope.location.addressLine2})})}),$scope.noOfTimesCartVisited=0,MENU_CART.openCallbacks.push(function(){$scope.fmCartIsOpen=!0,$scope.triggerTimeSpentEventOncart("menu","openingCart")}),MENU_CART.closeCallbacks.push(function(){$scope.fmCartIsOpen=!1,$scope.triggerTimeSpentEventOncart("cart","closingCart")}),1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||(MODAL_LOGIN.openCallbacks.push(function(){$scope.isLoginRegisterOpened=!0}),MODAL_LOGIN.closeCallbacks.push(function(){$scope.isLoginRegisterOpened=!1}),MODAL_REGISTER_CHOISE.openCallbacks.push(function(){$scope.isLoginRegisterOpened=!0}),MODAL_REGISTER_CHOISE.closeCallbacks.push(function(){$scope.isLoginRegisterOpened=!1}),MODAL_REGISTER_EMAIL.openCallbacks.push(function(){$scope.isLoginRegisterOpened=!0}),MODAL_REGISTER_EMAIL.closeCallbacks.push(function(){$scope.isLoginRegisterOpened=!1}))},$scope.changeQty=function(item,oldVal,newVal,$index){if(item.fromIncrement=!0,"bulk"==newVal)return fmIsMobileTemplate?MENU_CART.hide(null,function(){MODAL_BULK.show()}):($scope.closeCart(),MODAL_BULK.show()),void $scope.addToCart(item,15-oldVal,$index);if("0"==newVal)return void $scope.removeFromCart(item,oldVal,!0,oldVal);var qty=parseInt(oldVal)-parseInt(newVal);$scope["checkoutCartLoading"+$index]=!0,qty<0?$scope.addToCart(item,Math.abs(qty),$index):$scope.removeFromCart(item,Math.abs(qty),!0,item.quantity,$index)},$scope.$watch("addresses.addresses",function(newValue,oldValue){_.isEmpty(newValue)&&!_.isEmpty(oldValue)&&($scope.addresses.addresses=oldValue)}),$scope.loadedMetaData=!1,$scope.getGeocoderLocation=function(params,cb){var geocoder=new google.maps.Geocoder,address=params.city;params.locality&&(address+=","+params.locality),geocoder.geocode({address:address},function(results){console.log(results),$scope.setUserLocationAndClearCartAndGetMenu({addressLine2:results[0].formatted_address,lat:results[0].geometry.location.lat(),lon:results[0].geometry.location.lng()},function(){cb&&cb()})})},$scope.fmUpdateUserProfileInCleverTap=function(data){data.user&&data.user.id?TrackingService._setUserInfo(data.user):Cookie.get("fmAlternativeEmailId")&&Cookie.get("fmAlternativeEmailId").length>0&&TrackingService._setUserInfo({email:Cookie.get("fmAlternativeEmailId")})};var fireHomeEvent=function(){window.criteo_q&&(window.criteo_q.push({event:"setAccount",account:39162},{event:"setSiteType",type:window.fmIsMobileTemplate?"m":"d"},{event:"viewHome"}),console.log("CRITEO ---- MENU PAGE"))};$scope.isTodaysMenu=!0,"/futuremenu"===window.location.pathname&&($scope.isTodaysMenu=!1),$scope.fmLoadAfterOnload=function(){window.onload=function(){window.fmIsMobileTemplate?setTimeout(function(){var src="//static.criteo.net/js/ld/ld.js",ref=document.getElementsByTagName("script")[0],script=document.createElement("script");script.src=src,script.async=!1,script.crossorigin="anonymous",script.onload=fireHomeEvent,ref.parentNode.insertBefore(script,ref)},5e3):fireHomeEvent(),$scope.fmShowFavouriteContainer=!0,setTimeout(function(){$scope.handleCollectionHash()},1e3),angular.element($window).click(function(){$scope.$apply(function(){$scope.fmFilterMobileShow=!1}),event.stopPropagation()})}},$scope.runMenu=function(params){if($scope.fmBaseUrl=$location.$$protocol+"://"+$location.$$host+"/partials/menu/default/allModals",console.log("###################################"),$scope.isPageRendered=!0,$scope.loading=!0,$scope.getMobileOperatingSystem(),window.metaData){var metadata=window.metaData;if(metadata.menu=MenuLiteService.format(metaData.menu),console.log(metadata.menu),"true"==$scope.serverDown)return;metadata.location&&metadata.location.isFromIpAddress&&($scope.defaultLocationModal=!0),metadata.menu&&metadata.menu.banners?$scope.callfmSetBanners(metadata,!0):$scope.fmSetBanners([{img_ur:$scope.fmDefaultBanner}]),$scope.fmUpdateUserProfileInCleverTap(metadata),_setUTMSourceParamIfExists(),$scope.initMenuPage(metadata),$scope.loadedMetaData=!0,_.isEmpty(params)?$scope.setDefaultMenu(!0):$scope.getGeocoderLocation(params,function(){$scope.setDefaultMenu(!0)}),setTimeout(function(){window.scriptsLoadedAlready||(window.loadSocialScripts(),window.scriptsLoadedAlready=!0)},1e3),Object.keys(metadata.user).length||($scope.showSubscriptionBlock=!0),$scope.fmLoadAfterOnload(),$scope.filterBindHideEvent()}else $scope.formatMetadataFetchedEarlier=function(metadata){metadata.location&&metadata.location.isFromIpAddress&&($scope.defaultLocationModal=!0),metadata.menu=MenuLiteService.format(metadata.menu),metadata.menu&&metadata.menu.banners?$scope.callfmSetBanners(metadata,!0):$scope.fmSetBanners([{img_ur:$scope.fmDefaultBanner}]),$scope.fmUpdateUserProfileInCleverTap(metadata),_setUTMSourceParamIfExists(),$scope.initMenuPage(metadata),$scope.loadedMetaData=!0,_.isEmpty(params)?$scope.setDefaultMenu(!0):$scope.getGeocoderLocation(params,function(){$scope.setDefaultMenu(!0)}),setTimeout(function(){window.scriptsLoadedAlready||(window.loadSocialScripts(),window.scriptsLoadedAlready=!0)},1e3),Object.keys(metadata.user).length||($scope.showSubscriptionBlock=!0),window.setTimeout(function(){initializeCategoryArrows()},0)},$scope.fmLoadAfterOnload(),$scope.filterBindHideEvent();$scope.setLocationsSuggestions(),$scope.setCitySelector(),$scope.collectionEvents(),$(".fm-show-more-link").each(function(){var $link=$(this),$content=$link.parent().prev("div.text-content");console.log($link);var visibleHeight=$content[0].clientHeight,actualHide=$content[0].scrollHeight-1;actualHide>visibleHeight?$link.show():$link.hide()}),$scope.menu&&$scope.menu.collections&&$scope.menu.collections.length?$scope.fireGAEvent("Menu","load","menu_load_successful"):$scope.fireGAEvent("Menu","load","menu_load_failure"),(!$scope.menu.isTodaysMenu&&$scope.menu.message||$scope.menu.sms)&&$scope.fireGAEvent("Menu","load","strip_banner",null,$scope.menu.message?$scope.menu.message:$scope.menu.sms)},$scope.filterBindHideEvent=function(){$(document).ready(function(){$(document).click(function(e){var filter_container=document.getElementsByClassName("fm-filters-container"),filter_button=document.getElementsByClassName("fm-filter-by-desktop");!filter_container[0]||filter_container[0].contains(e.target)||filter_button[0].contains(e.target)||($scope.fmMobileCategoryListShow=!1),e.target.classList.value.split(" ").indexOf("logged-in-nav-bar")<0&&e.target.classList.value.split(" ").indexOf("fm-name-header")<0&&e.target.classList.value.split(" ").indexOf("fm-down-arrow")<0&&$("#user-dropdown").removeClass("active")})})},$scope.$watch("defaultMenu",function(newVal,oldVal){console.log(newVal)}),$scope.openExitIntentPopup=function(){TrackingService.postEvent("Screen Visited",{screenName:"Exit intent"}),$("#location-address").hasClass("open")&&(fmOpenLocationPopup=!0,MODAL_LOCATION_ADDRESS.hide()),MODAL_LOGIN.hide(),MODAL_REGISTER_CHOISE.hide(),MODAL_REGISTER_EMAIL.hide(),MODAL_EXIT_INTENT.show(),Cookie.set({cookieName:"fmShowExitIntentPopup",cookieValue:!1,expireTime:24}),$scope.fireGAEvent("Exit","load","exit_intent_popup")},$scope.closeExitIntentPopup=function(){$scope.showExitIntentPopup=!1,MODAL_EXIT_INTENT.hide(),fmOpenLocationPopup&&(fmOpenLocationPopup=!1,MODAL_LOCATION_ADDRESS.show())},$scope.sendExitIntentOffer=function(form){console.log("SEND"),$scope.fmExitIntentPopupMessage={};var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;console.log("SEND"),$scope.exitIntentEmail=$("#exitIntentEmail").val(),re.test($scope.exitIntentEmail)?($scope.loading=!0,Cookie.set({cookieName:"fmAlternativeEmailId",cookieValue:$scope.exitIntentEmail,expireTime:720}),Api.fmSendOfferCode($scope.exitIntentEmail,function(response){$scope.loading=!1,console.log("DONE"),response&&response.status&&200==response.status?response.data.isExistingUser?($scope.fmExitIntentPopupMessage.text="You are already registered with Freshmenu!",$scope.fmExitIntentPopupMessage.type="failure",$scope.fireGAEvent("Exit","click","send_offer_failure",null,"You are already registered with Freshmenu!")):($scope.fmExitIntentPopupMessage.text="Email sent successfully!",$scope.fmExitIntentPopupMessage.type="success",TrackingService.postEvent("Clicked",{action:"Send offer",screenname:"Exit intent"}),$scope.fireGAEvent("Exit","click","send_offer_success")):($scope.fireGAEvent("Exit","click","send_offer_failure",null,"Something went wrong. Please try again."),$scope.fmExitIntentPopupMessage.text="Something went wrong. Please try again.",$scope.fmExitIntentPopupMessage.type="failure")},function(){$scope.fmExitIntentPopupMessage.text="Something went wrong. Please try again.",$scope.fmExitIntentPopupMessage.type="failure"})):($scope.fmExitIntentPopupMessage.text="Please enter a valid email address.",$scope.fmExitIntentPopupMessage.type="failure",$scope.fireGAEvent("Exit","click","send_offer_failure",null,"Please enter a valid email id"))};var marketingBlocks=["newsletterSignUp","img1","img2","img3","img4"];$scope.areMarketingBlocksLeft=function(index,isMobile,indexOfBlock){for(var productsLength,totalMarketingBlocks=marketingBlocks.length,i=0;i<index;i++)if(productsLength=$scope.newFilterList.length>0||$scope.showOnlyExpressItems?$scope.hasCollectionAnyCategoryItems($scope.menu.collections[i],$scope.newFilterList):$scope.menu.collections[i].products.length,productsLength>0&&(totalMarketingBlocks-=1),!totalMarketingBlocks)return!1;return totalMarketingBlocks+indexOfBlock===marketingBlocks.length},$scope.canShowMarketingBlock=function(collection,index,indexOfBlock,isMobile){var productsLength=0;if(!$scope.showSubscriptionBlock){if(0===indexOfBlock)return!1;indexOfBlock-=1}return productsLength=$scope.newFilterList.length>0||$scope.showOnlyExpressItems?$scope.hasCollectionAnyCategoryItems(collection,$scope.newFilterList):collection&&collection.products?collection.products.length:0,0!==productsLength&&$scope.areMarketingBlocksLeft(index,isMobile,indexOfBlock)},$scope.canShowMarketingBlockMobile=function(serialNumber,index,indexOfBlock){if(!$scope.menu.collections)return!1;for(var i=0;i<$scope.menu.collections.length&&$scope.menu.collections[i].sequenceNumber!=serialNumber;i++);return $scope.canShowMarketingBlock($scope.menu.collections[i],index,indexOfBlock,!0)},$scope.openDigitalMagazin=function(){var fmMagazineLink="https://www.flipsnack.com/freshmenuindia/food-for-thought-issue-1.html";TrackingService.postEvent("Screen visited",{screenname:"Magazine"}),TrackingService.postEvent("Clicked",{action:fmMagazineLink}),$window.open(fmMagazineLink,"_blank")},$scope.openSubscriptionPopup=function(){MODAL_NEWSLETTER_SUBSCRIPTION.show()},$scope.closeSubscriptionPopup=function(){MODAL_NEWSLETTER_SUBSCRIPTION.hide()},$scope.subscribeToNewsletter=function(){$scope.subscribeNewsletterError="";var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$scope.subscriptionEmail=$("#subscriptionEmail").val(),re.test($scope.subscriptionEmail)?($scope.loading=!0,Api.fmSubscribeToEmail($scope.subscriptionEmail,function(){$scope.loading=!1,marketingBlocks.splice(marketingBlocks.indexOf("newsletterSignUp"),1),$scope.showSubscriptionBlock=!1,$scope.showSubscriptionBlockSuccessMsg=!0,TrackingService.postEvent("Clicked",{action:"subscribed",screenname:"menu catalog"})})):$scope.subscribeNewsletterError="Please enter a valid email address!"},$scope.isEmpty=function(obj){return _isEmpty(obj)},$scope.setDefaultMenu=function(){400==$scope.validation.statusCode&&_.isEmpty($scope.location)?$scope.citySelected=_.first($scope.cities):$scope.citySelected=_.find($scope.cities,function(item){return _get($scope.validation,"serviceability.addressDTO.locality.city.id")==item.id}),$scope.cityName=$scope.citySelected&&$scope.citySelected.name?$scope.citySelected.name:"",$scope.city=_.find($scope.cities,function(item){return $scope.location&&$scope.location.locality&&$scope.location.locality.city?$scope.location.locality.city.id==item.id:!$scope.location||!$scope.location.addressLine2||$scope.location.addressLine2.indexOf(item.name)>-1}),$scope.citySelected=angular.copy($scope.city),$scope.searchInput=_.isUndefined($scope.location)?"":$scope.getAddressLine2FormattedAddress($scope.location),$scope.citySelected?$scope.cityName=$scope.citySelected.name:$scope.cityname=$scope.formattedAddress,$scope.searchInput=_.isUndefined($scope.location)?"":$scope.location.addressLine2,_.isEmpty($scope.searchInput)&&($scope.searchInput=$scope.googleMapDefaultLocation.addressLine2)},$scope.setCitySelector=function(){$scope.citySelectorOptions=[{address:{locality:{city:{id:1,name:"Bengaluru"}},pos:{lat:12.971599,lng:77.594563}}},{address:{locality:{city:{id:2,name:"Mumbai"}},pos:{lat:19.075984,lng:72.877656}}},{address:{locality:{city:{id:3,name:"New Delhi"}},pos:{lat:28.613939,lng:77.209021}}},{address:{locality:{city:{id:4,name:"Gurugram"}},pos:{lat:28.459497,lng:77.026638}}}]},$scope.clearLocation=function(){$scope.newAddress=""},$scope.handleUrlPrams=function(){$scope.msg=$scope.getParameterByName("msg")},$scope.storeCheckoutData=function(){if(("undefined"!=typeof Storage||_.isUndefined($scope.user)||_.isUndefined($scope.user.id))&&localStorage)try{localStorage.setItem("guestUser",JSON.stringify($scope.forms.checkout.user)),localStorage.setItem("guestAddress",JSON.stringify($scope.forms.checkout.address))}catch(e){}},$scope.clearGuestAddress=function(){("undefined"!=typeof Storage||_.isUndefined($scope.user)||_.isUndefined($scope.user.id))&&localStorage&&localStorage.removeItem("guestAddress")},$scope.getCheckoutData=function(){if("undefined"!=typeof Storage&&_.isUndefined($scope.user.id)&&localStorage){var guestUser=localStorage.getItem("guestUser"),guestAddress=localStorage.getItem("guestAddress");null==guestUser||"undefined"==guestUser||_.isUndefined($scope.forms)||_.isUndefined($scope.forms.checkout)||($scope.forms.checkout.user=JSON.parse(guestUser)),null==guestAddress||_.isUndefined($scope.forms)||_.isUndefined($scope.forms.checkout)||($scope.forms.checkout.address=JSON.parse(guestAddress))}},$scope.selectAddress=function(address){$scope.forms.checkout.address=address,$scope.location=address,$scope.forms.checkout.user=_.extend($scope.forms.checkout.user,_.pick(address,"firstName","lastName","mobileNumber")),$scope.setUserLocation(_.omit(address,"firstName","lastName","mobileNumber"),function(){$scope.getCart(),$scope.getMenu()})},$scope.formatUserAddressess=function(data,select){var addressList=[];addressList.push.apply(addressList,$scope.user.corporateAddresses),addressList.push.apply(addressList,$scope.user.userAddresses);var list=_.map(addressList,function(address){return _.isEmpty(address.mobileNumber)||(address.mobileNumber=address.mobileNumber.substring(address.mobileNumber.length-10,address.mobileNumber.length)),address});if(data.addresses=list,$scope.addresses=data,data.lastUsedAddressId){var address=_.find(data.addresses,function(address){return address.id==data.lastUsedAddressId});$scope.lastUsedAddress=address}if(select){var addressId=$localstorage.get("lastUsedAddressId",!1);if(addressId){var address=_.find(data.addresses,function(address){return address.id==addressId});if(_.isUndefined(address)){if(data.lastUsedAddressId){var address=_.find(data.addresses,function(address){return address.id==data.lastUsedAddressId});$scope.selectAddress(address)}}else $scope.selectAddress(address)}else if(data.lastUsedAddressId){var address=_.find(data.addresses,function(address){return address.id==data.lastUsedAddressId});$scope.selectAddress(address),$scope.lastUsedAddress=address}}},$scope.getUserAddresses=function(select,cb){Api.getUserAddresses(function(addresses){$scope.formatUserAddressess(addresses,select),cb&&cb()})},$scope.addNewItem=function(){$scope.checkoutPage&&(window.location.href="/"),fmIsMobileTemplate?MENU_CART.hide():$scope.closeCart(),$("#menu").goTo(150)},$scope.getMobileOperatingSystem=function(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;userAgent.match(/iPad/i)||userAgent.match(/iPhone/i)||userAgent.match(/iPod/i)?$scope.OS={type:"iOS",app_url:"https://itunes.apple.com/app/id957179182"}:userAgent.match(/Android/i)?$scope.OS={type:"Android",app_url:"https://play.google.com/store/apps/details?id=com.freshmenu"}:$scope.OS={type:"unknown"}},$scope.getUserLocation=function(callback){Api.getUserLocation(function(data){$scope.location=data,callback&&callback(data)})},$scope.setCityForNewAddress=function(object){$scope.forms.address.address.locality={city:object}},$scope.clear=function(){$scope.clearAutocomplete=!0},$scope.setCity=function(object){$scope.setUserLocation({locality:{city:object}},function(){$scope.getCart(function(){$scope.getMenu()})})},$scope.checkIfMains=function(value){return"mains"==value.toLowerCase(name)},$scope.callAfterAnyLogin=function(){$scope.callOpenCorporateLocationCalloutAfterLogin=!0},$scope.handleAuthSuccess=function(user){$localstorage.removeItem("lastUsedAddressId"),window.MODAL_REGISTER_EMAIL&&window.MODAL_REGISTER_EMAIL.hide(),window.MODAL_LOGIN&&window.MODAL_LOGIN.hide(),window.MODAL_REGISTER_CHOISE&&window.MODAL_REGISTER_CHOISE.hide(),window.MODAL_REGISTER_JOIN&&window.MODAL_REGISTER_JOIN.hide(),user.email&&($scope.user=user,$scope.getMenu(),$scope.setDividerText(),$scope.forms.checkout.user=user,Cookie.set({cookieName:"fmAlternativeEmailId",cookieValue:user.email,expireTime:720}),Cookie.set({cookieName:"fmAlternativePhoneNumber",cookieValue:user.mobileNumber,expireTime:720}),$scope.getUserAddresses(null,$scope.checkAndRedirectIncaseReq),$scope.shouldRedirectAddress()||($scope.user&&!$scope.user.mobileNumberVerified&&$scope.displayDigitsPopup(),$scope.confirmInProgress&&($("#confirm").modal("show"),$scope.confirmInProgress=!1),$scope.loginLoading=!1,$scope.businessPage&&$scope.getLastOrder()))},$scope.handleAuthError=function(data){$scope.forms.login.errors=data,$scope.loginLoading=!1,$scope.socialAuthError=!0},$scope.FB_auth=function(){$scope.socialAuthError=!1,FB&&FB.login(function(response){response.authResponse?Api.socialAuth(response.authResponse.accessToken,"facebook",function(data){$scope.fireGAEvent($("#modal-login").hasClass("open")?"Login":"SignUp","load","login_facebook_success"),$scope.fromLoginSuccess=!0,$scope.handleAuthSuccess(data),dataLayer.push({event:"loginRequest",action:"Facebook",label:"Success"}),TrackingService.postEvent("User identified",{type:"Login",Mode:"Facebook",Status:"Success",Email:data.email?data.email:"",phoneNumber:data.mobileNumber?data.mobileNumber:"","source screen":$scope.loginSourceScreen,"NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)
},data),$scope.callAfterAnyLogin()},function(data){$scope.fireGAEvent($("#modal-login").hasClass("open")?"Login":"SignUp","load","login_facebook_failure"),$scope.handleAuthSuccess(data),dataLayer.push({event:"loginRequest",action:"Facebook",label:"Fail"}),TrackingService.postEvent("User identified",{type:"Login",Mode:"Facebook",Status:"Failure",Email:data.email?data.email:"",phoneNumber:data.mobileNumber?data.mobileNumber:"","source screen":$scope.loginSourceScreen,"NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)}),$scope.loginSourceScreen=""}):$scope.fireGAEvent($("#modal-login").hasClass("open")?"Login":"SignUp","load","login_facebook_failure")},{scope:"email"})},$scope.gp_auth_key=window.gp_auth_key&&""!=window.gp_auth_key?window.gp_auth_key:"",$scope.GP_auth=function(){$scope.socialAuthError=!1,gapi&&gapi.auth2.authorize({client_id:$scope.gp_auth_key,scope:"email"},function(profile){Api.socialAuth(profile.access_token,"google",function(data){$scope.fromLoginSuccess=!0,$scope.fireGAEvent($("#modal-login").hasClass("open")?"Login":"SignUp","load","login_google_success"),$scope.handleAuthSuccess(data),dataLayer.push({event:"loginRequest",action:"Google",label:"Success"}),TrackingService.postEvent("User identified",{type:"Login",Mode:"Google plus",Status:"Success",Email:data.email?data.email:"",phoneNumber:data.mobileNumber?data.mobileNumber:"","source screen":$scope.loginSourceScreen,"NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)},data),$scope.callAfterAnyLogin()},function(data){$scope.fireGAEvent($("#modal-login").hasClass("open")?"Login":"SignUp","load","login_google_failure"),$scope.handleAuthSuccess(data),dataLayer.push({event:"loginRequest",action:"Google",label:"Fail"}),TrackingService.postEvent("User identified",{type:"Login",Mode:"Google plus",Status:"Failure",Email:data.email?data.email:"",phoneNumber:data.mobileNumber?data.mobileNumber:"","source screen":$scope.loginSourceScreen,"NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)}),$scope.loginSourceScreen=""})})},$scope.confirmRegEmail=function(){$scope.confirmRegisterEmail=!0},$scope.openSignUpModal=function(){$("#login").modal("hide"),$timeout(function(){$("#register").modal("show")},400)},$scope.openLoginModal=function(){$("#register").modal("hide"),$timeout(function(){$("#login").modal("show")},400)},$scope.$watch("cart.deliveryTimes",function(newVal,oldVal){$scope.verifyCartTimings(newVal)}),$scope.isDeliveryNowPresent=!0,$scope.verifyCartTimings=function(timings){if($scope.cart.deliveryEstimate?$scope.cartTimingCheck={show:!0,display:_getFormattedTime($scope.cart.deliveryEstimate)}:$scope.cartTimingCheck={show:!1},timings){$scope.isDeliveryNowPresent=!1,$scope.displayTimings=[];var copy=$scope.selected_delivered_time?$scope.selected_delivered_time.id:0;$scope.selected_delivered_time={id:0};for(var i=0;i<timings.length;i++)if("Delivery Later"===timings[i].action)for(var j=0;j<timings[i].timeSlots.length;j++)copy===timings[i].timeSlots[j].id&&($scope.selected_delivered_time=timings[i].timeSlots[j]),$scope.displayTimings.push(timings[i].timeSlots[j]);else"Delivery Now"===timings[i].action&&($scope.isDeliveryNowPresent=!0)}$scope.selected_delivered_time&&$scope.selected_delivered_time.id?$scope.shouldDeliveryNow=!1:$scope.isDeliveryNowPresent?$scope.shouldDeliveryNow=!0:($scope.shouldDeliveryNow=!1,$scope.selected_delivered_time=$scope.displayTimings[0])},$scope.getNextAvailableTime=function(timings,isProduct){window.fmIsMobileTemplate&&!isProduct&&(timings=_processProduct(timings).timings);var day=new Date,minutes=60*day.getHours()+day.getMinutes(),time=0,sortedTimings=_.sortBy(timings,"startTime");if(minutes<=1350){for(var i=0;i<sortedTimings.length;i++)if(minutes<sortedTimings[i].startTime){time=sortedTimings[i].startTime;break}}else sortedTimings.length>0&&(time=sortedTimings[0].startTime);return _getFormattedTime(time)},$scope.checkTimings=function(timings,isProduct){window.fmIsMobileTemplate&&!isProduct&&(timings=_processProduct(timings).timings);var ok=!1;if(_.isEmpty(timings))return!0;for(var day=new Date,minutes=60*day.getHours()+day.getMinutes(),i=0;i<timings.length;i++)timings[i].startTime<=minutes&&minutes<=timings[i].endTime&&(ok=!0);return ok},$scope.getAvailableTime=function(timings){for(var day=new Date,minutes=60*day.getHours()+day.getMinutes(),i=0;i<timings.length;i++)if(timings[i].startTime>minutes)return Math.floor(timings[i].startTime/60)+":"+timings[i].startTime%60},$scope.focusSearch=function($event){$event.preventDefault(),$scope.focusInput=!0,$scope.fail=!0,$("html, body").animate({scrollTop:0},"slow")},$scope.selectCity=function(city){$scope.clearAutocomplete=!0,$scope.location={locality:{city:city}}},$scope.showLocationForMobile=function(){$scope.showMobileDropdown=!0},$scope.setGoogleLocationForNewAddress=function(result){$scope.showMobileDropdown=!1;var address=$scope.processGoogleAutocomplete(result);$scope.forms.address.address=_.extend($scope.forms.address.address,address)},$scope.autocompleteAddressDisplay=function(object){return _.isUndefined(object.addressLine1)&&(object.addressLine1=""),_.isUndefined(object.addressLine2)&&(object.addressLine2=""),$scope.searchInput=object.addressLine2,object.addressLine1?object.addressLine1:" "+object.addressLine2?object.addressLine2:""},$scope.getAddressDisplayName=function(address){if(address){var str=address.addressLine2?address.addressLine2:"";return address.locality&&(address.locality.name&&(str+=", "+address.locality.name),address.locality.city&&address.locality.city.name&&(str+=", "+address.locality.city.name)),str}},$scope.setGoogleLocation=function(result){var address=$scope.processGoogleAutocomplete(result);$scope.newAddress=result.formatted_address,$scope.cityname=address.locality.city.name,$scope.setUserLocationAndClearCart(address,function(){$scope.getCart(function(){$scope.getMenu()})})},$scope.encodeURI=function(url){return encodeURIComponent(url)},$scope.setLocationAndGetMenu=function(address){$timeout(function(){$scope.showMobileDropdown=!1,$scope.loading=!0,$scope.newAddress=address.addressLine2,$timeout(function(){$scope.searchInput=address.addressLine2},500),MODAL_LOCATION_ADDRESS.hide(),console.log(address),$scope.cityname=address.locality&&address.locality.city?address.locality.city.name:"",$scope.setUserLocationAndClearCart(address,function(){$scope.getCart(function(){$scope.getMenu(function(){$scope.defaultMenu=!1})})})})},$scope.setDefaultLocation=function(){Api.setDefaultLocation($scope.googleMapDefaultLocation,function(results){if(!window.initialLocationDoesnotExists&&window.fmIsMobileTemplate&&$scope.menu.serviceability.serviceable)window.location.href="/";else if(window.fmIsMobileTemplate){window.menu=$scope.menu;var template=$("#template_2").html();$("#menu-list").html(_.template(template,{menu:$scope.menu}))}$scope.loading=!1,results.addressLine2&&($scope.forms.checkout.address=results,$scope.location=results,$scope.getCart(function(){$scope.getMenu()}))})},$scope.setUserLocation=function(address,callback){$scope.fail=!1,Api.setUserLocation(address,function(data){$scope.location=data,$scope.clearGuestAddress(),callback&&callback()})},$scope.setUserLocationAndClearCart=function(address,callback){$scope.fail=!1,Api.setUserLocationAndClearCart(address,function(data){$scope.location=data,$scope.clearGuestAddress(),callback&&callback()})},$scope.scrollToMenu=function(){$scope.GTM_Custom_Event({category:"Cart",action:"Click",label:"Browse Menu",value:1}),$scope.isMenuPage||(window.location.href="/"),window.fmIsMobileTemplate&&(window.location.href="/"),$timeout(function(){$("html, body").animate({scrollTop:$("#menu").offset().top-70},200)},200)},$scope.openLocationModal=function(){MODAL_LOCATION_ADDRESS.show()},$scope.$watch("location",function(newVal,oldVal){_.isEmpty(newVal)&&$scope.clearActionQueue()}),$scope.actionQueue=[],$scope.clearActionQueue=function(){_.each($scope.actionQueue,function(action){action()})},$scope.pushActionQueue=function(action){$scope.actionQueue.push(action)},$scope.findCity=function(address){_.forEach($scope.citySelectorOptions,function(city){if(address.indexOf(city.address.locality.city.name)>=0)return $scope.defaultCityPosition=city.address.pos,$scope.cityName=city.address.locality.city.name,!1})},$scope.setUserNewCity=function(city,$event){if($scope.noLocation)if(city)switch(city.id){case 1:$scope.googleMapNewAddress="Koramangala, Bengaluru, Karnataka, India";break;case 2:$scope.googleMapNewAddress="Powai, Mumbai, Maharashtra, India";break;case 3:$scope.googleMapNewAddress="Malviya Nagar New Delhi, Delhi 110017";break;case 4:$scope.googleMapNewAddress="Sector 24, Gurugram, Haryana, India"}else $scope.googleMapNewAddress="Koramangala, Bengaluru, Karnataka, India";$timeout(function(){$scope.citySelected=city}),$scope.GTM_Custom_Event({category:"Select City",action:"Click",label:city.name,value:1}),$event&&$event.target&&$($event.target)&&$($event.target).closest(".modal")&&$($event.target).closest(".modal").find("input")&&$($event.target).closest(".modal").find("input").focus()},$scope.seeMenu=function(){MODAL_LOCATION_ADDRESS.hide(),$scope.setUserNewLocation($scope.location)},$scope.setUserNewLocation=function(address,saveCity){var path=document.location.pathname,page=path.substring(path.indexOf("/"));"/"==page&&(page="/menu");var type="Custom";address&&address.addType&&"corp"==address.addType?type="Corporate":address&&address.id&&(type="Saved address"),TrackingService.postEvent("Location selected",{Locality:address&&address.addressLine2?address.addressLine2:"",Source:page,Type:type,Status:"success"}),$scope.defaultMenu||saveCity||MODAL_LOCATION_ADDRESS.hide();var cityName="";cityName=address.address?address.address.locality.city.name:address.addressLine2,saveCity?($scope.cityName=cityName,$scope.GTM_Custom_Event({category:"Select City",action:"Click",label:cityName,value:1})):$scope.cityName="Choose City",MENU_CITY.hide(!0),$scope.findCity(cityName),address&&address.isFromIpAddress&&($scope.defaultLocationModal=!0),$scope.setUserLocation(address,function(){$scope.getMenu(),$scope.getCart()})},$scope._capitalizeFirstLetter=function(s){var tempS=s.toLowerCase();return tempS.charAt(0).toUpperCase()+tempS.slice(1)},$scope.callfmSetBanners=function(data,fmlazy){if($scope.fmIsCategoryHomePage){var fmCategoryBanners=$scope.fmCategorySpecificBanner(data.menu.collections,{name:window.fmCategoryPageName,id:window.fmCategoryPageId});if(fmCategoryBanners&&fmCategoryBanners.length&&fmCategoryBanners.length>0){for(i=0;i<fmCategoryBanners.length;i++)fmCategoryBanners[i]={img_ur:$scope.getCloudFrontUrl(fmCategoryBanners[i])};$scope.fmSetBanners(fmCategoryBanners,!0)}else $scope.fmSetBanners([],!0)}else $scope.fmSetBanners(data.menu?data.menu.banners:data.banners,fmlazy)},$scope.fmSetBanners=function(banners,fmLazy){var i,bannersLength=banners.length,bannersList=[];if(bannersLength)for(i=0;i<bannersLength;i++)banners[i]&&banners[i].img_ur&&bannersList.push(banners[i].img_ur);else bannersList.push($scope.fmDefaultBanner);$scope.bannerUrl=bannersList,$("#hero").carousel($scope.bannerUrl,7e3,void 0,[banners[0]]),$scope.bannerUrl.length&&$scope.bannerUrl.length>1&&fmLazy&&$(document).ready(function(){setTimeout(function(){$("#hero").carousel($scope.bannerUrl,7e3,void 0,banners)},2e3)})},$scope.shouldDisplayTrackerOrder=function(){return!_.isEmpty(Cookie.get("fmOrderIdInOrderPage"))},$scope.fmClearOrder=function(){Cookie.delete("fmOrderIdInOrderPage"),window.location.href="/logout"};var renderMenuListWithUnderscore=function(){var template=$("#template_2").html();window.menu=$scope.menu,$("#menu-list").html(_.template(template,{})),$(".lazy.fm-lazy-load-image").lazyload({skip_invisible:!0})};$scope.openProductPopup=function(product_id,$event){$event.preventDefault();var fmEmail=$scope.user&&$scope.user.email?$scope.user.email:Cookie.get("fmAlternativeEmailId")&&Cookie.get("fmAlternativeEmailId").length>0?Cookie.get("fmAlternativeEmailId"):"";window.criteo_q&&(window.criteo_q.push({event:"setAccount",account:39162},{event:"setEmail",email:[fmEmail]},{event:"setSiteType",type:window.fmIsMobileTemplate?"m":"d"},{event:"viewItem",item:product_id}),console.log("CRITEO ---- PDP POPUP")),PRODUCT_DETAILS_POPUP&&(Api.getProductDetails(product_id,function(completeProductDetails){completeProductDetails.timings=completeProductDetails.deliveryTimings,completeProductDetails.price=completeProductDetails.sellingPrice||0,completeProductDetails.available=completeProductDetails.isAvailable,completeProductDetails.soldOut=!completeProductDetails.available,completeProductDetails.isVeg=$scope.isVeg(completeProductDetails),$scope.product_details=completeProductDetails,$scope.showCart?($scope.closeCart(),setTimeout(function(){$scope.pdpPopupCallback(!0),PRODUCT_DETAILS_POPUP.show()},200)):($scope.pdpPopupCallback(!1),PRODUCT_DETAILS_POPUP.show()),TrackingService.postEvent("/Product detail popup",{source:"menu",Cname:$scope.fmIsInViewCollectionName,CIndex:$scope.fmIsInViewCollectionIndex,pSeenCount:$scope.fmMenuProductSeenCount,productId:product_id}),dataLayer.push({event:"fireRemarketingTag",google_tag_params:{dynx_pagetype:"offerdetail",dynx_itemid:product_id}})}),$scope.getMenuSuggestedProducts(product_id,4))},$scope.getGSTMsg=function(){for(var msg="",i=0;i<$scope.validation.cart.paymentDetails.taxDTO.taxDTOList.length;i++)msg=msg+$scope.validation.cart.paymentDetails.taxDTO.taxDTOList[i].message+": ₹"+$scope.validation.cart.paymentDetails.taxDTO.taxDTOList[i].amount,i!==$scope.validation.cart.paymentDetails.taxDTO.taxDTOList.length-1&&(msg+="<br/>");return msg},$scope.setUserLocationAndClearCartAndGetMenu=function(address,callback){$scope.fail=!1,Api.setUserLocationAndClearCartAndGetMenu(address,function(results){if(results.address&&results.address.isFromIpAddress?$scope.defaultLocationModal=!0:$scope.defaultLocationModal=!1,$scope.location=results.address,$scope.noLocation=!1,$scope.formatCartInfo(results.cart),$scope.formatMenu(results.menu),$scope.segregateMenu($scope.menu.collections),!window.initialLocationDoesnotExists&&window.fmIsMobileTemplate&&$scope.menu.serviceability.serviceable)window.location.href="/";else if(window.fmIsMobileTemplate){window.menu=$scope.menu;var template=$("#template_2").html();$("#menu-list").html(_.template(template,{menu:$scope.menu}))}$scope.loading=!1,results.menu&&results.menu.banners?$scope.callfmSetBanners(results):$scope.fmSetBanners([{img_ur:$scope.fmDefaultBanner}]),$scope.clearGuestAddress(),initializeCategoryArrows(),callback&&callback()})},$scope.setNewLocationAddress=function(address){console.log("####################"),console.log(address),$scope.showLocationPopupErrorMessage=!1,$scope.defaultMenu=!1,$scope.noLocation=!1,$scope.setUserNewLocation(address)},$scope.segregateMenu=function(collections){var products=_.flatten(_.map(collections,function(collection){return collection.products}));$scope.topProducts=$scope.filterOutMenu(products,"TOP"),$scope.bottomProducts=$scope.filterOutMenu(products,"BOTTOM"),$scope.mainProducts=$scope.filterOutMenuMainProducts(products)},$scope.filterOutMenuMainProducts=function(products){var separatedProducts,separatedProductsName="";return separatedProducts=_.filter(products,function(product){var filterConditionSatisfied=!0;return _.each(product.categories,function(category){filterConditionSatisfied&&category.categoryType&&category.categoryType.length>0&&(filterConditionSatisfied="TOP"!=category.categoryType.toUpperCase()&&"BOTTOM"!=category.categoryType.toUpperCase(),category.name&&category.name.length>0&&filterConditionSatisfied&&(separatedProductsName=category.name))}),filterConditionSatisfied}),separatedProducts.NAME=separatedProductsName,separatedProducts},$scope.filterOutMenu=function(products,categoryType){var separatedProducts,separatedProductsName="";return separatedProducts=_.filter(products,function(product){var filterConditionSatisfied=!1;return _.each(product.categories,function(category){!filterConditionSatisfied&&category.categoryType&&category.categoryType.length>0&&(filterConditionSatisfied=category.categoryType.toUpperCase()==categoryType,category.name&&category.name.length>0&&filterConditionSatisfied&&(separatedProductsName=category.name))}),filterConditionSatisfied}),separatedProducts.NAME=separatedProductsName,separatedProducts},$scope.cartHasSoldOutProducts=function(){return _.size(_.filter($scope.cart.items,function(item){return item.productDTO.soldOut}))>0||$scope.validation.cartErrorDTO&&"421"==$scope.validation.cartErrorDTO.errorCode},$scope.isKitchenClosed=function(){return!$scope.menu.isTodaysMenu},$scope.cityName="Choose City",$scope.getTomorrow=function(){var tomorrow=new Date;return tomorrow.setDate(tomorrow.getDate()+1),tomorrow},$scope.isProductExpressItem=function(productId){var product=_getProductFromId(productId);return product.isExpressItem},$scope.fmGetCategoryModifiedResult=function(fmParams,data,fmRecommendedCategoryObj){var fmWantedCollectionsList=[],fmUnwantedCollectionsList=[],fmUnwantedCollectionsListCnt=0;fmRecommendedCategoryObj&&fmRecommendedCategoryObj.products&&fmRecommendedCategoryObj.products.length>0&&(fmRecommendedCategoryObj.hashlink="#recommended",fmRecommendedCategoryObj.products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/cd56a6da-5162-4045-9399-f34c26b492b0.jpg",fmUnwantedCollectionsList.push(fmRecommendedCategoryObj),++fmUnwantedCollectionsListCnt);var collectionsLength=data.collections?data.collections.length:0;if(collectionsLength&&collectionsLength>0)for(var i=0;i<collectionsLength;i++){for(var fmFoundFlag=!1,fmIdsLength=fmParams.id.split("_").length,fmIdsList=fmParams.id.split("_"),j=0;j<fmIdsLength;j++)data.collections[i].id==fmIdsList[j]&&(fmWantedCollectionsList.push(data.collections[i]),fmFoundFlag=!0);fmFoundFlag||(fmUnwantedCollectionsList.push(data.collections[i]),fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].hashlink="#"+fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].name.split(" ").join("-").toLowerCase(),_.contains([9,40,17,49,7,58,1,27],fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].id)?fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/eea64b72-8ced-46c7-8ddb-ad9f02d3f72f.jpg":_.contains([13,41,50,55,70,71,8,35],fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].id)?fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/9917ed08-2071-497e-b6ea-6dfb45fc8925.jpg":_.contains([11,45,26,54,20,60,29,56],fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].id)?fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/873aa240-ec4a-4ca5-9111-4c4e86ca1074.jpg":_.contains([12,44,19,53,15,62,3,31],fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].id)?fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/9e2c53e2-5ddb-4240-a613-ac98d157fb0a.jpg":_.contains([32,43,52,61],fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].id)?fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/47e5f87e-8d55-4983-bb31-5569d9fd76b9.jpg":_.contains([28,46,51,59,2,10,14,18],fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].id)?fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage="https://d3gy1em549lxx2.cloudfront.net/2c1b8694-8bbc-44e8-84d1-54b5571a3c18.jpg":fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].fmimage=$scope.getCloudFrontUrl(fmUnwantedCollectionsList[fmUnwantedCollectionsListCnt].products[0].image),++fmUnwantedCollectionsListCnt)}return(!fmWantedCollectionsList||fmWantedCollectionsList.length<=0)&&(window.location.href="/"),data.collections=fmWantedCollectionsList,data.fmUnwantedCollectionsList=fmUnwantedCollectionsList,data},$scope.fmCategorySpecificBanner=function(collections,fmParams){for(i=0;i<collections.length;i++){var fmId1=fmParams.id.split("_")[0],fmId2=fmParams.id.split("_")[1];if(collections[i].id==fmId1||collections[i].id==fmId2)return collections[i].image&&""!=collections[i].image?[collections[i].image]:[]}},$scope.triggerGAStepEvent=function(eventId,cb){GTM_log_funnel_step({action:"Checkout",ecommerce:{checkout:{actionField:{step:eventId}}}},function(){cb&&cb(),console.log("########################## FUNNEL STEP "+eventId)})},$scope.mapMenu=function(){var desserts=[],dessertsColIndex=-1;$scope.kitchenClosed=$scope.isKitchenClosed(),TrackingService.fetchCatalogueEvent($scope.menu,$scope.location),0!=$scope.menu.serviceability.serviceable&&$scope.location&&$scope.location.addressLine2&&setTimeout(function(){$scope.GAStepOneEventOneDone||($scope.triggerGAStepEvent(1),$scope.GAStepOneEventOneDone=!0)},5e3);for(var i=0;i<$scope.menu.collections.length;i++){var collection=$scope.menu.collections[i];$scope.menu.imageBasePath;collection.isMains=$scope.checkIfMains(collection.name),"Desserts"==collection.name&&(dessertsColIndex=i);for(var j=0;j<collection.products.length;j++){var product=collection.products[j];product.isbadgetrue=!1,product.timings=product.deliveryTimings,product.timings&&product.timings[0]&&(product.deliveryTimings&&product.deliveryTimings[0]&&(void 0!=product.deliveryTimings[0].maxDeliveryTime||null!=product.deliveryTimings[0].maxDeliveryTime)?product.maxDeliveryTime=product.deliveryTimings[0].maxDeliveryTime:product.maxDeliveryTime=$scope.defaultDeliveryTime,(void 0!=product.maxDeliveryTime||null!=product.maxDeliveryTime)&&product.maxDeliveryTime<$scope.defaultDeliveryTime&&$scope.checkTimings(product.timings)?($scope.fmShowExpressDeliveryItems=!0,product.isExpressItem=!0,product.isNotExpressItem=!1):product.isNotExpressItem=!0),product.price=product&&product.sellingPrice?product.sellingPrice:"",product.available=product.isAvailable,product.isVeg=$scope.isVeg(product),product.containsEgg=$scope.containsEgg(product),"Desserts"==collection.name&&parseInt(product.price)<200&&desserts.push(product),product.image&&(product.fmImageUrl=$scope.getCloudFrontUrl(product.image)),product.badgeImage&&(product.badgeImage=$scope.menu.imageBasePath+"X_"+product.badgeImage),collection.isMains?(product.isMains=!0,product.soldOut=!product.isAvailable):product.soldOut=!product.isAvailable,0!=j&&(product.productNewLayout=!1),_.contains($scope.fmCuisineFilters,product.cuisine.name)?"":$scope.fmCuisineFilters.push(product.cuisine.name)}}if(_.isEmpty($scope.location))$scope.getParameterByName("error")||($(".overlay").addClass("active"),window.MODAL_LOCATION_ADDRESS&&window.MODAL_LOCATION_ADDRESS.show(),$scope.initialLocationDoesnotExists=!0,$scope.forceLocateMe=!0,$scope.noLocation=!0,$scope.query=$scope.googleMapDefaultLocation.addressLine2,$scope.googleMapNewAddress=$scope.googleMapDefaultLocation.addressLine2,$scope.setUserNewCity($scope.cities[0]),$timeout(function(){$("html, body").animate({scrollTop:0},10)},500));else{$scope.initialLocationDoesnotExists=!1,_.has($scope.menu,"serviceability.addressDTO.locality.city.name")&&($scope.cityName=$scope.menu.serviceability.addressDTO.locality.city.name);var path=document.location.pathname;path.substring(path.indexOf("/"))}if($scope.businessPage){for(var i=0;i<$scope.menu.collections.length;i++){var collection=$scope.menu.collections[i];if("Sides/Salads"==collection.name)var index=i}$scope.menu.collections[index].products=$scope.menu.collections[index].products.concat(desserts),dessertsColIndex>0&&$scope.menu.collections.splice(dessertsColIndex,1)}if($timeout(function(){$(window).scrollTop($(window).scrollTop()+1)},1e3),$scope.recommendedProductsList=$scope.menu.rcm||[],$scope.setRecommendedProducts(),$scope.fmIsCategoryHomePage){var fmRecommendedCategoryObj={};$scope.recommendedProductsObjectsList.length>0&&(fmRecommendedCategoryObj.name="Trending",fmRecommendedCategoryObj.collectionDescription="Top selling dishes for you",fmRecommendedCategoryObj.products=$scope.recommendedProductsObjectsList.splice(0,2),$scope.recommendedProductsObjectsList=[],$scope.menu.rcm=[]),$scope.menu=$scope.fmGetCategoryModifiedResult({name:window.fmCategoryPageName,id:window.fmCategoryPageId},$scope.menu,fmRecommendedCategoryObj)}window.menu=$scope.menu},$scope.isVeg=function(product){if(product.ct)for(var i=0;i<product.ct.length;i++)if("Veg"==product.ct[i])return!0;return!1},$scope.containsEgg=function(product){if(product.ct)for(var i=0;i<product.ct.length;i++)if("Contains Egg"==product.ct[i])return!0;return!1},$scope.shouldRedirectAddress=function(){var redirectUrl=_getParameterByName("redirect_uri"),patt=/\/login/;return patt.test(location.pathname)&&redirectUrl&&redirectUrl.length>0},$scope.openCollectionDropdown=function(){$scope.collectionDropdownOpened=!$scope.collectionDropdownOpened,$scope.showMobileDropdown=!1},$scope.$on("ngRepeatFinished",function(event){}),$scope.selectPrevCollection=function(){for(var i=0;i<$scope.menu.collections.length&&$scope.collection.id!=$scope.menu.collections[i].id;)i++;0!=i&&($scope.collection=$scope.menu.collections[i-1])},$scope.checkifFirstCollection=function(){if(_.isUndefined($scope.menu.collections)||_.isEmpty($scope.menu.collections)||_.isNull($scope.menu.collections))return!1;for(var i=0;i<$scope.menu.collections.length&&$scope.collection.id!=$scope.menu.collections[i].id;)i++;return 0==i},$scope.checkIfLastCollection=function(){if(_.isUndefined($scope.menu.collections)||_.isEmpty($scope.menu.collections)||_.isNull($scope.menu.collections))return!1;for(var i=0;i<$scope.menu.collections.length&&$scope.collection.id!=$scope.menu.collections[i].id;)i++;return i==$scope.menu.collections.length-1},$scope.selectNextCollection=function(){for(var i=0;i<$scope.menu.collections.length&&$scope.collection.id!=$scope.menu.collections[i].id;)i++;i!=$scope.menu.collections.length-1&&($scope.collection=$scope.menu.collections[i+1])},$scope.getCities=function(callback){Api.getCities(function(data){$scope.cities=data,_.isUndefined(callback)||callback(data)})},$scope.getCloudFrontUrl=function(s3Url){if(s3Url.indexOf("url")>=0){if(s3Url){var lastIndex=s3Url.lastIndexOf("/");return lastIndex>0?"//d3gy1em549lxx2.cloudfront.net/"+s3Url.substring(lastIndex+1):s3Url}return s3Url}return s3Url},$scope.displayOnlyExpressItems=function(shouldSetCheckBoxVal){$scope.showOnlyExpressItems=!$scope.showOnlyExpressItems,shouldSetCheckBoxVal&&$("#square-checkout-box-input-1").prop("checked",$scope.showOnlyExpressItems),Cookie.set({cookieName:"showOnlyExpressItems",cookieValue:$scope.showOnlyExpressItems,expireTime:2})},$scope.setImgDimensionQueryParams=function(media){var imgUrl;return imgUrl=media&&media.MEDIUM&&media.MEDIUM.url?media.MEDIUM.url:media&&media.LARGE&&media.LARGE.url?media.LARGE.url:media&&media.ORIGINAL&&media.ORIGINAL.url?media.ORIGINAL.url:"",(""==imgUrl||$($window).width()<=500)&&(media&&media.NEW_MOBILE&&media.NEW_MOBILE.url?imgUrl=media.NEW_MOBILE.url:media&&media.MOBILE&&media.MOBILE.url&&(imgUrl=media.MOBILE.url)),$scope.getCloudFrontUrl(imgUrl)},$scope.lastScrollHeader="",$scope.handleCategorySelection=function(collectionName){window.location.hash="#"+collectionName;var windowScrollTop=$(window).scrollTop();if(collectionName&&$("#fm-category-collection-"+collectionName)&&$("#fm-category-collection-"+collectionName).offset()&&Math.abs(windowScrollTop-($("#fm-category-collection-"+collectionName).offset().top-80))>100){var isMobile=!1;$(".fm-left-nav-category").hasClass("fm-left-nav-mobile")&&(isMobile=!0),window.scrollTo(0,$(".fm-collection-"+collectionName).offset().top-(isMobile?49:80)),$(".fm-left-nav-category").removeClass("fm-left-nav-category-dktp-selected"),$(".fm-left-nav-category").removeClass("fm-left-nav-category-selected"),$(".fm-left-nav-category").addClass("fm-left-nav-category-unselected"),isMobile?($(".fm-category-"+collectionName).removeClass("fm-left-nav-category-unselected"),$(".fm-category-"+collectionName).addClass("fm-left-nav-category-selected")):($(".fm-category-"+collectionName).removeClass("fm-left-nav-category-unselected"),$(".fm-category-"+collectionName).addClass("fm-left-nav-category-dktp-selected"))}},$scope.setCollection=function(collection){TrackingService.postEvent("Menu category changed",{Category:collection.name}),$scope.scrollingAnimation=!0,$scope.isYellowBannerPresent&&"true"==$scope.isYellowBannerPresent?$("html, body").animate({scrollTop:$("#collection-"+$scope.toSnakeCase(collection.name)).offset().top-130+"px"},500,function(){$timeout(function(){$scope.scrollingAnimation=!1})}):$("html, body").animate({scrollTop:$("#collection-"+$scope.toSnakeCase(collection.name)).offset().top-100+"px"},500,function(){$timeout(function(){$scope.scrollingAnimation=!1})}),$scope.selectedCollection=collection},$scope.setCollectionUnderscore=function(collectionId){var collection=_.find($scope.menu.collections,function(collection){return collection.id==collectionId});$scope.setCollection(collection)},$scope.setRecommended=function(){TrackingService.postEvent("Menu category changed",{Category:$scope.menu.is_rcm?"Recommended":"Top Selling"}),$scope.isYellowBannerPresent&&"true"==$scope.isYellowBannerPresent?$("html, body").scrollTop($("#collection-recommended").offset().top-200):$("html, body").scrollTop($("#collection-recommended").offset().top-170),$scope.selectedCollection=null},$scope.toSnakeCase=function(str){if(str)return str.split(" ").join("_")},$scope.getAndVerifyCollectionHash=function(hash){var collection=_.find($scope.menu.collections,function(item){return item.name.toLowerCase().split(" ").join("-")==hash});return!(!(collection&&collection.products&&collection.products.length>0)||($scope.newFilterList.length>0||$scope.showOnlyExpressItems)&&!$scope.hasCollectionAnyCategoryItems(collection,$scope.newFilterList))&&collection},$scope.hasProcessedHash=!1,$scope.handleCollectionHash=function(){$scope.hasProcessedHash=!0;var hash=window.location.hash;if(hash=hash.split("/").length&&hash.split("/").length>1?hash.substring(2):hash.substring(1)){var collection=$scope.getAndVerifyCollectionHash(hash);collection?$scope.setCollection(collection):"top-selling"==hash||"recommended"==hash?$scope.setRecommended():window.location.hash=""}else window.location.hash=""},$scope.setCollectionNavEvent=function(){$scope.selectedCollection=null,$scope.menu.collections&&$scope.menu.collections[0]&&($scope.previousSelectedCollection=$scope.menu.collections[0]);var isInView=function(id){var el=$(id),offset=$scope.fmIsMobileTemplate?230:250;if(_.isUndefined(el.offset()))return!1;var docViewTop=$(window).scrollTop(),offsetTop=el.offset().top,height=el.height();return offsetTop-offset<docViewTop&&offsetTop+height-offset>docViewTop},handleCollections=function(){var nav=$("#fm-collection-nav ul"),ok=!1;$scope.fmMenuProductSeenCount=0,_.each($scope.menu.collections,function(collection,index){if(isInView("#collection-"+$scope.toSnakeCase(collection.name))){$scope.fmIsInViewCollectionIndex=index,$scope.fmIsInViewCollectionName=collection.name,0==index?$scope.fmMenuProductSeenCount=$scope.recommendedProductsObjectsList?$scope.recommendedProductsObjectsList.length:0:$scope.fmMenuProductSeenCount=$scope.fmMenuProductSeenCount+$scope.menu.collections[index-1].products.length,$scope.previousSelectedCollectionName&&$scope.previousSelectedCollectionName==collection.name||($scope.previousSelectedCollectionName=collection.name),$timeout(function(){$scope.selectedCollection=collection}),ok=!0;var el=$("#fm-collection-nav-btn-"+$scope.toSnakeCase(collection.name));if(el.length>0&&nav.scrollLeft(nav.scrollLeft()+el.position().left-50),!fmIsMobileTemplate&&($scope.showLeftCategoryArrow||$scope.showRightCategoryArrow)){var desktopCategoryPosition=$("#fm-nav-id-"+collection.id).position(),desktopCategoryWidth=$("#fm-nav-id-"+collection.id).width();if(desktopCategoryPosition){var navWidth=$("#fm-collection-nav ul").width();desktopCategoryPosition.left+desktopCategoryWidth+150>navWidth+$scope.headerMarginLeft&&$scope.scrollCategoryHeader(!1),
desktopCategoryPosition.left-150<$scope.headerMarginLeft&&$scope.scrollCategoryHeader(!0)}}}}),isInView("#collection-recommended")&&(ok=!0,$timeout(function(){$scope.selectedCollection=-1,nav.scrollLeft(0)})),ok||($scope.selectedCollection=null)},handlePosition=function(){handleCollections()};handlePosition(),$(window).scroll(function(){handlePosition()})},$scope.fmFixMessageBanner=!1,$scope.showScrollUpArrow=!1,$scope.collectionEvents=function(){function isScrolledIntoView(elem){var $elem=$(elem),$window=$(window);if(elem){var docViewTop=$window.scrollTop()+50,elemTop=$elem.offset().top,height=$elem.height();return elemTop<docViewTop&&elemTop+height>docViewTop}return!1}$scope.setCollectionNavEvent();var windowElem=$(window),windowElemScrollTop=windowElem.scrollTop();$(window).scroll(function(){if(windowElemScrollTop=windowElem.scrollTop(),$scope.showScrollUpArrow=windowElemScrollTop>200,windowElemScrollTop>40?($(".gradient").removeClass("fm-gradient-non-sticky"),$(".gradient").addClass("fm-gradient-sticky")):($(".gradient").removeClass("fm-gradient-sticky"),$(".gradient").addClass("fm-gradient-non-sticky"),$("#user-dropdown").removeClass("active")),windowElemScrollTop>530?$(".fm-itm-viewing-fixed").show():$(".fm-itm-viewing-fixed").hide(),$scope.menu.collections)for(var i=0;i<$scope.menu.collections.length;i++)isScrolledIntoView(document.getElementById("collection-"+$scope.menu.collections[i].name))&&($scope.lastScrollHeader!=$scope.menu.collections[i].name&&($scope.lastScrollHeader=$scope.menu.collections[i].name),$scope.$apply(function(){$scope.fmCategoryHeader=$scope.menu.collections[i].name}))})},$scope.GTM_AB_TriggerCustomEvent=function(customEvent){var prefix="";dataLayer.push(_.assign(customEvent,{event:"customEvent",label:prefix+customEvent.label}))},$scope.CR_mapItems=function(list){return _.map(list,function(item){return{id:item.i,title:item.t,subTitle:item.st,price:item.p,details:item.d,fmImageUrl:item.im,timings:item.pdt,categories:item.c,isVisible:item.iv,mealType:item.mt,isVeg:$scope.isVeg(item),containsEgg:$scope.containsEgg(item)}})},$scope.$watch("validation",function(newVal,oldVal){if(!_.isUndefined(newVal)&&!_.isEmpty(newVal)&&newVal&&newVal.cart&&newVal.cart.upsellProducts){var tempUpsaleProducts=newVal.cart.upsellProducts;window.fmIsMobileTemplate||$scope.stopUpsellIntervalFn(),$scope.fmUpsellLoading=!0,console.log(tempUpsaleProducts),$scope.upsaleProducts=$scope.CR_mapItems(tempUpsaleProducts),console.log($scope.upsaleProducts),$scope.fmUpsellSwipeDirection="left",window.fmIsMobileTemplate?$scope.fmMbResetUpsellInterval():($scope.resetUpsellInterval(),$scope.startUpsellInterval())}}),$scope.formatMenu=function(data,callback){$scope.menu=data,(!data||!data.collections||data.collections.length<=0)&&($scope.fmCategoryHeader="Today's menu"),$scope.defaultMenu=!1,$scope.loading=!1,$scope.isProductDetailPage&&$scope.findAndMapProductDetails(data,$scope.product_details,function(product){$scope.product_details=product}),$scope.menu.collections&&$scope.mapMenu(),$scope.storeSavedItem(),_.isUndefined(callback)||callback(data),$scope.decideToShowCorpLocPromt()},$scope.emptyLocation=function(){$scope.showLocationPopupErrorMessage=!0},$scope.setCityBasedOnMenu=function(menu){menu.serviceability&&menu.serviceability.addressDTO&&menu.serviceability.addressDTO.locality&&menu.serviceability.addressDTO.locality.city?$scope.cityName=menu.serviceability.addressDTO.locality.city.name:$scope.cityName="Choose City"},$scope.isCitySelected=function(item){return $scope.city&&item.id==$scope.city.id},$scope.setCity=function(city){if($scope.noLocation)switch(city.id){case 1:$scope.query="Koramangala, Bengaluru, Karnataka, India";break;case 2:$scope.query="Powai, Mumbai, Maharashtra, India";break;case 3:$scope.query="Malviya Nagar New Delhi, Delhi 110017";break;case 4:$scope.query="Sector 24, Gurugram, Haryana, India"}$scope.city=city},$scope.getMenu=function(cb){$scope.loading=!0,Api.getMenu(function(data){if($scope.setCityBasedOnMenu(data),$scope.menu=data,"favourite"==$scope.loginSourceScreen&&$scope.fromLoginSuccess){$scope.fromLoginSuccess=!1;var index=$scope.favoriteGetProductIndex($scope.favoriteProductId);$scope.menu.collections[index[0]].products[index[1]].isLiked?1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||location.reload():($scope.favoriteLike($scope.favoriteTriggeredEvent,index[0],index[1],$scope.favoriteProductId,"menu catalog"),1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||location.reload())}else $scope.fromLoginSuccess?($scope.fromLoginSuccess=!1,1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||location.reload()):data.serviceability.serviceable&&(1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||window.location.reload());$scope.formatMenu(data,cb),$scope.segregateMenu($scope.menu.collections),$scope.loading=!1,data.banners?$scope.callfmSetBanners(data):$scope.fmSetBanners([{img_ur:$scope.fmDefaultBanner}]),initializeCategoryArrows(),data.serviceability&&!data.serviceability.serviceable&&$scope.cart&&$scope.cart.items&&$scope.cart.items.length>0&&$scope.getCart(),$scope.callOpenCorporateLocationCalloutAfterLogin&&($scope.decideToShowCorpLocPromt(),$scope.callOpenCorporateLocationCalloutAfterLogin=!1)})},$scope.storeSavedItem=function(){if(!_.isUndefined($scope.savedItem))for(var i=0;i<$scope.menu.collections.length;i++)for(var j=0;j<$scope.menu.collections[i].products.length;j++)$scope.menu.collections[i].products[j].id==$scope.savedItem.id&&$scope.addToCart($scope.savedItem,1)},$scope.isEmpty=function(obj){return _.isEmpty(obj)},$scope.fmRefreshCartAndRedirectToMenu=function(){Api.retainWhenRefreshCart(function(cartInfo){$scope.getCart(),$scope.getMenu(),PAYMENT_FAILED_RETRY_SECTION&&PAYMENT_FAILED_RETRY_SECTION.hide()})},$scope.emptyCartAndRedirectToMenu=function(){Api.resetCart(function(cartInfo){window.location.replace("/")})},$scope.emptyCart=function(){Api.resetCart(function(cartInfo){$scope.getCart()})},$scope.getDeliveryTimeInterval=function(data){if(null==data.deliveryTimes)return _getFormattedTime(data.deliveryEstimate);for(i=0;i<data.deliveryTimes.length;i++)if("Delivery Later"==data.deliveryTimes[i].action)return _getFormattedTime(data.deliveryTimes[i].timeSlots[0].startTime)+" and "+_getFormattedTime(data.deliveryTimes[i].timeSlots[0].endTime)},$scope.setNewUserMessageFlagForCart=function(){var itemsLength=$scope.cart&&$scope.cart.items?$scope.cart.items.length:0;if(itemsLength){for(var i=0;i<itemsLength;i++)if($scope.cart.items[i].productDTO&&$scope.cart.items[i].productDTO.pm2&&$scope.cart.items[i].productDTO.pm2.length)return!0;return!1}return!1},$scope.formatCartInfo=function(data,callback){$scope.cart=data.cart,$scope.fmDeliveryEstimate=$scope.getDeliveryTimeInterval(data.cart),$scope.fmDeliveryEstimate=$scope.getDeliveryTimeInterval(data.cart),$scope.showFreebieMessage(data.cart),$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,$scope.setCartItemCount(),_.isUndefined(callback)||callback(data),$scope.handleDisplayClearCartPopup()},$scope.stopPaymentFailureInterval=function(){setTimeout(function(){"undefined"!=typeof PAYMENT_FAILURE_ERROR_MESSAGE?PAYMENT_FAILURE_ERROR_MESSAGE.show():$scope.stopPaymentFailureInterval()},1e3)},$scope.handleDisplayClearCartPopup=function(){if($scope.getParameterByName("error")&&$scope.getParameterByName("error").length)$scope.fmPaymentFailureErrorMessage=$scope.getParameterByName("error"),"undefined"!=typeof PAYMENT_FAILURE_ERROR_MESSAGE?PAYMENT_FAILURE_ERROR_MESSAGE.show():$scope.stopPaymentFailureInterval();else if(400==$scope.validation.statusCode||$scope.validation.error&&$scope.validation.error.errorCode)return $scope.initiatePaymentFailedMsg=$scope.validation&&$scope.validation.error&&$scope.validation.error.message?$scope.validation.error.message:null,$scope.initiatePaymentFailed=!0,void $scope.fmRefreshCartAndRedirectToMenu()},$scope.getCart=function(cb){Api.getCart(function(cartInfo){$scope.formatCartInfo(cartInfo,cb)})},$scope.setCartItemCount=function(){if($scope.cartItemsCount=0,$scope.cart&&$scope.cart.items)for(var i=0;i<$scope.cart.items.length;i++)$scope.cartItemsCount+=$scope.cart.items[i].quantity;else $scope.cartItemsCount=0;0!=$scope.cartItemsCount&&$(".btn-cart").addClass("selected"),0==$scope.cartItemsCount&&$(".btn-cart").removeClass("selected")},$scope.goToMenu=function(){window.location.href="/"},$scope.goToCheckout=function(){$scope.cart.items.length>0&&!_.isUndefined($scope.location)&&!_.isEmpty($scope.location)?window.location.href="/checkout":($scope.showLocation=!0,$scope.fail=!0,rightSideMenu.toggleMenu())},$scope.checkIfPreparing=function(){var name=$scope.lastOrder.latestOrderByUser.status.name;return"new"==name||"confirmed"==name},$scope.getProductQuantity=function(product){var counter=0;window.fmIsMobileTemplate&&(product=_processProduct(product));for(var i=0;i<$scope.cart.items.length;i++)$scope.cart.items[i].productId==product.id&&(counter+=$scope.cart.items[i].quantity);return counter},$scope.cartQueue=[],$scope.addToCartFirst=function(item,index,collectionId){0==index&&($scope.cartQueue.push({item:item,collectionId:collectionId}),1==$scope.cartQueue.length&&$scope.clearCartQueue())},$scope.clearCartQueue=function(){if(0!=$scope.cartQueue.length){var data=$scope.cartQueue[0];$scope.addToCartPerCollection(data.item,1,data.collectionId,function(){$scope.clearCartQueue(),$scope.cartQueue.shift()})}},$scope.filterBusinessProduct=function(product,collection){var first="Desserts"!=collection.name,second=!(684==product.id||683==product.id||379==product.id||518==product.id||519==product.id||375==product.id||374==product.id||673==product.id||674==product.id||91==product.id||225==product.id);return first&&second},$scope.addToCartPerCollection=function(item,quantity,collectionId,callback){var ok=!0;$scope.businessLoading=!0;for(var i=0;i<$scope.cart.items.length;i++){if(item.id==$scope.cart.items[i].productId){var ok=!1;Api.removeFromCart({product:$scope.cart.items[i].productDTO,quantity:quantity},function(data){$scope.cart=data.cart,$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,$scope.businessLoading=!1});break}if($scope.getProductCollectionId($scope.cart.items[i].productId)==collectionId){ok=!1,Api.removeFromCart({product:$scope.cart.items[i].productDTO,quantity:quantity},function(data){$scope.cart=data.cart,$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,Api.addToCart({product:item,quantity:quantity},function(data){$scope.cart=data.cart,$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,$scope.businessLoading=!1,_.isUndefined(callback)||callback()})});break}}ok&&Api.addToCart({product:item,quantity:quantity},function(data){$scope.cart=data.cart,$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,$scope.businessLoading=!1,_.isUndefined(callback)||callback()})},$scope.getProductCollectionId=function(itemId){for(var i=0;i<$scope.menu.collections.length;i++)for(var j=0;j<$scope.menu.collections[i].products.length;j++)if(itemId==$scope.menu.collections[i].products[j].id)return $scope.menu.collections[i].id},$scope.showDropdown=function(){$scope.showLocation=!0,$scope.showMobileDropdown=!0},$scope.getContactInfo=function(){$scope.contactInfo=window.contactInfo};var _getItemQtyInCart=function(itemBeAdded){var itemInCart=_.find($scope.cart.items,function(item){return item.productId==itemBeAdded.id});return itemInCart?itemInCart.quantity:0};$scope.addToCartFromRecommendations=function(item,quantity){window.fmIsMobileTemplate&&(item=_processProduct(item)),item=_.assign({},item),item.isInRecommendedSec=!0,$scope.addToCart(item,quantity)},$scope.cartHasPreorder=function(){var ok=!1;return _.each($scope.cart.items,function(item){$scope.checkTimings(item.productDTO.timings,!0)||(ok=!0)}),ok},$scope.getPreorderProductsFromCart=function(){return _.filter($scope.cart.items,function(item){return!$scope.checkTimings(item.productDTO.timings,!0)})},$scope.redirectToCheckout=function(){$scope.fireEventsAndRedirect()},$scope.removeAllPreorderFromCart=function(){Api.removeBulkFromCart($scope.getPreorderProductsFromCart(),function(data){$scope.fireEventsAndRedirect()})},$scope.fireEventsAndRedirect=function(){GTM_log_funnel_step({action:"Checkout",ecommerce:{checkout:{actionField:{step:4},products:GTM_map_cart_products($scope.cart)}}},function(){console.log("########################## FUNNEL STEP 4")});var amount=($scope.cart&&$scope.cart.finalAmount?$scope.cart.finalAmount:0).toString(),path=document.location.pathname,page=path.substring(path.indexOf("/"));page.indexOf("/product")>0&&(page="Product detail"),TrackingService.postEvent("Checkout clicked",{Kitchen:$scope.menu.fulfillmentCenter.name,Amount:amount,Source:page,"corporate enabled":!(!$scope.cart||!$scope.cart.corporateDiscount)}),window.location.href="/checkout"},$scope.addToCartFromYouMightAlsoLike=function(item,quantity){item.isYouMightLikeProduct=!0,$scope.addToCart(item,quantity)},$scope.addToCartFromProductDetailsPopup=function(item,quantity){item.isItemFromProductDetails=!0,$scope.addToCart(item,quantity)},$scope.addToCartFromUpsale=function(item,quantity){item.isUpsale=!0,$scope.addToCart(item,quantity)},$scope.gettingAddonsDetails=!1,$scope.fmAddonFlags={},$scope.fmAddonItemsSelected=[],$scope.fmPrevRadioButtonItem=null,$scope.fmIsInstaCouponApplied=!1,$scope.fmAddonPopupItemPrice=0,$scope.removeAddonFromSelectedList=function(addonId){for(var i=0;i<$scope.fmAddonItemsSelected.length;i++)if($scope.fmAddonItemsSelected[i].id==addonId)return $scope.fmAddonItemsSelected.splice(i,1),i},$scope.fmIsAddonChecked=function(addonGroup,item){return!!$scope.fmAddonFlags[addonGroup.groupName]&&!!$scope.fmAddonFlags[addonGroup.groupName][item.id]},$scope.fmSetAddonFlag=function(groupType,groupName,item){"MULTI"==groupType?($scope.fmAddonFlags[groupName]||($scope.fmAddonFlags[groupName]={}),1==$scope.fmAddonFlags[groupName][item.id]?($scope.fmAddonFlags[groupName][item.id]=!1,$scope.removeAddonFromSelectedList(item.id),$scope.fmAddonPopupItemPrice-=item.sellingPrice):($scope.fmAddonFlags[groupName][item.id]=!0,$scope.fmAddonPopupItemPrice+=item.sellingPrice,$scope.fmAddonItemsSelected.push(item))):($scope.fmAddonFlags[groupName]&&$scope.removeAddonFromSelectedList($scope.fmPrevRadioButtonItem.id),$scope.fmPrevRadioButtonItem&&($scope.fmAddonPopupItemPrice-=$scope.fmPrevRadioButtonItem.sellingPrice),$scope.fmAddonFlags[groupName]={},$scope.fmAddonFlags[groupName][item.id]=!0,$scope.fmAddonItemsSelected.push(item),$scope.fmAddonPopupItemPrice+=item.sellingPrice,$scope.fmPrevRadioButtonItem=item)},$scope.addonAddToCart=function(){var fmMakeItem=$.extend(!0,{},$scope.currentAddonItem);fmMakeItem.addons=[],fmMakeItem.addons=$scope.fmAddonItemsSelected,fmMakeItem.isCustomizableAddons=!1,$scope.addToCart(fmMakeItem,1),PRODUCT_DETAILS_ADDONS_POPUP.hide()},$scope.addonAddToCartClose=function(){var fmMakeItem=$.extend(!0,{},$scope.currentAddonItem);fmMakeItem.addons=[],fmMakeItem.isCustomizableAddons=!1,$scope.addToCart(fmMakeItem,1),PRODUCT_DETAILS_ADDONS_POPUP.hide()},$scope.defaultLocationModal=!1,$scope.closeDefaultLocationModal=function(){$scope.defaultLocationModal=!1},$scope.addToCart=function(item,quantity,$index){var itemQtyInCart;if(window.fmIsMobileTemplate&&(item=_processProduct(item)),item.isCustomizableAddons)$scope.currentAddonItem=item,$scope.fmAddonFlags={},$scope.fmAddonItemsSelected=[],$scope.fmAddonPopupItemPrice=$scope.currentAddonItem.sellingPrice,$scope.fmPrevRadioButtonItem=null,$scope.gettingAddonsDetails=!0,TrackingService.postEvent("Screen visited",{Screenname:"Add ons",Id:item.id,Title:item.title,Category:item&&item.categories&&item.categories[0]&&item.categories[0].name?item.categories[0].name:"",Cuisine:item&&item.cuisine&&item.cuisine.name?item.cuisine.name:""}),PRODUCT_DETAILS_ADDONS_POPUP.show(),setTimeout(function(){$scope.pdpPopupCallback(!1),PRODUCT_DETAILS_POPUP.hide()},100),$scope.addonsProducts=null,Api.getAddonsDetails({productId:item.id},function(data){data.addonsProducts&&data.addonsProducts.length&&($scope.addonsProducts=data.addonsProducts),$scope.gettingAddonsDetails=!1},function(data){$scope.gettingAddonsDetails=!1,console.log("error in fetching addons..")});else{var fmEmail=$scope.user&&$scope.user.email?$scope.user.email:Cookie.get("fmAlternativeEmailId")&&Cookie.get("fmAlternativeEmailId").length>0?Cookie.get("fmAlternativeEmailId"):"";if(window.criteo_q&&(window.criteo_q.push({event:"setAccount",account:39162},{event:"setEmail",email:[fmEmail]},{event:"setSiteType",type:window.fmIsMobileTemplate?"m":"d"},{event:"viewItem",item:item.id}),console.log("CRITEO ---- ADD TO CART")),$scope.defaultMenu)$scope.showLocationForMobile(),$scope.fail=!0,MODAL_LOCATION_ADDRESS.show();else{if(itemQtyInCart=_getItemQtyInCart(item),15==itemQtyInCart)return MODAL_BULK.show(),$scope.pdpPopupCallback(!1),void PRODUCT_DETAILS_POPUP.hide();if(!$scope.cartAction&&(!$scope.validation.error||_.isUndefined($scope.validation.error[item.id])))if(item.confirmDelete=void 0,$scope.cartAction=!0,_.isUndefined($scope.location.lat)&&_.isUndefined($scope.location.id))MODAL_LOCATION_ADDRESS.show(),$scope["checkoutCartLoading"+$index]=!1,$scope.highlightSearch=!0,item.addingToCart=!1,$scope.cartAction=!1;else{if($scope.highlightSearch=!1,$scope.predictCart(item,quantity,!0),item.addingToCart=!0,$scope.fmAddonPopupItemPrice&&$scope.fmAddonPopupItemPrice>item.price&&(item.price=$scope.fmAddonPopupItemPrice),window.load_revx){window._atm_params&&(window._atm_params.f="s",window._atm_params.id=item.id.toString());var ast=document.createElement("script");ast.type="text/javascript",ast.src=("https:"==document.location.protocol?"https:":"http:")+"//cdn.atomex.net/static/js/pxs/"+_atm_client_id+"/ast.js",document.body.appendChild(ast)}itemIsInRecommendedSec=item.isInRecommendedSec,itemClone=_.assign({},item),delete itemClone.isInRecommendedSec;var requestForAddToCart={product:itemClone,quantity:quantity};Api.addToCart(requestForAddToCart,function(data){if($scope.fmAddonPopupItemPrice=null,$scope["checkoutCartLoading"+$index]=!1,$scope.cart=data.cart,$scope.fmDeliveryEstimate=$scope.getDeliveryTimeInterval(data.cart),$scope.showFreebieMessage(data.cart),$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,$(".cart-button span").css({display:"none"}),$scope.setCartItemCount(),$scope.cartAction=!1,$scope.savedItem=void 0,$scope.handleDisplayClearCartPopup(),data.validation.cartErrorDTO&&"421"==data.validation.cartErrorDTO.errorCode&&data.validation.cartErrorDTO.error&&data.validation.cartErrorDTO.error[item.id]?item.soldOut=!0:item.soldOut=!1,item.addingToCart=!1,$(".cart-button").addClass("fm-cart-number-animation"),setTimeout(function(){$(".cart-button span").show(),$(".cart-button").removeClass("fm-cart-number-animation")},500),item){var triggerOpenCartEvent=function(){1!=$scope.cartItemsCount||window.fmIsMobileTemplate||item.isItemFromProductDetails&&1==item.isItemFromProductDetails||item.isYouMightLikeProduct&&1==item.isYouMightLikeProduct||(fmIsMobileTemplate?MENU_CART.show():(GTM_log_funnel_step({action:"Checkout",ecommerce:{checkout:{actionField:{step:3},products:GTM_map_cart_products($scope.cart)}}},function(){console.log("########################## FUNNEL STEP 3")}),openCart()))},addingType=item.soldOut||!$scope.checkTimings(item.timings)||$scope.kitchenClosed?"Preorder":"Order now",path=document.location.pathname,page=path.substring(path.indexOf("/"));"/"==page&&(page="/menu"),itemIsInRecommendedSec?(itemIsInRecommendedSec=!1,page=$scope.menu.is_rcm?"Recommended":"Trending"):item.isUpsale?page="Cross-sell":item.isYouMightLikeProduct?page="you may also like":item.isItemFromProductDetails&&(page="Product detail"),item.addons&&item.addons.length>0&&(page="add ons"),$scope.GAStepOneEventOneDone||($scope.GAStepOneEventOneDone=!0,$scope.triggerGAStepEvent(1)),setTimeout(function(){$scope.triggerGAStepEvent(2,triggerOpenCartEvent)},0),dataLayer.push({event:"fireRemarketingTag",google_tag_params:{dynx_pagetype:"conversionintent",dynx_itemid:item.id}}),$scope.fmIsCategoryHomePage&&(page=window.fmCategoryPageName),TrackingService.postEvent("Product added",{Id:item.id,Title:item.title,Category:item&&item.categories&&item.categories[0]&&item.categories[0].name?item.categories[0].name:"",Type:addingType,ScrollDepth:$(window).scrollTop(),Source:page,Cuisine:item&&item.cuisine&&item.cuisine.name?item.cuisine.name:"",Corporate:!(!item||!item.pm||"CORPORATE DISCOUNT"!=item.pm)})}!$scope.fmIsInstaCouponApplied&&$scope.menu.initialOfferCode&&$scope.menu.initialOfferCode.length>0&&$scope.addOfferCode($scope.menu.initialOfferCode)})}}}},$scope.offerCodeApplying=!1,$scope.addOfferCodeMobile=function(code,open){if(void 0!==code&&""!==code&&(offerCode=code,code||($scope.forms.offer={offerCode:""}),$scope.cart.offer||$scope.forms.offer.offerCode)){var data={};data.offerCode=offerCode,code?data.removedOffer="false":data.removedOffer="true",$scope.offerCodeApplying=!0,Api.addOfferCode(data,function(data){$scope.offerCodeApplying=!1,data.cart.offer||($scope.forms.offer||($scope.forms.offer={}),$scope.forms.offer.offerCode=""),$scope.cart=data.cart,$scope.validation=data.validation,!open&&$scope.cart.offer&&$scope.cart.offer.status&&$scope.goback()})}},$scope.addOfferCode=function(code,open){if(void 0!==code&&""!==code&&(offerCode=code,code||($scope.forms.offer={offerCode:""}),$scope.cart.offer||$scope.forms.offer.offerCode)){var data={};data.offerCode=offerCode,code?data.removedOffer="false":data.removedOffer="true",$scope.offerCodeApplying=!0,Api.addOfferCode(data,function(data){$scope.offerCodeApplying=!1,data.cart.offer||($scope.forms.offer||($scope.forms.offer={}),$scope.forms.offer.offerCode=""),$scope.cart=data.cart,$scope.validation=data.validation})}},$scope.cancelRemoveFromCart=function(item){item.confirmDelete=void 0},$scope.isCartContainsAtleastOneVisibleItem=function(){for(var containsAtleastOneVisibleItem=!1,i=0;i<$scope.cart.items.length&&!containsAtleastOneVisibleItem;i++)containsAtleastOneVisibleItem=containsAtleastOneVisibleItem||$scope.cart.items[i].productDTO.isVisible;return containsAtleastOneVisibleItem},$scope.removeFromCart=function(item,quantity,useConfirm,currentQuantity,$index){window.fmIsMobileTemplate&&(item=_processProduct(item)),$scope.cartAction||(item.addingToCart=!0,$scope.cartAction=!0,$scope.predictCart(item,quantity,!1),item.removingFromCart=!0,Api.removeFromCart({product:item,quantity:quantity},function(data){item.removingFromCart=!1,$scope["checkoutCartLoading"+$index]=!1,$scope.cart=data.cart,$scope.fmDeliveryEstimate=$scope.getDeliveryTimeInterval(data.cart),$scope.showFreebieMessage(data.cart),$scope.verifyCartTimings(data.cart.deliveryTimes),$scope.validation=data.validation,$scope.cartAction=!1,item.addingToCart=!1,$scope.setCartItemCount();var addingType=item.soldOut||!$scope.checkTimings(item.timings)||$scope.kitchenClosed?"Preorder":"Order now";TrackingService.postEvent("Product deleted",{Id:item.id,Title:item.title,Category:item&&item.categories&&item.categories[0]?item.categories[0].name:"",Type:addingType,ScrollDepth:$(window).scrollTop(),Cuisine:item&&item.cuisine&&item.cuisine.name?item.cuisine.name:"",Source:"/menu",Corporate:!(!item||!item.pm||"CORPORATE DISCOUNT"!=item.pm)}),0==$scope.cartItemsCount&&(document.body.style.overflow="auto"),$scope.handleDisplayClearCartPopup(),$scope.cart.items&&$scope.cart.items.length>0&&!$scope.isCartContainsAtleastOneVisibleItem()&&(MENU_CART.hide(),$scope.closeCart(),$scope.emptyCart())}))},$scope.inCart=function(productId){var index=-1;return $scope.cart&&$scope.cart.items&&$scope.cart.items.length>0&&(index=_.findIndex($scope.cart.items,{productId:productId})),index},$scope.inCartAll=function(productId){var i,indexes=[];if($scope.cart&&$scope.cart.items&&$scope.cart.items.length>0)for(i=0;i<$scope.cart.items.length;i++)$scope.cart.items[i].productId==productId&&indexes.push(i);return indexes},$scope.getAddonsprice=function(addons){var price=0;if(void 0!==addons)for(var addonslen=addons.length,i=0;i<addonslen;i++)price+=addons[i].sellingPrice;return price},$scope.similaraddons=function(lineItem,currentItem){var lineItemIds=[],currentItemIds=[];void 0!==lineItem?lineItem.forEach(function(el,i){lineItemIds[i]=el.id}):lineItem=[],void 0!==currentItem?currentItem.forEach(function(el,i){currentItemIds[i]=el.id}):lineItem=[];for(var i=0;i<currentItemIds.length;i++)if(!lineItemIds.includes(currentItemIds[i]))return!1;return!0},$scope.predictCart=function(item,quantity,isAdded){var indexes=$scope.inCartAll(item.id),addonsPrice=$scope.getAddonsprice(item.addons);if(isAdded){if(0==indexes.length)$scope.cart.items.push({pricePerItem:item.sellingPrice,productId:item.id,quantity:quantity,totalPrice:(item.sellingPrice+addonsPrice)*quantity,productDTO:item});else{var i,similaritems=!1;for(i=0;i<indexes.length;i++){var cartitemAddon=$scope.cart.items[indexes[i]].productDTO.addons,currentitemAddon=item.addons;if((cartitemAddon&&cartitemAddon.length?cartitemAddon.length:-1==currentitemAddon&&currentitemAddon.length?currentitemAddon.length:-1)&&(similaritems=$scope.similaraddons($scope.cart.items[indexes[i]].productDTO.addons,item.addons)))break}similaritems?($scope.cart.items[indexes[i]].quantity+=quantity,$scope.cart.items[indexes[i]].totalPrice+=quantity*(item.sellingPrice+addonsPrice)):$scope.cart.items.push({pricePerItem:item.sellingPrice,productId:item.id,quantity:quantity,totalPrice:(item.sellingPrice+addonsPrice)*quantity,productDTO:item})}1==$scope.cart.items.length&&($scope.cart.paymentDetails.totalAmount=$scope.cart.items[0].totalPrice)}else if(0!=indexes.length){if(1==indexes.length)$scope.cart.items[indexes[0]].quantity==quantity?$scope.cart.items.splice(indexes[0],1):($scope.cart.items[indexes[0]].quantity-=quantity,$scope.cart.items[indexes[0]].totalPrice-=quantity*(item.sellingPrice+addonsPrice));else{var i,similaritems=!1;for(i=0;i<indexes.length;i++){var cartitemAddon=$scope.cart.items[indexes[i]].productDTO.addons,currentitemAddon=item.addons;if((cartitemAddon&&cartitemAddon.length?cartitemAddon.length:-1==currentitemAddon&&currentitemAddon.length?currentitemAddon.length:-1)&&(similaritems=$scope.similaraddons($scope.cart.items[indexes[i]].productDTO.addons,item.addons)))break}$scope.cart.items[indexes[i]].quantity==quantity?$scope.cart.items.splice(indexes[i],1):($scope.cart.items[indexes[i]].quantity-=quantity,$scope.cart.items[indexes[i]].totalPrice-=quantity*(item.sellingPrice+addonsPrice))}$scope.setCartItemCount(),0==$scope.cartItemsCount&&(fmIsMobileTemplate?MENU_CART.hide():$scope.closeCart())}},$scope.getUser=function(callback){Api.getUser(function(data){$scope.isUserCallDone=!0,$scope.user=data,$scope.forms.update.user=data,callback&&callback(data),$scope.setDividerText()})},$scope.fcList=[],$scope.productFilter=function(product,soldOut){return!(!$scope.hasAnyCategories(product,$scope.fcList)&&$scope.filterActive)},$scope.newFilterList=[],$timeout(function(){var queryParamFilter=$scope.getParameterByName("fm-filter"),filterMapper={veg:"Veg",egg:"Contains Egg"};if(queryParamFilter&&queryParamFilter.length>0&&filterMapper[queryParamFilter.toLowerCase()]){$scope.fmClearAllFilters();var filterList=[];filterList.push(filterMapper[queryParamFilter]),$scope.setNewFilter(filterList),"Contains Egg"==filterMapper[queryParamFilter]?$("#square-checkout-box-input-2").prop("checked",!0):"Veg"==filterMapper[queryParamFilter]?$("#square-checkout-box-input-3").prop("checked",!0):"orderNow"==filterMapper[queryParamFilter]?$("#square-checkout-box-input-4").prop("checked",!0):$scope.fmCuisineFilters.indexOf(filterMapper[queryParamFilter]!=-1)&&$("#check-box-cuisine-"+$scope.fmCuisineFilters.indexOf(filterMapper[queryParamFilter])).prop("checked",!0)}else{var fmFilterListCookie=Cookie.get("fmFilterList");if(fmFilterListCookie)for(var list=fmFilterListCookie.split(","),i=0;i<list.length;i++)""!=list[i]&&$scope.setNewFilter(list[i]),"Contains Egg"==list[i]?$("#square-checkout-box-input-2").prop("checked",!0):"Veg"==list[i]?$("#square-checkout-box-input-3").prop("checked",!0):"orderNow"==list[i]?$("#square-checkout-box-input-4").prop("checked",!0):$scope.fmCuisineFilters.indexOf(list[i]!=-1)&&$("#check-box-cuisine-"+$scope.fmCuisineFilters.indexOf(list[i])).prop("checked",!0)}},1e3),$scope.findAndMapProductDetailsForProductDetails=function(product,callback){var ok=!0;_.each($scope.menu.collections,function(collection){var productFound=_.find(collection.products,function(item){return item.id==product.id});!_.isUndefined(productFound)&&ok&&(ok=!1,productFound.timings=productFound.deliveryTimings,productFound.price=productFound.price||0,productFound.available=productFound.isAvailable,productFound.soldOut=!productFound.available,productFound.additionalProperties=product.additionalProperties,productFound.webDescription=product.webDescription,productFound.foodTags=product.foodTags,callback(productFound))}),ok&&(product.timings=void 0,product.price=void 0,product.available=!1,product.soldOut=!product.available,callback(product))},$scope.getMenuSuggestedProducts=function(productId,limit){var tempProd,tempSuggestedProducts=[];$scope.suggestedProducts=[],Api.getSuggestedProducts(productId,function(response){if(response&&response.products&&response.products.length>0){for(var i=0;i<$scope.menu.collections.length;i++)for(var collection=$scope.menu.collections[i],j=0;j<response.products.length;j++){var productId=response.products[j];tempProd=_.filter(collection.products,function(prod){return!!productId&&prod.id==productId}),tempProd.length>0&&tempSuggestedProducts.push(tempProd[0])}$scope.suggestedProducts=tempSuggestedProducts.splice(0,3)}else $scope.suggestedProducts=[]},function(){$scope.suggestedProducts=[]})},$scope.showOnlyExpressItems=eval(Cookie.get("showOnlyExpressItems")),$timeout(function(){$scope.showOnlyExpressItems&&$("#square-checkout-box-input-1").prop("checked",!0)},1e3),$scope.handleProductDetailsDisplayForBanner=function(product_id){var product=_getProductFromId(product_id);return!!_.isEmpty(product)||void(window.location.href="/"+product.slug+"/product/"+product.id)},$scope.handleProductDetailsPage=function(product_id,slug){TrackingService.postEvent("Clicked",{screenName:"product detail"}),(_.isEmpty(slug)||_.isUndefined(slug))&&(slug="product"),window.location.href="/"+slug+"/product/"+product_id},$scope.handleProductDetailsDisplay=function(product){$scope.product_details=product,$scope.showCart?($scope.closeCart(),setTimeout(function(){$scope.pdpPopupCallback(!0),PRODUCT_DETAILS_POPUP.show()},500)):($scope.pdpPopupCallback(!0),PRODUCT_DETAILS_POPUP.show()),dataLayer.push({event:"fireRemarketingTag",google_tag_params:{dynx_pagetype:"offerdetail",dynx_itemid:product.id}}),TrackingService.postEvent("Screen Visited",{screenName:"product detail"}),window.criteo_q&&(window.criteo_q.push({event:"setAccount",account:39162},{event:"setSiteType",type:window.fmIsMobileTemplate?"m":"d"},{event:"viewItem",item:product.id}),console.log("CRITEO ---- PDP POPUP")),Api.getProductDetails(product.id,function(completeProductDetails){completeProductDetails.timings=completeProductDetails.deliveryTimings,completeProductDetails.price=completeProductDetails.sellingPrice||0,completeProductDetails.available=completeProductDetails.isAvailable,completeProductDetails.soldOut=!completeProductDetails.available,completeProductDetails.isVeg=$scope.isVeg(completeProductDetails),$timeout(function(){$scope.product_details=completeProductDetails},100)}),$scope.getMenuSuggestedProducts(product.id,4),$scope.fireGAEvent("PDP","load","pdp_load_success")},$scope.searchForPriceFilter=function(str,strArray){for(var j=0;j<strArray.length;j++)if(strArray[j].match(str))return j;return-1},$scope.$watchCollection("newFilterList",function(newVal,oldVal){if($(".fm-filters-container li").first().find("a").removeClass("hasfilter"),$(".fm-filters-container li").last().find("a").removeClass("hasfilter"),
newVal.length>0){var count=0;_.each(newVal,function(filter){_.contains($scope.fmCuisineFilters,filter)&&++count}),0==count?$(".fm-filters-container li").first().find("a").addClass("hasfilter"):count==newVal.length?$(".fm-filters-container li").last().find("a").addClass("hasfilter"):($(".fm-filters-container li").first().find("a").addClass("hasfilter"),$(".fm-filters-container li").last().find("a").addClass("hasfilter"))}}),$scope.setNewFilter=function(filter){if(dataLayer.push({event:"customEvent",category:"Filter",action:"Click",label:filter[0],value:1}),$scope.isFilterButtonClicked=!0,$scope.newFilterList.length>0)if(filter.toString().match("price-")){var isPriceFilterThere=$scope.searchForPriceFilter("price-",$scope.newFilterList);isPriceFilterThere!=-1?($scope.newFilterList.splice(isPriceFilterThere,1),$scope.newFilterList.push(filter.toString())):$scope.newFilterList.push(filter.toString())}else{var index=$scope.newFilterList.indexOf(filter.toString());index!=-1?$scope.newFilterList.splice(index,1):$scope.newFilterList.push(filter.toString())}else $scope.newFilterList.push(filter.toString());TrackingService.postEvent("Filter",{"Filter applied":$scope.newFilterList.toString()}),window.fmIsMobileTemplate&&($("#square-checkout-box-input-2").prop("checked",$scope.newFilterList.indexOf("Contains Egg")>=0),$("#square-checkout-box-input-3").prop("checked",$scope.newFilterList.indexOf("Veg")>=0)),$scope.newFilterListName=filter.toString(),Cookie.set({cookieName:"fmFilterList",cookieValue:$scope.newFilterList.toString(),expireTime:2})},$scope.fmClearAllFilters=function(){$scope.showOnlyExpressItems=!1,$scope.newFilterList=[],Cookie.delete("fmFilterList"),Cookie.delete("showOnlyExpressItems"),$("#square-checkout-box-input-4").prop("checked",!1),$("#square-checkout-box-input-3").prop("checked",!1),$("#square-checkout-box-input-2").prop("checked",!1),$("#square-checkout-box-input-1").prop("checked",!1),_.each($scope.fmCuisineFilters,function(cuisine,index){$("#check-box-cuisine-"+index).prop("checked",!1)})},$scope.checkNewFilter=function(filter){return _.isEqual($scope.newFilterList.sort(),filter.sort())},$scope.countFiltered=function(products,fcList){if(_.isUndefined(products)||_.isEmpty(products))return!1;if(_.isUndefined(fcList)||_.isEmpty(fcList))return!0;var count=0;return _.each(products,function(product){$scope.hasAnyCategories(product,fcList)&&count++,$scope.hasAnyCategories(product,fcList)?$scope.showOnlyExpressItems?product.isExpressItem&&count++:count++:0==fcList.length&&($scope.showOnlyExpressItems?product.isExpressItem&&count++:count++)}),count>0},$scope.hasAnyCategories=function(product,fcList){window.fmIsMobileTemplate&&(product=_processProduct(product));var flag;if(!_.isUndefined(product.categories)){var map=(product.categories.length,_.map(product.categories,function(item){return item.name}));flag=!_.isEmpty(_.intersection(map,fcList)),fcList.indexOf("Contains Egg")>-1&&fcList.indexOf("Veg")==-1&&!flag&&(flag=!_.isEmpty(_.intersection(map,["Veg"])))}$scope.newFilterList.indexOf("orderNow")!=-1&&(fcList.indexOf("Veg")==-1&&fcList.indexOf("Contains Egg")==-1?0==flag&&(product.soldOut||!$scope.checkTimings(product.timings,!0)||$scope.kitchenClosed||(flag=!0)):(1!=flag||product.soldOut||!$scope.checkTimings(product.timings,!0)||$scope.kitchenClosed)&&(flag=!1));var isPriceFilterThere=$scope.searchForPriceFilter("price-",fcList);isPriceFilterThere!=-1&&(flag=$scope.fmPriceFilterFun(flag,fcList,product,isPriceFilterThere));var CuisineFilters=_.intersection(fcList,$scope.fmCuisineFilters),CFlength=CuisineFilters.length;return CFlength>0&&(flag=$scope.fmCuisineFilterFun(flag,fcList,product,isPriceFilterThere,CuisineFilters)),flag},$scope.fmPriceFilterFun=function(flag,fcList,product,isPriceFilterThere){return fcList.indexOf("Veg")==-1&&fcList.indexOf("Contains Egg")==-1&&fcList.indexOf("orderNow")==-1?0==flag&&parseInt(fcList[isPriceFilterThere].split("-")[1])>=product.sellingPrice&&(flag=!0):1==flag&&parseInt(fcList[isPriceFilterThere].split("-")[1])>=product.sellingPrice||(flag=!1),flag},$scope.fmCuisineFilterFun=function(flag,fcList,product,isPriceFilterThere,CuisineFilters){return fcList.indexOf("Veg")==-1&&fcList.indexOf("Contains Egg")==-1&&fcList.indexOf("orderNow")==-1&&isPriceFilterThere==-1?0==flag&&$scope.searchForPriceFilter(product.cuisine.name,CuisineFilters)!=-1&&(flag=!0):1==flag&&$scope.searchForPriceFilter(product.cuisine.name,CuisineFilters)!=-1||(flag=!1),flag},$scope.toggleFilterDropdown=function(){$scope.dropdownFilterOpen=!$scope.dropdownFilterOpen},$scope.handleClickEventsOnBody=function(event){$scope.dropdownFilterOpen&&($scope.dropdownFilterOpen=!1)},$scope.removeUserAddress=function(address_id){var userId=$scope.user?$scope.user.id:null;userId&&Api.removeUserAddress(address_id,userId,function(data){$scope.getUserAddresses()})},$scope.filterSet=function(cList){_.isEmpty(cList)?($scope.filterActive=!1,$scope.fcList=cList):_.isEqual($scope.fcList.sort(),cList.sort())||($scope.filterActive=!0,$scope.fcList=cList)},$scope.isFilterActive=function(cList){return _.isEqual($scope.fcList.sort(),cList.sort())},_setHideModalAppCookie=function(){var now=new Date,time=now.getTime();time+=6048e5,now.setTime(time),document.cookie="hideModalApp=true; expires="+now.toUTCString()+";"},$scope.getDeviceType=function(isIosMobile){var userAgent=navigator.userAgent||navigator.vendor||window.opera,isIosMobile=userAgent.match(/iPad/i)||userAgent.match(/iPhone/i)||userAgent.match(/iPod/i),deviceType=(userAgent.match(/Android/i),"");return deviceType=isIosMobile?"iPhone":"Andriod"},$scope.handleDisplayOfModalApp=function(){_setHideModalAppCookie()},$scope.setModalAppUrl=function($event){function getMobileOperatingSystem(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;return userAgent.match(/iPad/i)||userAgent.match(/iPhone/i)||userAgent.match(/iPod/i)?"iOS":userAgent.match(/Android/i)?"Android":"unknown"}var os=getMobileOperatingSystem();$scope.appRedirectUrl="http://freshmenu.com",$scope.modalAppRedirectUrl="http://freshmenu.com","Android"==os?($scope.modalAppRedirectUrl="http://play.google.com/store/apps/details?id=com.freshmenu",$scope.appRedirectUrl="https://play.google.com/store/apps/details?id=com.freshmenu&utm_source=website&utm_medium=dlink&utm_campaign=appdownload"):"iOS"==os&&($scope.modalAppRedirectUrl="http://itunes.apple.com/in/app/freshmenu-fresh-meal-delivery/id957179182?mt=8",$scope.appRedirectUrl="https://itunes.apple.com/in/app/freshmenu-fresh-meal-delivery/id957179182?mt=8&utm_source=website&utm_medium=dlink&utm_campaign=appdownload");var utm_pattern=new RegExp("utm_source"),url=$scope.modalAppRedirectUrl;url+=$window.location.search.length>0&&utm_pattern.test($window.location.search)?"&"+$window.location.search.split("?")[1]:"&utm_source=mweb&utm_medium=bottomsheet&utm_campaign=appdownload",$scope.modalAppRedirectUrl=url},$scope.setModalAppUrl(),$scope.setDividerText=function(){$scope.dividerText=$scope.user.id?"SAVED ADDRESS":"TOP LOCATIONS"},$scope.setLocationsSuggestions=function(){$scope.locationsSuggestions={addresses:[{addressLine2:"Koramangala, Bengaluru",lat:12.9279232,lon:77.62710779999998},{addressLine2:"Whitefield, Bengaluru",lat:12.9697999,lon:77.74994670000001},{addressLine2:"Marathahalli, Bengaluru",lat:12.9591722,lon:77.69741899999997},{addressLine2:"J P Nagar, Bengaluru",lat:12.910491,lon:77.5857168},{addressLine2:"HSR Layout, Bengaluru",lat:12.9081357,lon:77.64760799999999},{addressLine2:"Indiranagar, Bengaluru",lat:12.9718915,lon:77.64115449999997},{addressLine2:"Domlur, Bengaluru",lat:12.9609857,lon:77.63873160000003},{addressLine2:"Sarjapur, Bengaluru",lat:12.8614,lon:77.7863}]}},$scope.setDefaultAddressesList=function(){},$scope.product_details={},$scope.ifProduct=function(product){return!_.isEmpty(product)},$scope.constructProductDetailPageUrl=function(product){window.fmIsMobileTemplate&&(product=_processProduct(product));var id=product.id,slug=product.slug;return location.origin+"/"+slug+"/product/"+id},$scope.setAddress=function(address,location){},$scope.findAndMapProductDetails=function(menu,product,callback){var ok=!0;_.each(menu.collections,function(collection){var productFound=_.find(collection.products,function(item){return item.id==product.id});_.isUndefined(productFound)||(ok=!1,productFound.timings=collection.deliveryTimings[product.id],productFound.price=collection.priceMap[product.id]?collection.priceMap[product.id].sellingPrice:0,productFound.available=menu.availability[product.id],productFound.soldOut=!productFound.available,callback(productFound))}),ok&&(product.timings=void 0,product.price=void 0,product.available=!1,product.soldOut=!product.available,callback(product))},$scope.getParameterByName=function(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)","i"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},$scope.validateUserEmail=function(user,formOject){if($scope[formOject]){var emailRegx=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;_.isUndefined(user.email)||_.isEmpty(user.email)||!user.email.match(emailRegx)?$scope[formOject].email=!0:$scope[formOject].email=!1}},$scope.validateLoginForm=function(user,loginFormObject){$scope[loginFormObject]={},user?((!user.email||0==user.email.length)&&$("#modal-login form input[name='email']").val().length>0&&(user.email=$("#modal-login form input[name='email']").val()),(!user.password||0==user.password.length)&&$("#modal-login form input[name='password']").val().length>0&&(user.password=$("#modal-login form input[name='password']").val())):(user={},$("#modal-login form input[name='email']").val().length>0&&(user.email=$("#modal-login form input[name='email']").val()),$("#modal-login form input[name='password']").val().length>0&&(user.password=$("#modal-login form input[name='password']").val()));var emailRegx=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return!$scope.businessPage||_.isUndefined(user)||_.isEmpty(user)||"swissre.com"==user.email.split("@")[1]?_.isUndefined(user)||_.isEmpty(user)?($scope[loginFormObject]={email:!0,password:!0},!1):((_.isUndefined(user.email)||_.isEmpty(user.email)||!user.email.match(emailRegx))&&($scope[loginFormObject].email=!0),(_.isUndefined(user.password)||_.isEmpty(user.password)||user.password.length<=3)&&($scope[loginFormObject].password=!0),_.isEmpty($scope[loginFormObject])):($scope[loginFormObject].email=!0,!1)},$scope.login=function(user,callback){$scope.validateLoginForm(user,"loginForm")&&($scope.loginLoading||($scope.loginLoading=!0,$scope.isUserCallDone=!1,Api.login(user,function(data){$scope.fromLoginSuccess=!0,$scope.getMenu(),$localstorage.removeItem("lastUsedAddressId"),$scope.user=data,$scope.isUserCallDone=!0,Cookie.set({cookieName:"fmAlternativeEmailId",cookieValue:data.email,expireTime:720}),Cookie.set({cookieName:"fmAlternativePhoneNumber",cookieValue:data.mobileNumber,expireTime:720}),$scope.setDividerText(),$scope.forms.checkout.user=data,$scope.getUserAddresses(null,$scope.checkAndRedirectIncaseReq),$scope.shouldRedirectAddress()||(window.MODAL_LOGIN&&window.MODAL_LOGIN.hide(),$scope.confirmInProgress&&($("#confirm").modal("show"),$scope.confirmInProgress=!1),$scope.loginLoading=!1,callback&&callback(data),dataLayer.push({event:"loginRequest",action:"Email",label:"Success"}),TrackingService.postEvent("User identified",{type:"Login",Mode:"Email",Status:"Success",Email:data.email?data.email:"","source screen":$scope.loginSourceScreen,"NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)},data),$scope.callAfterAnyLogin())},function(data){$scope.isUserCallDone=!0,500==data.status?$scope.forms.login.errors={data:{message:"Something went wrong. Try again"}}:$scope.forms.login.errors=data,$scope.loginLoading=!1,dataLayer.push({event:"loginRequest",action:"Email",label:"Fail"}),TrackingService.postEvent("User identified",{type:"Login",Mode:"Email",Status:"Failure",Email:data.email?data.email:"","source screen":$scope.loginSourceScreen,"NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)}),$scope.loginSourceScreen=""})))},$scope.validateUserPassword=function(user,formOject){$scope[formOject]&&(_.isUndefined(user)||_.isEmpty(user)||_.isUndefined(user.password)||_.isEmpty(user.password)||user.password.length<=3?$scope[formOject].password=!0:$scope[formOject].password=!1)};var _verifyMobileNumber=function(mobileVerificationForm){var successCb,errorCb;successCb=function(response){$scope.verifyingMobileNumber=!1,TrackingService.postEvent("Mobile verified",{"Mobile number":mobileVerificationForm.mobileNumber,Mode:"SMS",status:"Success"}),response.data?(MODAL_MOBILE_VERIFICATION.hide(),$scope.forms.mobileVerification.OTPerror=!1,$scope.user=response.data,$scope.getMenu(),$scope.directToAddressSection(),$scope.openAddressSection()):(TrackingService.postEvent("Mobile verified",{"Mobile number":mobileVerificationForm.mobileNumber,Mode:"SMS",status:"Failure"}),$scope.forms.mobileVerification.OTPerror=!0)},errorCb=function(response){$scope.verifyingMobileNumber=!1,$scope.forms.mobileVerification.errors=response.errors},$scope.verifyingMobileNumber=!0,Api.verifyMobileNumberWithoutDigits(mobileVerificationForm,successCb,errorCb)};$scope.verifyMobileNumber=function(mobileVerificationForm){_.isEmpty(mobileVerificationForm.OTPToken)?$scope.forms.mobileVerification.isOTPEmpty=!0:(_verifyMobileNumber(mobileVerificationForm),$scope.forms.mobileVerification.isOTPEmpty=!1)};var _getOTP=function(mobileNumber,isResending){var successCb,errorCb;$scope.showSendOTPAgainMsg=!1,$scope.showSendOTPFailedAgainMsg=!1,successCb=function(response){response.data?($scope.fetchingOTP=!1,$scope.fetchingOTPDone=!0,$scope.forms.mobileVerification.error=!1,$scope.showSendOTPAgainMsg=isResending):($scope.fetchingOTP=!1,$scope.forms.mobileVerification.error=!0,$scope.showSendOTPAgainMsg=!1,$scope.showSendOTPFailedAgainMsg=isResending)},errorCb=function(){$scope.showSendOTPAgainMsg=!1,$scope.showSendOTPFailedAgainMsg=isResending,$scope.fetchingOTP=!1,$scope.forms.mobileVerification.error=!0,$scope.forms.mobileVerification.error=!0},Api.getOTP(mobileNumber,$scope.user,successCb,errorCb)};$scope.validateUserMobileNumber=function(user,formOject){var phoneRegex=/^\d{10}$/;$scope[formOject]&&(_.isUndefined(user)||_.isEmpty(user)||_.isUndefined(user.mobileNumber)||_.isEmpty(user.mobileNumber)||!user.mobileNumber.match(phoneRegex)?$scope[formOject].mobileNumber=!0:$scope[formOject].mobileNumber=!1)},$scope.getOTPForMobileNumber=function(mobileVerificationForm,isResending){$scope.validateUserMobileNumber(mobileVerificationForm,"mobileVerification"),_.isEmpty($scope.mobileVerification)&&($scope.fetchingOTP=!0,TrackingService.postEvent("Mobile verified initialised",{"Mobile number":mobileVerificationForm.mobileNumber,"Source screen":"/menu"}),_getOTP(mobileVerificationForm.mobileNumber,isResending))},$scope.displayDigitsPopup=function(){$scope.user&&$scope.user.mobileNumber&&($scope.forms.mobileVerification.mobileNumber=$scope.user.mobileNumber),window.MODAL_MOBILE_VERIFICATION&&window.MODAL_MOBILE_VERIFICATION.show()},$scope.register=function(user){$scope.validateRegisterForm(user,"registerForm")&&($scope.registerLoading||(""==$scope.loginSourceScreen&&($scope.loginSourceScreen=window.location.pathname.split("/")[1],$scope.loginSourceScreen=""!=$scope.loginSourceScreen?$scope.loginSourceScreen:"menu"),$scope.forms.register.errors=null,$scope.registerLoading=!0,Api.register(user,function(data){$scope.fromLoginSuccess=!0,$scope.getMenu(),$scope.registerLoading=!1,$scope.user=data,Cookie.set({cookieName:"fmAlternativeEmailId",cookieValue:data.email,expireTime:720}),Cookie.set({cookieName:"fmAlternativePhoneNumber",cookieValue:data.mobileNumber,expireTime:720}),$scope.displayDigitsPopup(),$scope.setDividerText(),$scope.forms.checkout.user=data,$scope.getUserAddresses(null,$scope.checkAndRedirectIncaseReq),$scope.shouldRedirectAddress()||(window.MODAL_LOGIN&&MODAL_LOGIN.hide(),$scope.confirmInProgress&&($("#confirm").modal("show"),$scope.confirmInProgress=!1),$scope.loginLoading=!1,window.MODAL_REGISTER_EMAIL&&MODAL_REGISTER_EMAIL.hide(),dataLayer.push({event:"signUpRequest",action:"Email",label:"Success"}),TrackingService.postEvent("User identified",{type:"Sign up",Mode:"Email",Status:"Success",Email:user.email?user.email:"",SourceScreen:$scope.loginSourceScreen,phoneNumber:user.mobileNumber?user.mobileNumber:"","NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)},user),$scope.callAfterAnyLogin())},function(response){$scope.forms.register.errors=response.data,$scope.registerLoading=!1,dataLayer.push({event:"signUpRequest",action:"Email",label:"Fail"}),TrackingService.postEvent("User identified",{type:"Sign up",Mode:"Email",Status:"Failure",Email:user.email?user.email:"",SourceScreen:$scope.loginSourceScreen,phoneNumber:user.mobileNumber?user.mobileNumber:"","NUP Eligible":!(!$scope.menu||!$scope.menu.psd||"NEW_USER"!==$scope.menu.psd.wt)}),$scope.loginSourceScreen=""})))},$scope.validateRegisterForm=function(user,registerFormType){$scope[registerFormType]={};var emailRegx=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,phoneRegex=/^\d{10}$/;return user||(user={}),(!user.firstName||0==user.firstName.length)&&$("#modal-register-email form input[name='firstName']").val().length>0&&(user.firstName=$("#modal-register-email form input[name='firstName']").val()),(!user.lastName||0==user.lastName.length)&&$("#modal-register-email form input[name='lastName']").val().length>0&&(user.lastName=$("#modal-register-email form input[name='lastName']").val()),(!user.email||0==user.email.length)&&$("#modal-register-email form input[name='email']").val().length>0&&(user.email=$("#modal-register-email form input[name='email']").val()),(!user.password||0==user.password.length)&&$("#modal-register-email form input[name='password']").val().length>0&&(user.password=$("#modal-register-email form input[name='password']").val()),_.isUndefined(user)||_.isEmpty(user)?($scope.registerForm={firstName:!0,mobileNumber:!0,email:!0,password:!0},!1):((_.isUndefined(user.firstName)||_.isEmpty(user.firstName))&&($scope.registerForm.firstName=!0),(_.isUndefined(user.mobileNumber)||_.isEmpty(user.mobileNumber)||!user.mobileNumber.match(phoneRegex))&&($scope.registerForm.mobileNumber=!0),(_.isUndefined(user.email)||_.isEmpty(user.email)||!user.email.match(emailRegx))&&($scope.registerForm.email=!0),(_.isUndefined(user.password)||_.isEmpty(user.password)||user.password.length<=3)&&($scope.registerForm.password=!0),_.isEmpty($scope.registerForm))},$scope.validateUserFirstName=function(user,formOject){$scope[formOject]&&(_.isUndefined(user)||_.isEmpty(user)||_.isUndefined(user.firstName)||_.isEmpty(user.firstName)?$scope[formOject].firstName=!0:$scope[formOject].firstName=!1)},$scope.validateUserMobileNumber=function(user,formOject){var phoneRegex=/^\d{10}$/;$scope[formOject]&&(_.isUndefined(user)||_.isEmpty(user)||_.isUndefined(user.mobileNumber)||_.isEmpty(user.mobileNumber)||!user.mobileNumber.match(phoneRegex)?$scope[formOject].mobileNumber=!0:$scope[formOject].mobileNumber=!1)},$scope.redirectToCheck=function(){return"C"===$scope.cart.dst?(MENU_CART.hide(),void $timeout(function(){MODAL_DELIVER_NOW_LATER.show()},500)):($scope.redirectingToCheckout=!0,TrackingService.postEvent("timeSpent",{pageName:"cart",duration:(new Date).getTime()-new Date(window.fmCartMenuTimer).getTime(),totalDuration:1e4*$scope.fmTimeSpentOnMenuPageCounter,noOfItemsInCart:$scope.cart&&$scope.cart.items&&$scope.cart.items.length?$scope.cart.items.length:0,noOfTimesVisited:$scope.noOfTimesCartVisited,during:"checkout"}),void $scope.fireEventsAndRedirect())},$scope.redirectToCheckMobile=function(){$scope.redirectingToCheckout=!0,$scope.GTM_Custom_Event({category:"Cart",action:"Click",label:"Checkout",value:1}),GTM_log_funnel_step({action:"Checkout",ecommerce:{checkout:{actionField:{step:4},products:GTM_map_cart_products($scope.cart)}}},function(){console.log("########################## FUNNEL STEP 4")});var amount=$scope.cart&&$scope.cart.totalAmount&&$scope.cart.paymentDetails.totalAmount?$scope.cart.paymentDetails.totalAmount.toString():"0";console.log("clevertap event for Checkout clicked getting triggered"),TrackingService.postEvent("Checkout clicked",{Kitchen:$scope.menu&&$scope.menu.fulfillmentCenter&&$scope.menu.fulfillmentCenter.name,Amount:amount,Source:"/menu","corporate enabled":!(!$scope.cart||!$scope.cart.corporateDiscount)}),Api.setDsi({dsi:$scope.selected_delivered_time.id},function(res){res&&res.validation&&res.validation.error&&_.keys(res.validation.error).length?($scope.getCart(),cb&&cb(!1)):window.location.href="/checkout"})},$scope.selectDeliverySlot=function(timing){timing.id?($scope.shouldDeliveryNow=!1,$scope.selected_delivered_time=timing):($scope.shouldDeliveryNow=!0,$scope.selected_delivered_time={id:0}),$scope.goback()},$scope.fmOfferDisplayModalLink=function(link){window.location.href=link},$scope.hasCollectionAnyCategoryItemsInUnderscore=function(collectionId){if(!$scope.menu||!$scope.menu.collections||0==$scope.menu.collections.length)return!0;for(var i=0;$scope.menu&&$scope.menu.collections&&i<$scope.menu.collections.length;i++)if($scope.menu.collections[i].id==collectionId)return $scope.hasCollectionAnyCategoryItems($scope.menu.collections[i],$scope.newFilterList);return!1},$scope.hasCollectionAnyNewProductReverseLayoutItem=function(){var elements=document.getElementsByClassName("hasProductNewLayout");for(i=0;i<elements.length;i++)(i+1)%2==0?elements[i].classList.add("ProductNewLayoutReversed"):elements[i].classList.remove("ProductNewLayoutReversed");return!1},$scope.hasCollectionAnyNewProductLayoutItem=function(collection,fcList){if("d"!=$scope.abtesting){if(_.isEmpty(collection)||_.isEmpty(collection.products)||_.isEmpty(collection.products[0]))return!1;var product=collection.products[0];return $scope.isProductFullWidth(product,fcList,"productNewLayout")}return!1},$scope.isProductFullWidth=function(product,fcList,extraKey){var itemCount=0;return $scope.hasAnyCategories(product,fcList)?$scope.showOnlyExpressItems?product.isExpressItem&&product[extraKey]&&itemCount++:product[extraKey]&&itemCount++:0==fcList.length&&($scope.showOnlyExpressItems?product.isExpressItem&&product[extraKey]&&itemCount++:product[extraKey]&&itemCount++),itemCount>0},$scope.hasCollectionAnyCategoryItems=function(collection,fcList){var itemCount=0;return _.each(collection.products,function(product){$scope.hasAnyCategories(product,fcList)?$scope.showOnlyExpressItems?product.isExpressItem&&itemCount++:itemCount++:0==fcList.length&&($scope.showOnlyExpressItems?product.isExpressItem&&itemCount++:itemCount++)}),itemCount},$scope.GTM_Custom_Event=function(customEvent){dataLayer.push(_.assign(customEvent,{event:"customEvent"}))},$scope.cleverTapMenuCartEvent=function(){if($scope.pdpPopupCallback(!1),PRODUCT_DETAILS_POPUP&&PRODUCT_DETAILS_POPUP.hide(),$scope.cart&&$scope.cart.items&&$scope.cart.items.length){var fmEmail=$scope.user&&$scope.user.email?$scope.user.email:Cookie.get("fmAlternativeEmailId")&&Cookie.get("fmAlternativeEmailId").length>0?Cookie.get("fmAlternativeEmailId"):"";window.criteo_q&&(window.criteo_q.push({event:"setAccount",account:39162},{event:"setEmail",email:[fmEmail]},{event:"setSiteType",type:window.fmIsMobileTemplate?"m":"d"},{event:"viewBasket",currency:"INR",item:_.map($scope.cart.items,function(item){return{id:item.productId,price:item.pricePerItem,quantity:item.quantity}})}),console.log("CRITEO ---- BASKET")),GTM_log_funnel_step({action:"Checkout",ecommerce:{checkout:{actionField:{step:3},products:GTM_map_cart_products($scope.cart)}}},function(){console.log("########################## FUNNEL STEP 3")});var amount=($scope.cart&&$scope.cart.finalAmount?$scope.cart.finalAmount:0).toString(),path=document.location.pathname,page=path.substring(path.indexOf("/"));page.indexOf("/product")>0&&(page="Product detail"),TrackingService.postEvent("Cart clicked",{Amount:amount,Source:page})}$scope.showCart?$scope.closeCart():openCart()},$scope.pushState=function(){window.history?window.history.pushState({},"",window.location.pathname):popstateEmitted()},$scope.goback=function(){window.history?window.history.back():popstateEmitted()},window.addEventListener("popstate",popstateEmitted),$scope.fmHandleMobileCategoryHeaderClick=function(){$scope.fmMobileCategoryListShow||$("#filter").removeClass("active"),PRODUCT_DETAILS_POPUP&&($scope.pdpPopupCallback(!1),PRODUCT_DETAILS_POPUP.hide()),$scope.fmMobileCategoryListShow=!$scope.fmMobileCategoryListShow},$scope.fmHandleMobileHideFilterList=function(){$scope.fmMobileCategoryListShow=!1},$scope.fmHandleViewMenu=function(){""!=$(".fm-location-autocomplete-input").val()&&null!=$(".fm-location-autocomplete-input").val()||($scope.showLocationPopupErrorMessage=!0,console.log("show please enter location message"))},$scope.appDownload={},$scope.appDownloadSuccess=!1,$scope.errors={appDownload:{}},$scope.sendAppDownloadUrl=function(){var phoneRegex=/^\d{10}$/;if(!$scope.appDownload.mobileNumber)return void($scope.errors.appDownload.mobileNumber="Please enter a valid mobile number.");var mobileNumber=$scope.appDownload.mobileNumber;return _.isUndefined(mobileNumber)||_.isEmpty(mobileNumber)||!mobileNumber.match(phoneRegex)?void($scope.errors.appDownload.mobileNumber="Please enter a valid mobile number."):($scope.appDownloadloading=!0,$scope.addCleverTapEvent("Clicked",{action:"Send app link"}),void $http.post("/api/sms/applink",$scope.appDownload).then(function(response){$scope.appDownloadloading=!1,$scope.appDownloadSuccess=!0},function(response){$scope.errors.appDownload.msg="Please enter a valid mobile number.",$scope.appDownloadloading=!1}))},$scope.setRecommendedProducts=function(){$scope.recommendedProductsObjectsList=[];var j,k,recommendProductCount,product,menuListLength=$scope.menu.collections.length;recommendProductCount=$scope.recommendedProductsList.length;var collectionLength;for(l=0;l<recommendProductCount;l++)for(j=0;j<menuListLength;j++)if(collectionLength=$scope.menu.collections[j].products.length)for(k=0;k<collectionLength;k++)$scope.recommendedProductsList[l]==$scope.menu.collections[j].products[k].id&&(product=_.assign({},$scope.menu.collections[j].products[k]),product.isInRecommendedSec=!0,$scope.recommendedProductsObjectsList.push(product));$scope.recommendedProductsObjectsList=$scope.recommendedProductsObjectsList.splice(0,6)},$scope.fmIsRecScrolling=!1,$scope.scrollRecommenedSection=function(direction){var fmRecScrollPosition=$(".fm-recommended-products-container").scrollLeft();0==$scope.fmIsRecScrolling&&($scope.fmIsRecScrolling=!0,"right"==direction?$(".fm-recommended-products-container").animate({scrollLeft:fmRecScrollPosition+407},"slow","swing",function(){$scope.fmIsRecScrolling=!1}):$(".fm-recommended-products-container").animate({scrollLeft:fmRecScrollPosition-407},"slow","swing",function(){$scope.fmIsRecScrolling=!1}))},$scope.isProductVeg=function(product){return window.fmIsMobileTemplate&&(product=_getProductFromId(product)),product.isVeg},$scope.getCategoryName=function(product){return window.fmIsMobileTemplate&&(product=_getProductFromId(product)),product.categories&&product.categories[0]&&product.categories[0].name&&product.categories[0].name},$scope.FB_share=function(url){return window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(url),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1},$scope.GP_share=function(url){return window.open("https://plus.google.com/share?url="+url,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1},$scope.TW_share=function(url,text){return _.isUndefined(text)&&(text=""),window.open("http://twitter.com/share?url="+encodeURIComponent(url)+"&text="+encodeURIComponent(text),"","left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0"),!1},$scope.addCleverTapEvent=function(eventName,eventData){TrackingService.postEvent(eventName,eventData)},$scope.directToShare=function(account,product){var addingType=product.soldOut||!$scope.checkTimings(product.timings)||$scope.kitchenClosed?"Preorder":"Order now",path=document.location.pathname,page=path.substring(path.indexOf("/"));switch("/"==page&&(page="/menu"),TrackingService.postEvent("product shared",{Id:product.id,"Product title":product.price,Category:product&&product.categories&&product.categories[0]&&product.categories[0].name?product.categories[0].name:"",Type:addingType,"Scroll depth":$(window).scrollTop(),Source:page,Mode:account}),account){case"fb":return $scope.FB_share($scope.constructProductDetailPageUrl(product));case"tw":return $scope.TW_share($scope.constructProductDetailPageUrl(product));case"gp":return $scope.GP_share($scope.constructProductDetailPageUrl(product));default:return!1}},$scope.getCategoryImg=function(name){switch(name.toLowerCase(name)){case"veg":return"veg-icon";case"non veg":return"nonveg-icon";case"contains egg":return"egg-icon";default:return!1}},$scope.getFoodTagDetail=function(name){switch(name.toLowerCase(name)){case"m_s":return{icon:"medium-spicy-icon",name:"Medium Spicy"};case"s_f":return{icon:"sugar-free-icon",name:"Sugar Free"};case"c_d":return{icon:"contains-dairy-icon",name:"Contains Dairy"};case"v_s":return{icon:"very-spicy-icon",name:"Very Spicy"};case"c_n":return{icon:"contains-nuts-icon",name:"Contains Nuts"};case"g_f":return{icon:"gluten-free-icon",name:"Gluten Free"};case"c_s":return{icon:"contains-soy-icon",name:"Contains Soy"};default:return!1}},$scope.openAddressModal=function(){PRODUCT_DETAILS_POPUP&&($scope.pdpPopupCallback(!1),PRODUCT_DETAILS_POPUP.hide()),MODAL_LOCATION_ADDRESS.show(),$scope.closeDefaultLocationModal()},$scope.fmUpsellCurrentDivId=0,$scope.stopUsellInterval=void 0,$scope.fmUpsellCarouselChange=function(divId){window.fmIsMobileTemplate||($scope.stopUpsellIntervalFn(),$scope.fmUpsellCurrentDivId=divId,$scope.startUpsellInterval())},$scope.fmUpsellSwipe=function(divId,direction){$scope.fmUpsellLoading=!0,$scope.fmUpsellSwipeDirection=direction,divId<0&&(divId=$scope.upsaleProducts.length-1),divId>=$scope.upsaleProducts.length&&(divId=0),$timeout(function(){$scope.fmUpsellLoading=!1},200),$scope.fmUpsellCurrentDivId=divId},$scope.startUpsellInterval=function(){if($timeout(function(){$scope.fmUpsellLoading=!1},500),!angular.isDefined($scope.stopUpsellInterval)){var upsaleLen=$scope.upsaleProducts.length;$scope.stopUpsellInterval=$interval(function(){$scope.fmUpsellCurrentDivId=$scope.fmUpsellCurrentDivId>=upsaleLen-1?0:$scope.fmUpsellCurrentDivId+1},5e3)}},$scope.stopUpsellIntervalFn=function(){angular.isDefined($scope.stopUpsellInterval)&&($interval.cancel($scope.stopUpsellInterval),$scope.stopUpsellInterval=void 0)},$scope.resetUpsellInterval=function(){$scope.fmUpsellCurrentDivId=0},$scope.fmMbResetUpsellInterval=function(){$timeout(function(){$scope.fmUpsellLoading=!1},500),$scope.fmUpsellCurrentDivId=0},$scope.fmSubscribeEmail=null,$scope.fmSubscribeEmailError=!1,$scope.fmSubscribeError=!1,$scope.fmSubscribeSuccess=!1,$scope.validateSubscribeEmail=function(){$scope.fmSubscribeEmail&&$scope.fmSubscribeEmail.length>0&&/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($scope.fmSubscribeEmail)?$scope.fmSubscribeEmailError=!1:$scope.fmSubscribeEmailError=!0,$scope.fmSubscribeError=!1,$scope.fmSubscribeSuccess=!1},$scope.fmSubscribeToEmail=function(){$scope.fmSubscribeEmail=document.getElementById("fmSubscribeEmail").value,$scope.validateSubscribeEmail(),$scope.fmSubscribeEmail&&$scope.fmSubscribeEmail.length>0&&!$scope.fmSubscribeEmailError&&Api.fmSubscribeToEmail($scope.fmSubscribeEmail,function(data){data.data?($scope.fmSubscribeSuccess=!0,TrackingService.postEvent("Clicked",{action:"subscribed",screenname:"footer"}),$scope.fireFooterGAEvent("click","subscribe_newletter_success")):($scope.fmSubscribeError=!0,
$scope.fireFooterGAEvent("click","subscribe_newletter_failre"))})},$scope.testimonials=[],$scope.closeskiptowebsite=function(appDownload){Cookie.set({cookieName:"fmskiptosite",cookieValue:"NO_DATA",expireTime:$scope.fmsetCookieExpiretimeTofmskiptositeModel}),SKIP_TO_WEBSITE.click(),appDownload&&(window.location.href="http://ln.freshmenu.com/kddu/QiHSES4HuC")},$scope.fmredirectFromCategoryPage=function(fmhash){TrackingService.postEvent("Clicked",{action:"View all"+fmhash.replace("#"," "),source:"Food - festival"+window.fmCategoryPageName}),window.location.href="/"+fmhash},$scope.fmTimeSpentOnMenuPageCounter=0,setTimeout(function(){defaultMenuCartTimeCounterEvent()},3e4),$scope.showCart=!1,$scope.headerMarginLeft=0,$scope.showLeftCategoryArrow=!1,$scope.showRightCategoryArrow=!1,$scope.closeCart=function(){$scope.showCart=!1,window.setTimeout(function(){initializeCategoryArrows()},200)},window.addEventListener("resize",initializeCategoryArrows),$scope.lastScrollEventFired=0,window.addEventListener("scroll",function(){var decile=Math.floor(10*(window.scrollY+window.innerHeight)/window.document.body.clientHeight);decile>$scope.lastScrollEventFired&&($scope.lastScrollEventFired=decile,$scope.fireGAEvent("Menu","scroll","menu_scroll",10*decile,$scope.selectedCollection?$scope.selectedCollection.name:null))}),$scope.scrollCategoryHeader=function(leftOrRight){var totalWidth=parseInt($("#fm-collection-nav ul").width(),10),availableWidth=parseInt($("#fm-collection-nav").width(),10),remaningWidth=totalWidth+$scope.headerMarginLeft-availableWidth;leftOrRight?($scope.showRightCategoryArrow=!0,-1*$scope.headerMarginLeft<availableWidth?($scope.showLeftCategoryArrow=!1,$scope.headerMarginLeft=0):$scope.headerMarginLeft+=availableWidth-150):($scope.showLeftCategoryArrow=!0,remaningWidth<availableWidth?($scope.showRightCategoryArrow=!1,$scope.headerMarginLeft-=remaningWidth):$scope.headerMarginLeft-=availableWidth-150),$("#fm-collection-nav ul").css({margin:"auto 0 auto "+$scope.headerMarginLeft+"px"})},$scope.showFreebieMessage=function(data){data.fi&&data.fi.length>0?$scope.fmfreebieMessageShown||($scope.fmfreebieMessageShown=!0,$scope.fmshowFreebieMessage=!0,$scope.fireGAEvent($("#product_details_popup").hasClass("open")?"PDP":"Menu","load","freebie_popup"),$scope.freebietimeout=$timeout(function(){$scope.fmshowFreebieMessage=!1,$scope.fireGAEvent($("#product_details_popup").hasClass("open")?"PDP":"Menu","load","freebie_popup_close")},3e3)):($scope.fmshowFreebieMessage=!1,$scope.fmfreebieMessageShown=!1)},$scope.closefreebiemessage=function(){$scope.fmfreebieMessageShown=!0,$scope.fmshowFreebieMessage=!1,$scope.fireGAEvent("Menu","load","freebie_popup_close")},$scope.favorite=function(event,collectionIndex,productIndex,productId){if($scope.user&&$scope.user.id){var screenName="";if(!$scope.favoriteInProcess){if(collectionIndex&&collectionIndex<0||productIndex&&productIndex<0){var index=$scope.favoriteGetProductIndex(productId);collectionIndex=index[0],productIndex=index[1],screenName="product detail"}else screenName="menu catalog";$scope.favoriteInProcess=!0,$scope.menu&&$scope.menu.collections[collectionIndex]&&$scope.menu.collections[collectionIndex].products[productIndex]&&!$scope.menu.collections[collectionIndex].products[productIndex].isLiked?$scope.favoriteLike(event,collectionIndex,productIndex,productId,screenName):$scope.menu&&$scope.menu.collections[collectionIndex]&&$scope.menu.collections[collectionIndex].products[productIndex]&&$scope.menu.collections[collectionIndex].products[productIndex].isLiked&&$scope.favoriteUnlike(event,collectionIndex,productIndex,productId,screenName)}}else $scope.isProductDetailsPopupOpened&&PRODUCT_DETAILS_POPUP.hide(),$scope.favoriteTriggeredEvent=event,$scope.favoriteProductId=productId,$scope.loginSourceScreen="favourite",MODAL_LOGIN.show()},$scope.favoriteGetProductIndex=function(productId){return _.some($scope.menu.collections,function(collection,collectionIndexTmp){var productFound=_.some(collection.products,function(item,productIndexTmp){if(item.id==productId)return collectionIndex=collectionIndexTmp,productIndex=productIndexTmp,!0});if(productFound)return!0}),[collectionIndex,productIndex]},$scope.favoriteLike=function(event,collectionIndex,productIndex,productId,screenName){$(".favourite-tooltip").addClass("ng-hide"),Api.favoriteLike({productIds:[productId]},function(response){response.data.success&&($scope.menu.collections[collectionIndex].products[productIndex].isLiked=!$scope.menu.collections[collectionIndex].products[productIndex].isLiked,$scope.menu.collections[collectionIndex].products[productIndex].likesCount+=1,1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||("product detail"!=screenName&&($(event.currentTarget.firstElementChild).removeClass("icon-heart-o").addClass("icon-heart"),$(event.currentTarget.lastElementChild).text($scope.menu.collections[collectionIndex].products[productIndex].likesCount+" favs")),"product detail"==screenName?($("#favorite-"+productId).children("span").first().text($scope.menu.collections[collectionIndex].products[productIndex].likesCount),$("#favorite-"+productId).children("span").last().removeClass("icon-heart-o").addClass("icon-heart")):($scope.menu.collections[collectionIndex].products[productIndex].isLikedFirst=!0,$("#favorite-tooltip-"+productId).removeClass("ng-hide").addClass("ng-show"),$timeout(function(){$scope.menu.collections[collectionIndex].products[productIndex].isLikedFirst=!1,$("#favorite-tooltip-"+productId).removeClass("ng-show").addClass("ng-hide")},3e3))),"product detail"==screenName?($scope.product_details.isLiked=$scope.menu.collections[collectionIndex].products[productIndex].isLiked,$scope.product_details.likesCount=$scope.menu.collections[collectionIndex].products[productIndex].likesCount):($scope.menu.collections[collectionIndex].products[productIndex].isLikedFirst=!0,$timeout(function(){$scope.menu.collections[collectionIndex].products[productIndex].isLikedFirst=!1},3e3)),TrackingService.postEvent("Clicked",{action:"mark favourite",screenname:screenName})),$scope.favoriteTriggeredEvent={},$scope.favoriteProductId="",$scope.favoriteInProcess=!1})},$scope.favoriteUnlike=function(event,collectionIndex,productIndex,productId,screenName){Api.favoriteUnlike({productIds:[productId]},function(response){response.data.success&&($scope.menu.collections[collectionIndex].products[productIndex].isLiked=!$scope.menu.collections[collectionIndex].products[productIndex].isLiked,$scope.menu.collections[collectionIndex].products[productIndex].likesCount-=1,1!=fmIsMobileTemplate&&"true"!=fmIsMobileTemplate||("product detail"!=screenName&&($(event.currentTarget.firstElementChild).removeClass("icon-heart").addClass("icon-heart-o"),$(event.currentTarget.lastElementChild).text($scope.menu.collections[collectionIndex].products[productIndex].likesCount+" favs")),"product detail"==screenName&&($("#favorite-"+productId).children("span").first().text($scope.menu.collections[collectionIndex].products[productIndex].likesCount),$("#favorite-"+productId).children("span").last().removeClass("icon-heart").addClass("icon-heart-o"))),"product detail"==screenName&&($scope.product_details.isLiked=$scope.menu.collections[collectionIndex].products[productIndex].isLiked,$scope.product_details.likesCount=$scope.menu.collections[collectionIndex].products[productIndex].likesCount),TrackingService.postEvent("Clicked",{action:"unmark favourite",screenname:screenName})),$scope.favoriteProductId="",$scope.favoriteInProcess=!1})},$scope.openLoginModalFormHeader=function(){$scope.loginSourceScreen="",$scope.fireGAEvent("Login","load","load_login_page")},$scope.openSignupModalFormHeader=function(){$scope.loginSourceScreen="",$scope.fireGAEvent("SignUp","load","load_signup_page")},$scope.pdpCloseCallbackAdded=!1,$scope.pdpPopupCallback=function(status){status&&(setTimeout(function(){$("#product_details_popup").scrollTop(0)}),$scope.pdpCloseCallbackAdded||($scope.pdpCloseCallbackAdded=!0,PRODUCT_DETAILS_POPUP.closeCallbacks.push(function(){$scope.isProductDetailsPopupOpened=!1}))),$scope.isProductDetailsPopupOpened=status},$scope.fmCloseVideoFunc=function(){document.getElementById("fm-banner-video")&&(TrackingService.postEvent("Clicked",{action:"close video"}),document.getElementById("fm-banner-video").pause())},$scope.ischecked=function(cuisine){return $scope.newFilterList.indexOf(cuisine)!=-1},$scope.fireGAEvent=function(category,action,label,value,source){var data={event:"customEvent",category:category,action:action};label&&(data.label=label),value&&(data.value=value),source&&(data.source=source),dataLayer.push(data)},window.fireGAEvent=$scope.fireGAEvent,$scope.fireFooterGAEvent=function(action,label,value,source){$scope.fireGAEvent("Footer",action,label,value,source)},$scope.toggleFmFilterMobileShow=function(){$scope.fmFilterMobileShow=!$scope.fmFilterMobileShow};var footerCategories=_.keys(window.fmCategoriesToShow);$scope.footerCategories=[];for(var i=0;i<footerCategories.length;i++)$scope.footerCategories.push(_.extend(window.fmCategoriesToShow[footerCategories[i]],{url:"/category/"+footerCategories[i]}));$scope.footerCategoriesFirstSet=$scope.footerCategories.splice(0,$scope.footerCategories.length/2),$scope.footerCategoriesSecondSet=$scope.footerCategories.splice($scope.footerCategories.length/2-1,$scope.footerCategories.length),$scope.fmCorporateRedirect=function(){TrackingService.postEvent("Clicked",{action:"Corporate ordering"}),window.location.href="/corporate"},$scope.redirectToCorporate=function(){TrackingService.postEvent("Clicked",{action:"Corporate banner"}),window.location.href="/corporate"}}]);var _get_time_diff=function(datetime){var datetime="undefined"!=typeof datetime?datetime:"2014-01-01 01:02:03.123456",diff=(new Date).getTime()-new Date(datetime).getTime(),msec=diff,hh=Math.floor(msec/1e3/60/60);msec-=1e3*hh*60*60;var mm=Math.floor(msec/1e3/60);msec-=1e3*mm*60;var ss=Math.floor(msec/1e3);return msec-=1e3*ss,hh+":"+mm+":"+ss+":"+msec};if(1==fmIsMobileTemplate||"true"==fmIsMobileTemplate){var initiateBootstrapAppMsite=function initiateBootstrapAppMsite(){1==window.googleMapLoaded?(window.fmCartMenuTimer=Date.now(),angular.bootstrap(document,["App"]),console.log("TIME TO RENDER AFTER HTML STARTED LOADING: "+_get_time_diff(window.htmlStartedLoading))):setTimeout(function(){initiateBootstrapAppMsite()},50)};initiateBootstrapAppMsite()}else{var initiateBootstrapApp=function initiateBootstrapApp(){1==window.googleMapLoaded&&1==window.googleMapAddressInitiated?(window.fmCartMenuTimer=Date.now(),angular.bootstrap(document,["App"]),console.log("TIME TO RENDER AFTER HTML STARTED LOADING: "+_get_time_diff(window.htmlStartedLoading))):setTimeout(function(){initiateBootstrapApp()},50)};initiateBootstrapApp(),window.fmCartMenuTimer=Date.now()}